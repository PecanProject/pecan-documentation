<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>22 Docker | The Predictive Ecosystem Analyzer</title>
  <meta name="description" content="22 Docker | The Predictive Ecosystem Analyzer" />
  <meta name="generator" content="bookdown 0.17 and GitBook 2.6.7" />

  <meta property="og:title" content="22 Docker | The Predictive Ecosystem Analyzer" />
  <meta property="og:type" content="book" />
  
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="22 Docker | The Predictive Ecosystem Analyzer" />
  
  
  

<meta name="author" content="By: PEcAn Team" />


<meta name="date" content="2020-02-11" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="workflow-modules.html"/>
<link rel="next" href="pecan-remote.html"/>
<script src="libs/jquery-2.2.3/jquery.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />









<script src="libs/htmlwidgets-1.5.1/htmlwidgets.js"></script>
<link href="libs/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="libs/datatables-binding-0.10/datatables.js"></script>
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="libs/dt-core-1.10.19/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="libs/dt-core-1.10.19/js/jquery.dataTables.min.js"></script>
<link href="libs/dt-ext-fixedcolumns-1.10.19/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-fixedcolumns-1.10.19/js/dataTables.fixedColumns.min.js"></script>
<script src="libs/jszip-1.10.19/jszip.min.js"></script>
<script src="libs/pdfmake-1.10.19/pdfmake.min.js"></script>
<script src="libs/pdfmake-1.10.19/vfs_fonts.js"></script>
<link href="libs/dt-ext-buttons-1.10.19/css/buttons.dataTables.min.css" rel="stylesheet" />
<script src="libs/dt-ext-buttons-1.10.19/js/dataTables.buttons.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.19/js/buttons.flash.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.19/js/buttons.html5.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.19/js/buttons.colVis.min.js"></script>
<script src="libs/dt-ext-buttons-1.10.19/js/buttons.print.min.js"></script>
<link href="libs/crosstalk-1.0.0/css/crosstalk.css" rel="stylesheet" />
<script src="libs/crosstalk-1.0.0/js/crosstalk.min.js"></script>


<style type="text/css">
a.sourceLine { display: inline-block; line-height: 1.25; }
a.sourceLine { pointer-events: none; color: inherit; text-decoration: inherit; }
a.sourceLine:empty { height: 1.2em; position: absolute; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
a.sourceLine { text-indent: -1em; padding-left: 1em; }
}
pre.numberSource a.sourceLine
  { position: relative; }
pre.numberSource a.sourceLine:empty
  { position: absolute; }
pre.numberSource a.sourceLine::before
  { content: attr(data-line-number);
    position: absolute; left: -5em; text-align: right; vertical-align: baseline;
    border: none; pointer-events: all;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  }
@media screen {
a.sourceLine::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="project-overview.html"><a href="project-overview.html"><i class="fa fa-check"></i><b>1</b> Project Overview</a></li>
<li class="chapter" data-level="2" data-path="contributor-covenant-code-of-conduct.html"><a href="contributor-covenant-code-of-conduct.html"><i class="fa fa-check"></i><b>2</b> Contributor Covenant Code of Conduct</a></li>
<li class="chapter" data-level="3" data-path="about-the-pecan-book.html"><a href="about-the-pecan-book.html"><i class="fa fa-check"></i><b>3</b> About the PEcAn Book</a><ul>
<li class="chapter" data-level="3.1" data-path="about-the-pecan-book.html"><a href="about-the-pecan-book.html#general-feedbackcommentssuggestions"><i class="fa fa-check"></i><b>3.1</b> General Feedback/Comments/Suggestions</a></li>
<li class="chapter" data-level="3.2" data-path="about-the-pecan-book.html"><a href="about-the-pecan-book.html#bookediting"><i class="fa fa-check"></i><b>3.2</b> Editing this book</a></li>
<li class="chapter" data-level="3.3" data-path="about-the-pecan-book.html"><a href="about-the-pecan-book.html#how-to-create-your-own-version-of-documentation"><i class="fa fa-check"></i><b>3.3</b> How to create your own version of Documentation</a></li>
</ul></li>
<li class="part"><span><b>II Tutorials, Demos and How To’s</b></span></li>
<li class="chapter" data-level="4" data-path="pecan-manual-setup.html"><a href="pecan-manual-setup.html"><i class="fa fa-check"></i><b>4</b> Install PEcAn</a><ul>
<li class="chapter" data-level="4.1" data-path="pecan-manual-setup.html"><a href="pecan-manual-setup.html#install-vm"><i class="fa fa-check"></i><b>4.1</b> Virtual Machine (VM)</a></li>
<li class="chapter" data-level="4.2" data-path="pecan-manual-setup.html"><a href="pecan-manual-setup.html#install-docker"><i class="fa fa-check"></i><b>4.2</b> Docker</a></li>
<li class="chapter" data-level="4.3" data-path="pecan-manual-setup.html"><a href="pecan-manual-setup.html#install-native"><i class="fa fa-check"></i><b>4.3</b> (Advanced) Native install</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="user-section.html"><a href="user-section.html"><i class="fa fa-check"></i><b>5</b> Tutorials</a><ul>
<li class="chapter" data-level="5.1" data-path="user-section.html"><a href="user-section.html#pecan-in-a-nutshell"><i class="fa fa-check"></i><b>5.1</b> How PEcAn Works in a nutshell</a></li>
<li class="chapter" data-level="5.2" data-path="user-section.html"><a href="user-section.html#demo-table"><i class="fa fa-check"></i><b>5.2</b> PEcAn Demos</a></li>
<li class="chapter" data-level="5.3" data-path="user-section.html"><a href="user-section.html#demo-01-basic-run-pecan"><i class="fa fa-check"></i><b>5.3</b> Demo 01: Basic Run PEcAn</a></li>
<li class="chapter" data-level="5.4" data-path="user-section.html"><a href="user-section.html#demo-02-sensitivity-and-uncertainty-analysis"><i class="fa fa-check"></i><b>5.4</b> Demo 02: Sensitivity and Uncertainty Analysis</a></li>
<li class="chapter" data-level="5.5" data-path="user-section.html"><a href="user-section.html#othervignettes"><i class="fa fa-check"></i><b>5.5</b> Other Vignettes</a><ul>
<li class="chapter" data-level="5.5.1" data-path="user-section.html"><a href="user-section.html#simple-model-data-comparisons"><i class="fa fa-check"></i><b>5.5.1</b> Simple Model-Data Comparisons</a></li>
<li class="chapter" data-level="5.5.2" data-path="user-section.html"><a href="user-section.html#data-assimilation-concepts"><i class="fa fa-check"></i><b>5.5.2</b> Data Assimilation Concepts</a></li>
<li class="chapter" data-level="5.5.3" data-path="user-section.html"><a href="user-section.html#parameter-data-assimilation"><i class="fa fa-check"></i><b>5.5.3</b> Parameter Data Assimilation</a></li>
<li class="chapter" data-level="5.5.4" data-path="user-section.html"><a href="user-section.html#state-variable-data-assimilation"><i class="fa fa-check"></i><b>5.5.4</b> State-Variable Data Assimilation</a></li>
<li class="chapter" data-level="5.5.5" data-path="user-section.html"><a href="user-section.html#pecan-testing-the-sensitivity-analysis-against-observations"><i class="fa fa-check"></i><b>5.5.5</b> PEcAn: Testing the Sensitivity Analysis Against Observations&quot;</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="user-section.html"><a href="user-section.html#advanced-user"><i class="fa fa-check"></i><b>5.6</b> Advanced User Guide</a><ul>
<li class="chapter" data-level="5.6.1" data-path="user-section.html"><a href="user-section.html#web-curl-submission"><i class="fa fa-check"></i><b>5.6.1</b> Submitting Workflow from Command Line</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html"><i class="fa fa-check"></i><b>6</b> Basic Web workflow</a><ul>
<li class="chapter" data-level="6.1" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#web-site-model"><i class="fa fa-check"></i><b>6.1</b> Site and model selection</a><ul>
<li class="chapter" data-level="6.1.1" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#selecting-a-model"><i class="fa fa-check"></i><b>6.1.1</b> Selecting a model</a></li>
<li class="chapter" data-level="6.1.2" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#selecting-a-site"><i class="fa fa-check"></i><b>6.1.2</b> Selecting a site</a></li>
<li class="chapter" data-level="6.1.3" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#site-groups"><i class="fa fa-check"></i><b>6.1.3</b> Site Groups</a></li>
<li class="chapter" data-level="6.1.4" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#using-existing-sites"><i class="fa fa-check"></i><b>6.1.4</b> Using existing sites</a></li>
<li class="chapter" data-level="6.1.5" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#adding-a-new-site"><i class="fa fa-check"></i><b>6.1.5</b> Adding a new site</a></li>
<li class="chapter" data-level="6.1.6" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#troubleshooting"><i class="fa fa-check"></i><b>6.1.6</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#web-model-config"><i class="fa fa-check"></i><b>6.2</b> Model configuration</a><ul>
<li class="chapter" data-level="6.2.1" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#choosing-meteorology"><i class="fa fa-check"></i><b>6.2.1</b> Choosing meteorology</a></li>
<li class="chapter" data-level="6.2.2" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#met-workflow"><i class="fa fa-check"></i><b>6.2.2</b> Met workflow</a></li>
<li class="chapter" data-level="6.2.3" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#troubleshooting-meteorological-conversions"><i class="fa fa-check"></i><b>6.2.3</b> Troubleshooting meteorological conversions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#selecting-plant-functional-types-pfts-and-other-parameter-groupings."><i class="fa fa-check"></i><b>6.3</b> Selecting Plant Functional Types (PFTs) and other parameter groupings.</a><ul>
<li class="chapter" data-level="6.3.1" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#using-existing-pfts"><i class="fa fa-check"></i><b>6.3.1</b> Using existing PFTs</a></li>
<li class="chapter" data-level="6.3.2" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#creating-new-pfts"><i class="fa fa-check"></i><b>6.3.2</b> Creating new PFTs</a></li>
<li class="chapter" data-level="6.3.3" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#choosing-initial-vegetation"><i class="fa fa-check"></i><b>6.3.3</b> Choosing initial vegetation</a></li>
<li class="chapter" data-level="6.3.4" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#us-fia"><i class="fa fa-check"></i><b>6.3.4</b> US FIA</a></li>
<li class="chapter" data-level="6.3.5" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#spin-up"><i class="fa fa-check"></i><b>6.3.5</b> Spin up</a></li>
<li class="chapter" data-level="6.3.6" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#selecting-a-soils-product"><i class="fa fa-check"></i><b>6.3.6</b> Selecting a soils product</a></li>
<li class="chapter" data-level="6.3.7" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#soil-texture-depth-and-physical-parameters"><i class="fa fa-check"></i><b>6.3.7</b> Soil texture, depth, and physical parameters</a></li>
<li class="chapter" data-level="6.3.8" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html#other-model-inputs"><i class="fa fa-check"></i><b>6.3.8</b> Other model inputs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="intermediate-user.html"><a href="intermediate-user.html"><i class="fa fa-check"></i><b>7</b> More on the PEcAn Web Interface</a><ul>
<li class="chapter" data-level="7.1" data-path="intermediate-user.html"><a href="intermediate-user.html#additional-web-configuration"><i class="fa fa-check"></i><b>7.1</b> Additional web configuration</a><ul>
<li class="chapter" data-level="7.1.1" data-path="intermediate-user.html"><a href="intermediate-user.html#intermediate-web-setup"><i class="fa fa-check"></i><b>7.1.1</b> Web interface setup</a></li>
<li class="chapter" data-level="7.1.2" data-path="intermediate-user.html"><a href="intermediate-user.html#browndog"><i class="fa fa-check"></i><b>7.1.2</b> Brown Dog</a></li>
<li class="chapter" data-level="7.1.3" data-path="intermediate-user.html"><a href="intermediate-user.html#intermediate-advanced-setup"><i class="fa fa-check"></i><b>7.1.3</b> Advanced Setup</a></li>
<li class="chapter" data-level="7.1.4" data-path="intermediate-user.html"><a href="intermediate-user.html#intermediate-model-config"><i class="fa fa-check"></i><b>7.1.4</b> Editing model configurations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="intermediate-user.html"><a href="intermediate-user.html#settings-configured-analyses"><i class="fa fa-check"></i><b>7.2</b> Settings-configured analyses</a><ul>
<li class="chapter" data-level="7.2.1" data-path="intermediate-user.html"><a href="intermediate-user.html#pda"><i class="fa fa-check"></i><b>7.2.1</b> Parameter data assimilation (PDA)</a></li>
<li class="chapter" data-level="7.2.2" data-path="intermediate-user.html"><a href="intermediate-user.html#sda"><i class="fa fa-check"></i><b>7.2.2</b> State data assimilation (SDA)</a></li>
<li class="chapter" data-level="7.2.3" data-path="intermediate-user.html"><a href="intermediate-user.html#running-sda-on-remote"><i class="fa fa-check"></i><b>7.2.3</b> Running SDA on remote</a></li>
<li class="chapter" data-level="7.2.4" data-path="intermediate-user.html"><a href="intermediate-user.html#restart-functionality-in-sda"><i class="fa fa-check"></i><b>7.2.4</b> Restart functionality in SDA</a></li>
<li class="chapter" data-level="7.2.5" data-path="intermediate-user.html"><a href="intermediate-user.html#state-data-assimilation-methods"><i class="fa fa-check"></i><b>7.2.5</b> State Data Assimilation Methods</a></li>
<li class="chapter" data-level="7.2.6" data-path="intermediate-user.html"><a href="intermediate-user.html#multisettings"><i class="fa fa-check"></i><b>7.2.6</b> MultiSettings</a></li>
<li class="chapter" data-level="7.2.7" data-path="intermediate-user.html"><a href="intermediate-user.html#benchmarking"><i class="fa fa-check"></i><b>7.2.7</b> Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="developer-guide.html"><a href="developer-guide.html"><i class="fa fa-check"></i><b>8</b> Developer guide</a><ul>
<li class="chapter" data-level="8.1" data-path="developer-guide.html"><a href="developer-guide.html#updatebety"><i class="fa fa-check"></i><b>8.1</b> Updating PEcAn Code and Bety Database</a><ul>
<li class="chapter" data-level="8.1.1" data-path="developer-guide.html"><a href="developer-guide.html#pecan-make"><i class="fa fa-check"></i><b>8.1.1</b> Updating PEcAn</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="developer-guide.html"><a href="developer-guide.html#pecan-git"><i class="fa fa-check"></i><b>8.2</b> Git and GitHub Workflow</a><ul>
<li class="chapter" data-level="8.2.1" data-path="developer-guide.html"><a href="developer-guide.html#using-git"><i class="fa fa-check"></i><b>8.2.1</b> Using Git</a></li>
<li class="chapter" data-level="8.2.2" data-path="developer-guide.html"><a href="developer-guide.html#github-use-with-pecan"><i class="fa fa-check"></i><b>8.2.2</b> GitHub use with PEcAn</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="developer-guide.html"><a href="developer-guide.html#coding-practices"><i class="fa fa-check"></i><b>8.3</b> Coding Practices</a><ul>
<li class="chapter" data-level="8.3.1" data-path="developer-guide.html"><a href="developer-guide.html#developer-codestyle"><i class="fa fa-check"></i><b>8.3.1</b> Coding Style</a></li>
<li class="chapter" data-level="8.3.2" data-path="developer-guide.html"><a href="developer-guide.html#developer-logging"><i class="fa fa-check"></i><b>8.3.2</b> Logging</a></li>
<li class="chapter" data-level="8.3.3" data-path="developer-guide.html"><a href="developer-guide.html#developer-packagedata"><i class="fa fa-check"></i><b>8.3.3</b> Package Data</a></li>
<li class="chapter" data-level="8.3.4" data-path="developer-guide.html"><a href="developer-guide.html#developer-roxygen"><i class="fa fa-check"></i><b>8.3.4</b> Documenting functions using <code>roxygen2</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="developer-guide.html"><a href="developer-guide.html#developer-testing"><i class="fa fa-check"></i><b>8.4</b> Testing</a><ul>
<li class="chapter" data-level="8.4.1" data-path="developer-guide.html"><a href="developer-guide.html#developer-testing-unit"><i class="fa fa-check"></i><b>8.4.1</b> Unit testing</a></li>
<li class="chapter" data-level="8.4.2" data-path="developer-guide.html"><a href="developer-guide.html#developer-testing-integration"><i class="fa fa-check"></i><b>8.4.2</b> Integration testing</a></li>
<li class="chapter" data-level="8.4.3" data-path="developer-guide.html"><a href="developer-guide.html#continuous-integration"><i class="fa fa-check"></i><b>8.4.3</b> Continuous Integration</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="developer-guide.html"><a href="developer-guide.html#download-and-compile-pecan"><i class="fa fa-check"></i><b>8.5</b> Download and Compile PEcAn</a><ul>
<li class="chapter" data-level="8.5.1" data-path="developer-guide.html"><a href="developer-guide.html#download-compile-and-install-pecan-from-github"><i class="fa fa-check"></i><b>8.5.1</b> Download, compile and install PEcAn from GitHub</a></li>
<li class="chapter" data-level="8.5.2" data-path="developer-guide.html"><a href="developer-guide.html#pecan-testrun"><i class="fa fa-check"></i><b>8.5.2</b> PEcAn Testrun</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="developer-guide.html"><a href="developer-guide.html#directory-structure"><i class="fa fa-check"></i><b>8.6</b> Directory structure</a><ul>
<li class="chapter" data-level="8.6.1" data-path="developer-guide.html"><a href="developer-guide.html#overview-of-pecan-repository-as-of-pecan-1.5.3"><i class="fa fa-check"></i><b>8.6.1</b> Overview of PEcAn repository as of PEcAn 1.5.3</a></li>
<li class="chapter" data-level="8.6.2" data-path="developer-guide.html"><a href="developer-guide.html#generic-r-package-structure"><i class="fa fa-check"></i><b>8.6.2</b> Generic R package structure:</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Topical Pages</b></span></li>
<li class="chapter" data-level="9" data-path="working-with-vm.html"><a href="working-with-vm.html"><i class="fa fa-check"></i><b>9</b> VM configuration and maintenance</a><ul>
<li class="chapter" data-level="9.1" data-path="working-with-vm.html"><a href="working-with-vm.html#maintain-vm"><i class="fa fa-check"></i><b>9.1</b> Updating the VM</a></li>
<li class="chapter" data-level="9.2" data-path="working-with-vm.html"><a href="working-with-vm.html#ssh-vm"><i class="fa fa-check"></i><b>9.2</b> Connecting to the VM via SSH</a></li>
<li class="chapter" data-level="9.3" data-path="working-with-vm.html"><a href="working-with-vm.html#ssh-vm-bety"><i class="fa fa-check"></i><b>9.3</b> Connecting to bety on the VM via SSh</a><ul>
<li class="chapter" data-level="9.3.1" data-path="working-with-vm.html"><a href="working-with-vm.html#awsvm"><i class="fa fa-check"></i><b>9.3.1</b> Using Amazon Web Services for a VM (AWS)</a></li>
<li class="chapter" data-level="9.3.2" data-path="working-with-vm.html"><a href="working-with-vm.html#createvm"><i class="fa fa-check"></i><b>9.3.2</b> Creating a Virtual Machine</a></li>
<li class="chapter" data-level="9.3.3" data-path="working-with-vm.html"><a href="working-with-vm.html#vm-dektop-conversion"><i class="fa fa-check"></i><b>9.3.3</b> VM Desktop Conversion</a></li>
<li class="chapter" data-level="9.3.4" data-path="working-with-vm.html"><a href="working-with-vm.html#install-rstudio"><i class="fa fa-check"></i><b>9.3.4</b> Install RStudio Desktop</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="pecan-standards.html"><a href="pecan-standards.html"><i class="fa fa-check"></i><b>10</b> PEcAn standard formats</a><ul>
<li class="chapter" data-level="10.1" data-path="pecan-standards.html"><a href="pecan-standards.html#defining-new-input-formats"><i class="fa fa-check"></i><b>10.1</b> Defining new input formats</a></li>
<li class="chapter" data-level="10.2" data-path="pecan-standards.html"><a href="pecan-standards.html#time-standard"><i class="fa fa-check"></i><b>10.2</b> Time Standard</a><ul>
<li class="chapter" data-level="10.2.1" data-path="pecan-standards.html"><a href="pecan-standards.html#input-standards"><i class="fa fa-check"></i><b>10.2.1</b> Input Standards</a></li>
<li class="chapter" data-level="10.2.2" data-path="pecan-standards.html"><a href="pecan-standards.html#soils-and-vegetation-inputs"><i class="fa fa-check"></i><b>10.2.2</b> Soils and Vegetation Inputs</a></li>
<li class="chapter" data-level="10.2.3" data-path="pecan-standards.html"><a href="pecan-standards.html#output-standards"><i class="fa fa-check"></i><b>10.2.3</b> Output Standards</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="pecanXML.html"><a href="pecanXML.html"><i class="fa fa-check"></i><b>11</b> The PEcAn XML</a><ul>
<li class="chapter" data-level="11.0.1" data-path="pecanXML.html"><a href="pecanXML.html#xml-core-config"><i class="fa fa-check"></i><b>11.0.1</b> Core configuration</a></li>
<li class="chapter" data-level="11.0.2" data-path="pecanXML.html"><a href="pecanXML.html#xml-outdir"><i class="fa fa-check"></i><b>11.0.2</b> <code>outdir</code>: Output directory</a></li>
<li class="chapter" data-level="11.0.3" data-path="pecanXML.html"><a href="pecanXML.html#xml-database"><i class="fa fa-check"></i><b>11.0.3</b> <code>database</code>: PEcAn database settings</a></li>
<li class="chapter" data-level="11.0.4" data-path="pecanXML.html"><a href="pecanXML.html#xml-pft"><i class="fa fa-check"></i><b>11.0.4</b> <code>pft</code>: Plant functional type selection</a></li>
<li class="chapter" data-level="11.0.5" data-path="pecanXML.html"><a href="pecanXML.html#xml-meta-analysis"><i class="fa fa-check"></i><b>11.0.5</b> <code>meta.analysis</code>: Trait Meta Analysis</a></li>
<li class="chapter" data-level="11.0.6" data-path="pecanXML.html"><a href="pecanXML.html#xml-model"><i class="fa fa-check"></i><b>11.0.6</b> <code>model</code>: Model configuration</a></li>
<li class="chapter" data-level="11.0.7" data-path="pecanXML.html"><a href="pecanXML.html#xml-run"><i class="fa fa-check"></i><b>11.0.7</b> <code>run</code>: Run Setup</a></li>
<li class="chapter" data-level="11.0.8" data-path="pecanXML.html"><a href="pecanXML.html#xml-host"><i class="fa fa-check"></i><b>11.0.8</b> <code>host</code>: Host information for remote execution</a></li>
<li class="chapter" data-level="11.0.9" data-path="pecanXML.html"><a href="pecanXML.html#xml-advanced"><i class="fa fa-check"></i><b>11.0.9</b> Advanced features</a></li>
<li class="chapter" data-level="11.0.10" data-path="pecanXML.html"><a href="pecanXML.html#xml-ensemble"><i class="fa fa-check"></i><b>11.0.10</b> <code>ensemble</code>: Ensemble Runs</a></li>
<li class="chapter" data-level="11.0.11" data-path="pecanXML.html"><a href="pecanXML.html#xml-sensitivity-analysis"><i class="fa fa-check"></i><b>11.0.11</b> <code>sensitivity.analysis</code>: Sensitivity analysis</a></li>
<li class="chapter" data-level="11.0.12" data-path="pecanXML.html"><a href="pecanXML.html#xml-parameter-data-assimilation"><i class="fa fa-check"></i><b>11.0.12</b> Parameter Data Assimilation</a></li>
<li class="chapter" data-level="11.0.13" data-path="pecanXML.html"><a href="pecanXML.html#xml-multi-settings"><i class="fa fa-check"></i><b>11.0.13</b> Multi-Settings</a></li>
<li class="chapter" data-level="11.0.14" data-path="pecanXML.html"><a href="pecanXML.html#xml-state-data-assimilation"><i class="fa fa-check"></i><b>11.0.14</b> (experimental) State Data Assimilation</a></li>
<li class="chapter" data-level="11.0.15" data-path="pecanXML.html"><a href="pecanXML.html#xml-browndog"><i class="fa fa-check"></i><b>11.0.15</b> (experimental) Brown Dog</a></li>
<li class="chapter" data-level="11.0.16" data-path="pecanXML.html"><a href="pecanXML.html#xml-benchmarking"><i class="fa fa-check"></i><b>11.0.16</b> (experimental) Benchmarking</a></li>
</ul></li>
<li class="chapter" data-level="12" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>12</b> PEcAn workflow (web/workflow.R)</a><ul>
<li class="chapter" data-level="12.0.1" data-path="workflow.html"><a href="workflow.html#workflow-readsettings"><i class="fa fa-check"></i><b>12.0.1</b> Read Settings</a></li>
<li class="chapter" data-level="12.0.2" data-path="workflow.html"><a href="workflow.html#workflow-input"><i class="fa fa-check"></i><b>12.0.2</b> Input Conversions</a></li>
<li class="chapter" data-level="12.0.3" data-path="workflow.html"><a href="workflow.html#workflow-input-data"><i class="fa fa-check"></i><b>12.0.3</b> Input Data</a></li>
<li class="chapter" data-level="12.0.4" data-path="workflow.html"><a href="workflow.html#workflow-input-initial"><i class="fa fa-check"></i><b>12.0.4</b> Initial Conditions</a></li>
<li class="chapter" data-level="12.0.5" data-path="workflow.html"><a href="workflow.html#workflow-met"><i class="fa fa-check"></i><b>12.0.5</b> Meteorological Data</a></li>
<li class="chapter" data-level="12.0.6" data-path="workflow.html"><a href="workflow.html#workflow-met-standard"><i class="fa fa-check"></i><b>12.0.6</b> Converting raw data to PEcAn standard</a></li>
<li class="chapter" data-level="12.0.7" data-path="workflow.html"><a href="workflow.html#workflow-met-downscale"><i class="fa fa-check"></i><b>12.0.7</b> Downscaling and gapfilling (optional)</a></li>
<li class="chapter" data-level="12.0.8" data-path="workflow.html"><a href="workflow.html#workflow-met-model"><i class="fa fa-check"></i><b>12.0.8</b> Converting from PEcAn standard to model-specific format</a></li>
<li class="chapter" data-level="12.0.9" data-path="workflow.html"><a href="workflow.html#workflow-traits"><i class="fa fa-check"></i><b>12.0.9</b> Traits</a></li>
<li class="chapter" data-level="12.0.10" data-path="workflow.html"><a href="workflow.html#workflow-metaanalysis"><i class="fa fa-check"></i><b>12.0.10</b> Meta Analysis</a></li>
<li class="chapter" data-level="12.0.11" data-path="workflow.html"><a href="workflow.html#workflow-modelconfig"><i class="fa fa-check"></i><b>12.0.11</b> Model Configuration</a></li>
<li class="chapter" data-level="12.0.12" data-path="workflow.html"><a href="workflow.html#workflow-modelrun"><i class="fa fa-check"></i><b>12.0.12</b> Run Execution</a></li>
<li class="chapter" data-level="12.0.13" data-path="workflow.html"><a href="workflow.html#workflow-postrun"><i class="fa fa-check"></i><b>12.0.13</b> Post Run Analysis</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pecan-models.html"><a href="pecan-models.html"><i class="fa fa-check"></i><b>13</b> PEcAn Models</a><ul>
<li class="chapter" data-level="13.0.1" data-path="pecan-models.html"><a href="pecan-models.html#models-biocro"><i class="fa fa-check"></i><b>13.0.1</b> BioCro</a></li>
<li class="chapter" data-level="13.0.2" data-path="pecan-models.html"><a href="pecan-models.html#introduction-1"><i class="fa fa-check"></i><b>13.0.2</b> Introduction</a></li>
<li class="chapter" data-level="13.0.3" data-path="pecan-models.html"><a href="pecan-models.html#pecan-configuration-file-additions"><i class="fa fa-check"></i><b>13.0.3</b> PEcAn configuration file additions</a></li>
<li class="chapter" data-level="13.0.4" data-path="pecan-models.html"><a href="pecan-models.html#model-specific-input-files"><i class="fa fa-check"></i><b>13.0.4</b> Model specific input files</a></li>
<li class="chapter" data-level="13.0.5" data-path="pecan-models.html"><a href="pecan-models.html#model-configuration-files"><i class="fa fa-check"></i><b>13.0.5</b> Model configuration files</a></li>
<li class="chapter" data-level="13.0.6" data-path="pecan-models.html"><a href="pecan-models.html#installation-notes"><i class="fa fa-check"></i><b>13.0.6</b> Installation notes</a></li>
<li class="chapter" data-level="13.0.7" data-path="pecan-models.html"><a href="pecan-models.html#models-clm"><i class="fa fa-check"></i><b>13.0.7</b> CLM</a></li>
<li class="chapter" data-level="13.0.8" data-path="pecan-models.html"><a href="pecan-models.html#models-dalec"><i class="fa fa-check"></i><b>13.0.8</b> DALEC</a></li>
<li class="chapter" data-level="13.0.9" data-path="pecan-models.html"><a href="pecan-models.html#models-ed"><i class="fa fa-check"></i><b>13.0.9</b> ED2</a></li>
<li class="chapter" data-level="13.0.10" data-path="pecan-models.html"><a href="pecan-models.html#models-gday"><i class="fa fa-check"></i><b>13.0.10</b> GDAY</a></li>
<li class="chapter" data-level="13.0.11" data-path="pecan-models.html"><a href="pecan-models.html#models-linkages"><i class="fa fa-check"></i><b>13.0.11</b> LINKAGES</a></li>
<li class="chapter" data-level="13.0.12" data-path="pecan-models.html"><a href="pecan-models.html#models-lpjguess"><i class="fa fa-check"></i><b>13.0.12</b> LPJ-GUESS</a></li>
<li class="chapter" data-level="13.0.13" data-path="pecan-models.html"><a href="pecan-models.html#models-maespa"><i class="fa fa-check"></i><b>13.0.13</b> MAESPA</a></li>
<li class="chapter" data-level="13.0.14" data-path="pecan-models.html"><a href="pecan-models.html#models-preles"><i class="fa fa-check"></i><b>13.0.14</b> PRELES</a></li>
<li class="chapter" data-level="13.0.15" data-path="pecan-models.html"><a href="pecan-models.html#models-sipnet"><i class="fa fa-check"></i><b>13.0.15</b> SiPNET</a></li>
<li class="chapter" data-level="13.0.16" data-path="pecan-models.html"><a href="pecan-models.html#models-stics"><i class="fa fa-check"></i><b>13.0.16</b> STICS</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html"><i class="fa fa-check"></i><b>14</b> Available Meteorological Drivers</a><ul>
<li class="chapter" data-level="14.0.1" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#ameriflux"><i class="fa fa-check"></i><b>14.0.1</b> Ameriflux</a></li>
<li class="chapter" data-level="14.0.2" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#amerifluxlbl"><i class="fa fa-check"></i><b>14.0.2</b> AmerifluxLBL</a></li>
<li class="chapter" data-level="14.0.3" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#fluxnet2015"><i class="fa fa-check"></i><b>14.0.3</b> Fluxnet2015</a></li>
<li class="chapter" data-level="14.0.4" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#narr"><i class="fa fa-check"></i><b>14.0.4</b> NARR</a></li>
<li class="chapter" data-level="14.0.5" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#cruncep"><i class="fa fa-check"></i><b>14.0.5</b> CRUNCEP</a></li>
<li class="chapter" data-level="14.0.6" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#cmip5"><i class="fa fa-check"></i><b>14.0.6</b> CMIP5</a></li>
<li class="chapter" data-level="14.0.7" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#nldas"><i class="fa fa-check"></i><b>14.0.7</b> NLDAS</a></li>
<li class="chapter" data-level="14.0.8" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#gldas"><i class="fa fa-check"></i><b>14.0.8</b> GLDAS</a></li>
<li class="chapter" data-level="14.0.9" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#paleon"><i class="fa fa-check"></i><b>14.0.9</b> PalEON</a></li>
<li class="chapter" data-level="14.0.10" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#fluxnetlathuile"><i class="fa fa-check"></i><b>14.0.10</b> FluxnetLaThuile</a></li>
<li class="chapter" data-level="14.0.11" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#geostreams"><i class="fa fa-check"></i><b>14.0.11</b> Geostreams</a></li>
<li class="chapter" data-level="14.0.12" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#era5"><i class="fa fa-check"></i><b>14.0.12</b> ERA5</a></li>
<li class="chapter" data-level="14.0.13" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#download-gfdl"><i class="fa fa-check"></i><b>14.0.13</b> Download GFDL</a></li>
<li class="chapter" data-level="14.0.14" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#cm3"><i class="fa fa-check"></i><b>14.0.14</b> CM3</a></li>
<li class="chapter" data-level="14.0.15" data-path="available-meteorological-drivers.html"><a href="available-meteorological-drivers.html#esm2m-esm2g"><i class="fa fa-check"></i><b>14.0.15</b> ESM2M &amp; ESM2G</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="database-sync.html"><a href="database-sync.html"><i class="fa fa-check"></i><b>15</b> Database synchronization</a><ul>
<li class="chapter" data-level="15.0.1" data-path="database-sync.html"><a href="database-sync.html#how-does-it-work"><i class="fa fa-check"></i><b>15.0.1</b> How does it work?</a></li>
<li class="chapter" data-level="15.0.2" data-path="database-sync.html"><a href="database-sync.html#set-up"><i class="fa fa-check"></i><b>15.0.2</b> Set up</a></li>
<li class="chapter" data-level="15.0.3" data-path="database-sync.html"><a href="database-sync.html#fetch-latest-data"><i class="fa fa-check"></i><b>15.0.3</b> Fetch latest data</a></li>
<li class="chapter" data-level="15.0.4" data-path="database-sync.html"><a href="database-sync.html#sharing-data"><i class="fa fa-check"></i><b>15.0.4</b> Sharing data</a></li>
<li class="chapter" data-level="15.0.5" data-path="database-sync.html"><a href="database-sync.html#automation"><i class="fa fa-check"></i><b>15.0.5</b> Automation</a></li>
<li class="chapter" data-level="15.0.6" data-path="database-sync.html"><a href="database-sync.html#database-maintentance"><i class="fa fa-check"></i><b>15.0.6</b> Database maintentance</a></li>
<li class="chapter" data-level="15.0.7" data-path="database-sync.html"><a href="database-sync.html#troubleshooting-1"><i class="fa fa-check"></i><b>15.0.7</b> Troubleshooting</a></li>
<li class="chapter" data-level="15.0.8" data-path="database-sync.html"><a href="database-sync.html#network-status-map"><i class="fa fa-check"></i><b>15.0.8</b> Network Status Map</a></li>
<li class="chapter" data-level="15.0.9" data-path="database-sync.html"><a href="database-sync.html#tasks"><i class="fa fa-check"></i><b>15.0.9</b> Tasks</a></li>
</ul></li>
<li class="chapter" data-level="16" data-path="standalone-tools-modules.html"><a href="standalone-tools-modules.html"><i class="fa fa-check"></i><b>16</b> Standalone tools (modules)</a><ul>
<li class="chapter" data-level="16.0.1" data-path="standalone-tools-modules.html"><a href="standalone-tools-modules.html#LoadData"><i class="fa fa-check"></i><b>16.0.1</b> Loading Data in PEcAn</a></li>
<li class="chapter" data-level="16.0.2" data-path="standalone-tools-modules.html"><a href="standalone-tools-modules.html#function-load_data"><i class="fa fa-check"></i><b>16.0.2</b> Function <code>load_data</code></a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>17</b> Shiny</a><ul>
<li class="chapter" data-level="17.1" data-path="shiny.html"><a href="shiny.html#testing-the-shiny-server"><i class="fa fa-check"></i><b>17.1</b> Testing the Shiny Server</a></li>
<li class="chapter" data-level="17.2" data-path="shiny.html"><a href="shiny.html#debugging-shiny-apps"><i class="fa fa-check"></i><b>17.2</b> Debugging Shiny Apps</a></li>
<li class="chapter" data-level="17.3" data-path="shiny.html"><a href="shiny.html#checking-log-files"><i class="fa fa-check"></i><b>17.3</b> Checking Log Files</a></li>
</ul></li>
<li class="chapter" data-level="18" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html"><i class="fa fa-check"></i><b>18</b> Adding to PEcAn</a><ul>
<li class="chapter" data-level="18.1" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#adding-model"><i class="fa fa-check"></i><b>18.1</b> Adding An Ecosystem Model</a><ul>
<li class="chapter" data-level="18.1.1" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#using-pecan-database"><i class="fa fa-check"></i><b>18.1.1</b> Using PEcAn Database</a></li>
<li class="chapter" data-level="18.1.2" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#define-model_type"><i class="fa fa-check"></i><b>18.1.2</b> Define MODEL_TYPE</a></li>
<li class="chapter" data-level="18.1.3" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#machine"><i class="fa fa-check"></i><b>18.1.3</b> MACHINE</a></li>
<li class="chapter" data-level="18.1.4" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#model-1"><i class="fa fa-check"></i><b>18.1.4</b> MODEL</a></li>
<li class="chapter" data-level="18.1.5" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#formats"><i class="fa fa-check"></i><b>18.1.5</b> FORMATS</a></li>
<li class="chapter" data-level="18.1.6" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#model_type---formats"><i class="fa fa-check"></i><b>18.1.6</b> MODEL_TYPE -&gt; Formats</a></li>
<li class="chapter" data-level="18.1.7" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#inputs-2"><i class="fa fa-check"></i><b>18.1.7</b> INPUTS</a></li>
<li class="chapter" data-level="18.1.8" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#add-plant-functional-types-pfts"><i class="fa fa-check"></i><b>18.1.8</b> Add Plant Functional Types (PFTs)</a></li>
<li class="chapter" data-level="18.1.9" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#adding-priors-for-each-variable"><i class="fa fa-check"></i><b>18.1.9</b> Adding Priors for Each Variable</a></li>
<li class="chapter" data-level="18.1.10" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#interface-modules"><i class="fa fa-check"></i><b>18.1.10</b> Interface Modules</a></li>
</ul></li>
<li class="chapter" data-level="18.2" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#example-met-conversion-wrapper-function"><i class="fa fa-check"></i><b>18.2</b> Example met conversion wrapper function</a></li>
<li class="chapter" data-level="18.3" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#NewInput"><i class="fa fa-check"></i><b>18.3</b> Adding input data</a><ul>
<li class="chapter" data-level="18.3.1" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#input-records-in-bety"><i class="fa fa-check"></i><b>18.3.1</b> Input records in BETY</a></li>
<li class="chapter" data-level="18.3.2" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#create-a-database-file-record-for-the-input-data"><i class="fa fa-check"></i><b>18.3.2</b> Create a database file record for the input data</a></li>
<li class="chapter" data-level="18.3.3" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#creating-a-new-input-record-in-bety"><i class="fa fa-check"></i><b>18.3.3</b> Creating a new Input record in BETY</a></li>
<li class="chapter" data-level="18.3.4" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#InputConversions"><i class="fa fa-check"></i><b>18.3.4</b> Adding a new input converter</a></li>
</ul></li>
<li class="chapter" data-level="18.4" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#adding-data-web"><i class="fa fa-check"></i><b>18.4</b> Pecan Data Ingest via Web Interface</a><ul>
<li class="chapter" data-level="18.4.1" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#loading-data-1"><i class="fa fa-check"></i><b>18.4.1</b> Loading Data</a></li>
<li class="chapter" data-level="18.4.2" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#local-upload-example"><i class="fa fa-check"></i><b>18.4.2</b> Local Upload Example</a></li>
<li class="chapter" data-level="18.4.3" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#creating-a-format-record"><i class="fa fa-check"></i><b>18.4.3</b> 3. Creating a format record</a></li>
</ul></li>
<li class="chapter" data-level="18.5" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#NewFormat"><i class="fa fa-check"></i><b>18.5</b> Creating a new format</a><ul>
<li class="chapter" data-level="18.5.1" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#formats-in-bety"><i class="fa fa-check"></i><b>18.5.1</b> Formats in BETY</a></li>
<li class="chapter" data-level="18.5.2" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#creating-a-new-format-in-bety"><i class="fa fa-check"></i><b>18.5.2</b> Creating a new format in BETY</a></li>
</ul></li>
<li class="chapter" data-level="18.6" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#NewBenchmark"><i class="fa fa-check"></i><b>18.6</b> Creating a new benchmark reference run</a></li>
<li class="chapter" data-level="18.7" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html#editing-records"><i class="fa fa-check"></i><b>18.7</b> Editing records</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html"><i class="fa fa-check"></i><b>19</b> Troubleshooting and Debugging PEcAn</a><ul>
<li class="chapter" data-level="19.0.1" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html#cookies-and-pecan-web-pages"><i class="fa fa-check"></i><b>19.0.1</b> Cookies and pecan web pages</a></li>
<li class="chapter" data-level="19.0.2" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html#warning-mkdir-function.mkdir-no-such-file-or-directory"><i class="fa fa-check"></i><b>19.0.2</b> <code>Warning: mkdir() [function.mkdir]: No such file or directory</code></a></li>
<li class="chapter" data-level="19.0.3" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html#after-creating-a-new-pft-the-tag-for-pft-not-passed-to-config.xml-in-ed"><i class="fa fa-check"></i><b>19.0.3</b> After creating a new PFT the <num> tag for PFT not passed to config.xml in ED</a></li>
<li class="chapter" data-level="19.1" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html#debugging"><i class="fa fa-check"></i><b>19.1</b> Debugging</a><ul>
<li class="chapter" data-level="19.1.1" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html#using-testsworkflow.r"><i class="fa fa-check"></i><b>19.1.1</b> Using <code>tests/workflow.R</code></a></li>
<li class="chapter" data-level="19.1.2" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html#useful-scripts"><i class="fa fa-check"></i><b>19.1.2</b> Useful scripts</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="20" data-path="database.html"><a href="database.html"><i class="fa fa-check"></i><b>20</b> BETY Database Administration</a><ul>
<li class="chapter" data-level="20.0.1" data-path="database.html"><a href="database.html#database-setup"><i class="fa fa-check"></i><b>20.0.1</b> Best practices</a></li>
<li class="chapter" data-level="20.0.2" data-path="database.html"><a href="database.html#backup-of-bety-database"><i class="fa fa-check"></i><b>20.0.2</b> Backup of BETY database</a></li>
<li class="chapter" data-level="20.0.3" data-path="database.html"><a href="database.html#restore-of-bety-database"><i class="fa fa-check"></i><b>20.0.3</b> Restore of BETY database</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="workflow-modules.html"><a href="workflow-modules.html"><i class="fa fa-check"></i><b>21</b> Workflow modules</a><ul>
<li class="chapter" data-level="21.0.1" data-path="workflow-modules.html"><a href="workflow-modules.html#overview-1"><i class="fa fa-check"></i><b>21.0.1</b> Overview</a></li>
<li class="chapter" data-level="21.0.2" data-path="workflow-modules.html"><a href="workflow-modules.html#load-settings"><i class="fa fa-check"></i><b>21.0.2</b> Load Settings:</a></li>
<li class="chapter" data-level="21.0.3" data-path="workflow-modules.html"><a href="workflow-modules.html#query-database"><i class="fa fa-check"></i><b>21.0.3</b> Query Database:</a></li>
<li class="chapter" data-level="21.0.4" data-path="workflow-modules.html"><a href="workflow-modules.html#meta-analysis"><i class="fa fa-check"></i><b>21.0.4</b> Meta Analysis:</a></li>
<li class="chapter" data-level="21.0.5" data-path="workflow-modules.html"><a href="workflow-modules.html#write-configuration-files"><i class="fa fa-check"></i><b>21.0.5</b> Write Configuration Files</a></li>
<li class="chapter" data-level="21.0.6" data-path="workflow-modules.html"><a href="workflow-modules.html#start-runs"><i class="fa fa-check"></i><b>21.0.6</b> Start Runs:</a></li>
<li class="chapter" data-level="21.0.7" data-path="workflow-modules.html"><a href="workflow-modules.html#get-model-output"><i class="fa fa-check"></i><b>21.0.7</b> Get Model Output</a></li>
<li class="chapter" data-level="21.0.8" data-path="workflow-modules.html"><a href="workflow-modules.html#ensemble-analysis"><i class="fa fa-check"></i><b>21.0.8</b> Ensemble Analysis</a></li>
<li class="chapter" data-level="21.0.9" data-path="workflow-modules.html"><a href="workflow-modules.html#sensitivity-analysis-variance-decomposition"><i class="fa fa-check"></i><b>21.0.9</b> Sensitivity Analysis, Variance Decomposition</a></li>
<li class="chapter" data-level="21.0.10" data-path="workflow-modules.html"><a href="workflow-modules.html#glossary"><i class="fa fa-check"></i><b>21.0.10</b> Glossary</a></li>
<li class="chapter" data-level="21.1" data-path="workflow-modules.html"><a href="workflow-modules.html#pecanvm"><i class="fa fa-check"></i><b>21.1</b> PEcAn Virtual Machine</a><ul>
<li class="chapter" data-level="21.1.1" data-path="workflow-modules.html"><a href="workflow-modules.html#aws-setup"><i class="fa fa-check"></i><b>21.1.1</b> AWS Setup</a></li>
<li class="chapter" data-level="21.1.2" data-path="workflow-modules.html"><a href="workflow-modules.html#porting-vm-to-aws"><i class="fa fa-check"></i><b>21.1.2</b> Porting VM to AWS</a></li>
<li class="chapter" data-level="21.1.3" data-path="workflow-modules.html"><a href="workflow-modules.html#set-up-multiple-instances-optional"><i class="fa fa-check"></i><b>21.1.3</b> Set up multiple instances (optional)</a></li>
</ul></li>
<li class="chapter" data-level="21.2" data-path="workflow-modules.html"><a href="workflow-modules.html#shiny-setup"><i class="fa fa-check"></i><b>21.2</b> Shiny Setup</a><ul>
<li class="chapter" data-level="21.2.1" data-path="workflow-modules.html"><a href="workflow-modules.html#install-the-shiny-r-package-and-shiny-server"><i class="fa fa-check"></i><b>21.2.1</b> Install the Shiny R package and Shiny server</a></li>
<li class="chapter" data-level="21.2.2" data-path="workflow-modules.html"><a href="workflow-modules.html#modify-the-shiny-configuration-file"><i class="fa fa-check"></i><b>21.2.2</b> Modify the shiny configuration file</a></li>
<li class="chapter" data-level="21.2.3" data-path="workflow-modules.html"><a href="workflow-modules.html#set-the-apache-proxy"><i class="fa fa-check"></i><b>21.2.3</b> Set the Apache proxy</a></li>
<li class="chapter" data-level="21.2.4" data-path="workflow-modules.html"><a href="workflow-modules.html#enable-and-start-the-shiny-server-and-restart-apache"><i class="fa fa-check"></i><b>21.2.4</b> Enable and start the shiny server, and restart apache</a></li>
<li class="chapter" data-level="21.2.5" data-path="workflow-modules.html"><a href="workflow-modules.html#troubleshooting-2"><i class="fa fa-check"></i><b>21.2.5</b> Troubleshooting</a></li>
<li class="chapter" data-level="21.2.6" data-path="workflow-modules.html"><a href="workflow-modules.html#further-reading"><i class="fa fa-check"></i><b>21.2.6</b> Further reading</a></li>
<li class="chapter" data-level="21.2.7" data-path="workflow-modules.html"><a href="workflow-modules.html#thredds-setup"><i class="fa fa-check"></i><b>21.2.7</b> Thredds Setup</a></li>
<li class="chapter" data-level="21.2.8" data-path="workflow-modules.html"><a href="workflow-modules.html#install-the-tomcat-8-and-thredds-webapp"><i class="fa fa-check"></i><b>21.2.8</b> Install the Tomcat 8 and Thredds webapp</a></li>
<li class="chapter" data-level="21.2.9" data-path="workflow-modules.html"><a href="workflow-modules.html#update-the-catalog"><i class="fa fa-check"></i><b>21.2.9</b> Update the catalog</a></li>
<li class="chapter" data-level="21.2.10" data-path="workflow-modules.html"><a href="workflow-modules.html#troubleshooting-3"><i class="fa fa-check"></i><b>21.2.10</b> Troubleshooting</a></li>
<li class="chapter" data-level="21.2.11" data-path="workflow-modules.html"><a href="workflow-modules.html#further-reading-1"><i class="fa fa-check"></i><b>21.2.11</b> Further reading</a></li>
<li class="chapter" data-level="21.2.12" data-path="workflow-modules.html"><a href="workflow-modules.html#osinstall"><i class="fa fa-check"></i><b>21.2.12</b> OS Specific Installations</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="22" data-path="docker-index.html"><a href="docker-index.html"><i class="fa fa-check"></i><b>22</b> Docker</a><ul>
<li class="chapter" data-level="22.1" data-path="docker-index.html"><a href="docker-index.html#docker-intro"><i class="fa fa-check"></i><b>22.1</b> Introduction to Docker?</a><ul>
<li class="chapter" data-level="22.1.1" data-path="docker-index.html"><a href="docker-index.html#what-is-docker"><i class="fa fa-check"></i><b>22.1.1</b> What is Docker?</a></li>
<li class="chapter" data-level="22.1.2" data-path="docker-index.html"><a href="docker-index.html#working-with-docker"><i class="fa fa-check"></i><b>22.1.2</b> Working with Docker</a></li>
<li class="chapter" data-level="22.1.3" data-path="docker-index.html"><a href="docker-index.html#docker-compose"><i class="fa fa-check"></i><b>22.1.3</b> <code>docker-compose</code></a></li>
</ul></li>
<li class="chapter" data-level="22.2" data-path="docker-index.html"><a href="docker-index.html#docker-quickstart"><i class="fa fa-check"></i><b>22.2</b> The PEcAn docker install process in detail</a><ul>
<li class="chapter" data-level="22.2.1" data-path="docker-index.html"><a href="docker-index.html#pecan-setup-compose-configure"><i class="fa fa-check"></i><b>22.2.1</b> Configure docker-compose</a></li>
<li class="chapter" data-level="22.2.2" data-path="docker-index.html"><a href="docker-index.html#pecan-docker-quickstart-init"><i class="fa fa-check"></i><b>22.2.2</b> Initialize PEcAn (first time only)</a></li>
<li class="chapter" data-level="22.2.3" data-path="docker-index.html"><a href="docker-index.html#docker-quickstart-troubleshooting"><i class="fa fa-check"></i><b>22.2.3</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="docker-index.html"><a href="docker-index.html#pecan-docker"><i class="fa fa-check"></i><b>22.3</b> PEcAn Docker Architecture</a><ul>
<li class="chapter" data-level="22.3.1" data-path="docker-index.html"><a href="docker-index.html#pecan-docker-overview"><i class="fa fa-check"></i><b>22.3.1</b> Overview</a></li>
<li class="chapter" data-level="22.3.2" data-path="docker-index.html"><a href="docker-index.html#pecan-docker-compose"><i class="fa fa-check"></i><b>22.3.2</b> PEcAn’s <code>docker-compose</code></a></li>
<li class="chapter" data-level="22.3.3" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-structure"><i class="fa fa-check"></i><b>22.3.3</b> Top-level structure</a></li>
<li class="chapter" data-level="22.3.4" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-traefik"><i class="fa fa-check"></i><b>22.3.4</b> <code>traefik</code></a></li>
<li class="chapter" data-level="22.3.5" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-portainer"><i class="fa fa-check"></i><b>22.3.5</b> <code>portainer</code></a></li>
<li class="chapter" data-level="22.3.6" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-minio"><i class="fa fa-check"></i><b>22.3.6</b> <code>minio</code></a></li>
<li class="chapter" data-level="22.3.7" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-thredds"><i class="fa fa-check"></i><b>22.3.7</b> <code>thredds</code></a></li>
<li class="chapter" data-level="22.3.8" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-postgres"><i class="fa fa-check"></i><b>22.3.8</b> <code>postgres</code></a></li>
<li class="chapter" data-level="22.3.9" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-rabbitmq"><i class="fa fa-check"></i><b>22.3.9</b> <code>rabbitmq</code></a></li>
<li class="chapter" data-level="22.3.10" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-bety"><i class="fa fa-check"></i><b>22.3.10</b> <code>bety</code></a></li>
<li class="chapter" data-level="22.3.11" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-docs"><i class="fa fa-check"></i><b>22.3.11</b> <code>docs</code></a></li>
<li class="chapter" data-level="22.3.12" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-web"><i class="fa fa-check"></i><b>22.3.12</b> <code>web</code></a></li>
<li class="chapter" data-level="22.3.13" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-executor"><i class="fa fa-check"></i><b>22.3.13</b> <code>executor</code></a></li>
<li class="chapter" data-level="22.3.14" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-monitor"><i class="fa fa-check"></i><b>22.3.14</b> <code>monitor</code></a></li>
<li class="chapter" data-level="22.3.15" data-path="docker-index.html"><a href="docker-index.html#pecan-dc-models"><i class="fa fa-check"></i><b>22.3.15</b> Model-specific containers</a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="docker-index.html"><a href="docker-index.html#model-docker"><i class="fa fa-check"></i><b>22.4</b> Models using Docker</a><ul>
<li class="chapter" data-level="22.4.1" data-path="docker-index.html"><a href="docker-index.html#model-docker-json-file"><i class="fa fa-check"></i><b>22.4.1</b> Model information</a></li>
<li class="chapter" data-level="22.4.2" data-path="docker-index.html"><a href="docker-index.html#model-docker-Dockerfile"><i class="fa fa-check"></i><b>22.4.2</b> Model build</a></li>
<li class="chapter" data-level="22.4.3" data-path="docker-index.html"><a href="docker-index.html#common-docker-problems"><i class="fa fa-check"></i><b>22.4.3</b> Common problems</a></li>
<li class="chapter" data-level="22.4.4" data-path="docker-index.html"><a href="docker-index.html#debugging-missing-libraries"><i class="fa fa-check"></i><b>22.4.4</b> Debugging missing libraries</a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="docker-index.html"><a href="docker-index.html#docker-build-images"><i class="fa fa-check"></i><b>22.5</b> Building and modifying images</a><ul>
<li class="chapter" data-level="22.5.1" data-path="docker-index.html"><a href="docker-index.html#docker-local-devel"><i class="fa fa-check"></i><b>22.5.1</b> Local development and testing with Docker</a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="docker-index.html"><a href="docker-index.html#docker-troubleshooting"><i class="fa fa-check"></i><b>22.6</b> Troubleshooting Docker</a><ul>
<li class="chapter" data-level="22.6.1" data-path="docker-index.html"><a href="docker-index.html#package-not-available-while-building-images"><i class="fa fa-check"></i><b>22.6.1</b> “Package not available” while building images</a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="docker-index.html"><a href="docker-index.html#docker-migrate"><i class="fa fa-check"></i><b>22.7</b> Migrating PEcAn from VM to Docker</a><ul>
<li class="chapter" data-level="22.7.1" data-path="docker-index.html"><a href="docker-index.html#running-bety-as-a-docker-container"><i class="fa fa-check"></i><b>22.7.1</b> Running BETY as a docker container</a></li>
</ul></li>
<li class="chapter" data-level="22.8" data-path="docker-index.html"><a href="docker-index.html#pecan-api"><i class="fa fa-check"></i><b>22.8</b> The PEcAn Docker API</a></li>
<li class="chapter" data-level="22.9" data-path="docker-index.html"><a href="docker-index.html#rabbitmq"><i class="fa fa-check"></i><b>22.9</b> RabbitMQ</a><ul>
<li class="chapter" data-level="22.9.1" data-path="docker-index.html"><a href="docker-index.html#rabbitmq-basics-sender"><i class="fa fa-check"></i><b>22.9.1</b> Producer – <code>sender.py</code></a></li>
<li class="chapter" data-level="22.9.2" data-path="docker-index.html"><a href="docker-index.html#rabbitmq-basics-receiver"><i class="fa fa-check"></i><b>22.9.2</b> Consumer – <code>receiver.py</code></a></li>
<li class="chapter" data-level="22.9.3" data-path="docker-index.html"><a href="docker-index.html#rabbitmq-web"><i class="fa fa-check"></i><b>22.9.3</b> RabbitMQ and the PEcAn web interface</a></li>
<li class="chapter" data-level="22.9.4" data-path="docker-index.html"><a href="docker-index.html#rabbitmq-xml"><i class="fa fa-check"></i><b>22.9.4</b> RabbitMQ in the PEcAn XML</a></li>
<li class="chapter" data-level="22.9.5" data-path="docker-index.html"><a href="docker-index.html#rabbitmq-dockerfile"><i class="fa fa-check"></i><b>22.9.5</b> RabbitMQ configuration in Dockerfiles</a></li>
<li class="chapter" data-level="22.9.6" data-path="docker-index.html"><a href="docker-index.html#rabbitmq-case-study"><i class="fa fa-check"></i><b>22.9.6</b> Case study: PEcAn web interface</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="23" data-path="pecan-remote.html"><a href="pecan-remote.html"><i class="fa fa-check"></i><b>23</b> Remote execution with PEcAn</a><ul>
<li class="chapter" data-level="23.1" data-path="pecan-remote.html"><a href="pecan-remote.html#basics-of-ssh"><i class="fa fa-check"></i><b>23.1</b> Basics of SSH</a></li>
<li class="chapter" data-level="23.2" data-path="pecan-remote.html"><a href="pecan-remote.html#ssh-authentication-password-vs.ssh-key"><i class="fa fa-check"></i><b>23.2</b> SSH authentication – password vs. SSH key</a></li>
<li class="chapter" data-level="23.3" data-path="pecan-remote.html"><a href="pecan-remote.html#ssh-tunneling"><i class="fa fa-check"></i><b>23.3</b> SSH tunneling</a></li>
<li class="chapter" data-level="23.4" data-path="pecan-remote.html"><a href="pecan-remote.html#ssh-tunnels-and-pecan"><i class="fa fa-check"></i><b>23.4</b> SSH tunnels and PEcAn</a></li>
<li class="chapter" data-level="23.5" data-path="pecan-remote.html"><a href="pecan-remote.html#basic-remote-execute-functions"><i class="fa fa-check"></i><b>23.5</b> Basic remote execute functions</a></li>
<li class="chapter" data-level="23.6" data-path="pecan-remote.html"><a href="pecan-remote.html#remote-model-execution-with-pecan"><i class="fa fa-check"></i><b>23.6</b> Remote model execution with PEcAn</a></li>
<li class="chapter" data-level="23.7" data-path="pecan-remote.html"><a href="pecan-remote.html#xml-configuration"><i class="fa fa-check"></i><b>23.7</b> XML configuration</a></li>
<li class="chapter" data-level="23.8" data-path="pecan-remote.html"><a href="pecan-remote.html#configuration-for-pecan-web-interface"><i class="fa fa-check"></i><b>23.8</b> Configuration for PEcAn web interface</a></li>
<li class="chapter" data-level="23.9" data-path="pecan-remote.html"><a href="pecan-remote.html#running-pecan-code-for-remotely"><i class="fa fa-check"></i><b>23.9</b> Running PEcAn code for remotely</a></li>
<li class="chapter" data-level="23.10" data-path="pecan-remote.html"><a href="pecan-remote.html#special-case-geo.bu.edu"><i class="fa fa-check"></i><b>23.10</b> Special case: <code>geo.bu.edu</code></a></li>
</ul></li>
<li class="chapter" data-level="24" data-path="data-assimilation-with-dart.html"><a href="data-assimilation-with-dart.html"><i class="fa fa-check"></i><b>24</b> Data assimilation with DART</a></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="25" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>25</b> Miscellaneous</a><ul>
<li class="chapter" data-level="25.1" data-path="miscellaneous.html"><a href="miscellaneous.html#todo"><i class="fa fa-check"></i><b>25.1</b> TODO</a></li>
<li class="chapter" data-level="25.2" data-path="miscellaneous.html"><a href="miscellaneous.html#using-the-pecan-download.file-function"><i class="fa fa-check"></i><b>25.2</b> Using the PEcAn download.file() function</a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>26</b> FAQ</a></li>
<li class="chapter" data-level="27" data-path="pecan-project-used-in-courses.html"><a href="pecan-project-used-in-courses.html"><i class="fa fa-check"></i><b>27</b> PEcAn Project Used in Courses</a><ul>
<li class="chapter" data-level="27.0.1" data-path="pecan-project-used-in-courses.html"><a href="pecan-project-used-in-courses.html#university-classes"><i class="fa fa-check"></i><b>27.0.1</b> University classes</a></li>
<li class="chapter" data-level="27.0.2" data-path="pecan-project-used-in-courses.html"><a href="pecan-project-used-in-courses.html#summer-courses-workshops"><i class="fa fa-check"></i><b>27.0.2</b> Summer Courses / Workshops</a></li>
<li class="chapter" data-level="27.0.3" data-path="pecan-project-used-in-courses.html"><a href="pecan-project-used-in-courses.html#selected-publications"><i class="fa fa-check"></i><b>27.0.3</b> Selected Publications</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="package-dependencies.html"><a href="package-dependencies.html"><i class="fa fa-check"></i><b>28</b> Package Dependencies</a><ul>
<li class="chapter" data-level="28.1" data-path="package-dependencies.html"><a href="package-dependencies.html#executive-summary-what-to-usually-do"><i class="fa fa-check"></i><b>28.1</b> Executive Summary: What to usually do</a></li>
<li class="chapter" data-level="28.2" data-path="package-dependencies.html"><a href="package-dependencies.html#big-picture-whats-possible-to-do"><i class="fa fa-check"></i><b>28.2</b> Big Picture: What’s possible to do</a></li>
<li class="chapter" data-level="28.3" data-path="package-dependencies.html"><a href="package-dependencies.html#declaring-dependencies-depends-suggests-imports"><i class="fa fa-check"></i><b>28.3</b> Declaring Dependencies: Depends, Suggests, Imports</a></li>
<li class="chapter" data-level="28.4" data-path="package-dependencies.html"><a href="package-dependencies.html#importing-functions-use-roxygen"><i class="fa fa-check"></i><b>28.4</b> Importing Functions: Use Roxygen</a></li>
<li class="chapter" data-level="28.5" data-path="package-dependencies.html"><a href="package-dependencies.html#loading-code-dont-but-use-requirenamespace-when-you-do"><i class="fa fa-check"></i><b>28.5</b> Loading Code: Don’t… But Use <code>requireNamespace</code> When You Do</a></li>
<li class="chapter" data-level="28.6" data-path="package-dependencies.html"><a href="package-dependencies.html#installing-dependencies-let-the-machines-do-it"><i class="fa fa-check"></i><b>28.6</b> Installing dependencies: Let the machines do it</a></li>
</ul></li>
<li class="chapter" data-level="29" data-path="appendix-testthat.html"><a href="appendix-testthat.html"><i class="fa fa-check"></i><b>29</b> Testing with the <code>testthat</code> package</a><ul>
<li class="chapter" data-level="29.1" data-path="appendix-testthat.html"><a href="appendix-testthat.html#list-of-expectations"><i class="fa fa-check"></i><b>29.1</b> List of Expectations</a></li>
<li class="chapter" data-level="29.2" data-path="appendix-testthat.html"><a href="appendix-testthat.html#basic-use-of-the-testthat-package"><i class="fa fa-check"></i><b>29.2</b> Basic use of the <code>testthat</code> package</a></li>
<li class="chapter" data-level="29.3" data-path="appendix-testthat.html"><a href="appendix-testthat.html#data-for-tests"><i class="fa fa-check"></i><b>29.3</b> Data for tests</a></li>
<li class="chapter" data-level="29.4" data-path="appendix-testthat.html"><a href="appendix-testthat.html#settings-1"><i class="fa fa-check"></i><b>29.4</b> Settings</a></li>
<li class="chapter" data-level="29.5" data-path="appendix-testthat.html"><a href="appendix-testthat.html#helper-functions-for-unit-tests"><i class="fa fa-check"></i><b>29.5</b> Helper functions for unit tests</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="developer-devtools.html"><a href="developer-devtools.html"><i class="fa fa-check"></i><b>30</b> <code>devtools</code> package</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Predictive Ecosystem Analyzer</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="docker-index" class="section level1">
<h1><span class="header-section-number">22</span> Docker</h1>
<p>This chapter describes the PEcAn Docker container infrastructure.
It contains the following sections:</p>
<ul>
<li><a href="docker-index.html#docker-intro">Introduction to Docker</a> – Brief introduction to Docker and <code>docker-compose</code></li>
<li><a href="docker-index.html#docker-quickstart">Docker quickstart</a> – Brief tutorial for setting up a Docker-based PEcAn instance</li>
<li><a href="docker-index.html#pecan-docker">PEcAn Docker Architecture</a> – Detailed description of the containers comprising the PEcAn Docker-based infrastructure</li>
<li><a href="docker-index.html#model-docker">Dockerfiles for models</a> – General guide for writing Dockerfiles for new models</li>
<li><a href="docker-index.html#docker-build-images">Building and modifying images</a></li>
<li><span id="docker-troubleshooting">Troubleshooting Docker</span></li>
<li><a href="docker-index.html#docker-migrate">Migrating from VM to Docker</a> – Steps to migrate from running PEcAn on a VM to a docker.</li>
</ul>

<div id="docker-intro" class="section level2">
<h2><span class="header-section-number">22.1</span> Introduction to Docker?</h2>
<ul>
<li><a href="docker-index.html#what-is-docker">What is Docker</a></li>
<li><a href="docker-index.html#working-with-docker">Working with Docker</a></li>
<li><span id="docker-compose"><code>docker-compose</code></span></li>
</ul>
<div id="what-is-docker" class="section level3">
<h3><span class="header-section-number">22.1.1</span> What is Docker?</h3>
<p>For a quick and accessible introduction to Docker, we suggest this YouTube video: <a href="https://www.youtube.com/watch?v=YFl2mCHdv24">Learn Docker in 12 Minutes</a>.</p>
<p>For more comprehensive Docker documentation, we refer you to the <a href="https://docs.docker.com/">Docker documentation website</a>.</p>
<p>For a useful analogy for Docker containerization, we refer you to the webcomic <a href="https://xkcd.com/1988/">xkcd</a>.</p>
<p>Docker is a technology for encapsulating software in “containers”, somewhat similarly to virtual machines.
Like virtual machines, Docker containers facilitate software distribution by bundling the software with all of its dependencies in a single location.
Unlike virtual machines, Docker containers are meant to only run a single service or process and are build on top of existing services provided by the host OS (such as disk access, networking, memory management etc.).</p>
<p>In Docker, an <strong>image</strong> refers to a binary snapshot of a piece of software and all of its dependencies.
A <strong>container</strong> refers to a running instance of a particular image.
A good rule of thumb is that each container should be responsible for no more than one running process.
A software <strong>stack</strong> refers to a collection of containers, each responsible for its own process, working together to power a particular application.
Docker makes it easy to run multiple software stacks at the same time in parallel on the same machine.
Stacks can be given a unique name, which is passed along as a prefix to all their containers.
Inside these stacks, containers can communicate using generic names not prefixed with the stack name, making it easy to deploy multiple stacks with the same internal configuration.
Containers within the same stack communicate with each other via a common <strong>network</strong>.
Like virtual machines or system processes, Docker stacks can also be instructed to open specific ports to facilitate communication with the host and other machines.</p>
<p>The PEcAn database BETY provides an instructive case-study.
BETY is comprised of two core processes – a PostgreSQL database, and a web-based front-end to that database (Apache web server with Ruby on Rails).
Running BETY as a “Dockerized” application therefore involves two containers – one for the PostgreSQL database, and one for the web server.
We could build these containers ourselves by starting from a container with nothing but the essentials of a particular operating system, but we can save some time and effort by starting with an <a href="https://hub.docker.com/_/postgres/">existing image for PostgreSQL</a> from Docker Hub.
When starting a Dockerized BETY, we start the PostgreSQL container first, then start the BETY container telling it how to communicate with the PostgreSQL container.
To upgrade an existing BETY instance, we stop the BETY container, download the latest version, tell it to upgrade the database, and re-start the BETY container.
There is no need to install new dependencies for BETY since they are all shipped as part of the container.</p>
<p>The PEcAn Docker architecture is designed to facilitate installation and maintenance on a variety of systems by eliminating the need to install and maintain complex system dependencies (such as PostgreSQL, Apache web server, and Shiny server).
Furthermore, using separate Docker containers for each ecosystem model helps avoid clashes between different software version requirements of different models (e.g. some models require GCC &lt;5.0, while others may require GCC &gt;=5.0).</p>
<p>The full PEcAn Docker stack is described in more detail in the <a href="docker-index.html#pecan-docker">next section</a>.</p>
</div>
<div id="working-with-docker" class="section level3">
<h3><span class="header-section-number">22.1.2</span> Working with Docker</h3>
<p>To run an image, you can use the Docker command line interface.
For example, the following runs a PostgreSQL image based on the <a href="https://hub.docker.com/r/mdillon/postgis/">pre-existing PostGIS image</a> by <code>mdillon</code>:</p>
<div class="sourceCode" id="cb279"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb279-1" data-line-number="1"><span class="ex">docker</span> run \</a>
<a class="sourceLine" id="cb279-2" data-line-number="2">    --detach \</a>
<a class="sourceLine" id="cb279-3" data-line-number="3">    --rm \</a>
<a class="sourceLine" id="cb279-4" data-line-number="4">    --name postgresql \</a>
<a class="sourceLine" id="cb279-5" data-line-number="5">    --network pecan \</a>
<a class="sourceLine" id="cb279-6" data-line-number="6">    --publish 9876:5432 \</a>
<a class="sourceLine" id="cb279-7" data-line-number="7">    --volume <span class="va">${PWD}</span>/postgres:/var/lib/postgresql/data \</a>
<a class="sourceLine" id="cb279-8" data-line-number="8">    mdillon/postgis:9.6-alpine</a></code></pre></div>
<p>This will start the PostgreSQL+PostGIS container.
The following options were used:</p>
<ul>
<li><code>--detach</code> makes the container run in the background.</li>
<li><code>--rm</code> removes the container when it is finished (make sure to use the volume below).</li>
<li><code>--name</code> the name of the container, also the hostname of the container which can be used by other docker containers in the same network inside docker.</li>
<li><code>--network pecan</code> the network that the container should be running in, this leverages of network isolation in docker and allows this container to be connected to by others using the postgresql hostname.</li>
<li><code>--publish</code> exposes the port to the outside world, this is like ssh, and maps port 9876 to port 5432 in the docker container</li>
<li><code>--volume</code> maps a folder on your local machine to the machine in the container. This allows you to save data on your local machine.</li>
<li><code>mdillon/postgis:9.6-alpine</code> is the actual image that will be run, in this case it comes from the group/person mdillon, the container is postgis and the version 9.6-alpine (version 9.6 build on alpine linux).</li>
</ul>
<p>Other options that might be used:</p>
<ul>
<li><code>--tty</code> allocate a pseudo-TTY to send stdout and stderr back to the console.</li>
<li><code>--interactive</code> keeps stdin open so the user can interact with the application running.</li>
<li><code>--env</code> sets environment variables, these are often used to change the behavior of the docker container.</li>
</ul>
<p>To see a list of all running containers you can use the following command:</p>
<div class="sourceCode" id="cb280"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb280-1" data-line-number="1"><span class="ex">docker</span> ps</a></code></pre></div>
<p>To see the log files of this container you use the following command (you can either use their name or id as returned by <code>docker ps</code>). The <code>-f</code> flag will follow the <code>stdout</code>/<code>stderr</code> from the container, use <code>Ctrl-C</code> to stop following the <code>stdout</code>/<code>stderr</code>.</p>
<div class="sourceCode" id="cb281"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb281-1" data-line-number="1"><span class="ex">docker</span> logs -f postgresql</a></code></pre></div>
<p>To stop a running container use:</p>
<pre><code>docker stop postgresql</code></pre>
<p>Containers that are running in the foreground (without the <code>--detach</code>) can be stopped by pressing <code>Ctrl-C</code>. Any containers running in the background (with <code>--detach</code>) will continue running until the machine is restarted or the container is stopped using <code>docker stop</code>.</p>
</div>
<div id="docker-compose" class="section level3">
<h3><span class="header-section-number">22.1.3</span> <code>docker-compose</code></h3>
<p>For a quick introduction to <code>docker-compose</code>, we recommend the following YouTube video: <a href="https://www.youtube.com/watch?v=Qw9zlE3t8Ko">Docker Compose in 12 Minutes</a>.</p>
<p>The complete <code>docker-compose</code> references can be found on the <a href="https://docs.docker.com/compose/">Docker documentation website</a>.</p>
<p><code>docker-compose</code> provides a convenient way to configure and run a multi-container Docker stack.
Basically, a <code>docker-compose</code> setup consists of a list of containers and their configuration parameters, which are then internally converted into a bunch of <code>docker</code> commands.
To configure BETY as described above, we can use a <code>docker-compose.yml</code> file like the following:</p>
<div class="sourceCode" id="cb283"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb283-1" data-line-number="1"><span class="fu">version:</span><span class="at"> </span><span class="st">&quot;3&quot;</span></a>
<a class="sourceLine" id="cb283-2" data-line-number="2"><span class="fu">services:</span></a>
<a class="sourceLine" id="cb283-3" data-line-number="3">  <span class="fu">postgres:</span></a>
<a class="sourceLine" id="cb283-4" data-line-number="4">    <span class="fu">image:</span><span class="at"> mdillon/postgis:9.5</span></a>
<a class="sourceLine" id="cb283-5" data-line-number="5">  <span class="fu">bety:</span></a>
<a class="sourceLine" id="cb283-6" data-line-number="6">    <span class="fu">image:</span><span class="at"> pecan/bety</span></a>
<a class="sourceLine" id="cb283-7" data-line-number="7">    <span class="fu">depends_on:</span></a>
<a class="sourceLine" id="cb283-8" data-line-number="8">      <span class="kw">-</span> postgres</a></code></pre></div>
<p>This simple file allows us to bring up a full BETY application with both database and BETY application. The BETY app will not be brought up until the database container has started.</p>
<p>You can now start this application by changing into the same directory as the <code>docker-compose.yml</code> file (<code>cd /path/to/file</code>) and then running:</p>
<pre><code>docker-compose up</code></pre>
<p>This will start the application, and you will see the log files for the 2 different containers.</p>

</div>
</div>
<div id="docker-quickstart" class="section level2">
<h2><span class="header-section-number">22.2</span> The PEcAn docker install process in detail</h2>
<div id="pecan-setup-compose-configure" class="section level3">
<h3><span class="header-section-number">22.2.1</span> Configure docker-compose</h3>
<p>This section will let you download some configuration files. The documentation provides links to the latest released version (master branch in GitHub) or the develop version that we are working on (develop branch in GitHub) which will become the next release. If you cloned the PEcAn GitHub repository you can use <code>git checkout &lt;branch&gt;</code> to switch branches.</p>
<p>The PEcAn Docker stack is configured using a <code>docker-compose.yml</code> file. You can download just this file directly from GitHub <a href="https://raw.githubusercontent.com/PecanProject/pecan/master/docker-compose.yml">latest</a> or <a href="https://raw.githubusercontent.com/PecanProject/pecan/master/docker-compose.yml">develop</a>. You can also find this file in the root of cloned PEcAn GitHub repository. There is no need to edit the <code>docker-compose.yml</code> file. You can use either the <code>.env</code> file to change some of the settings, or the <code>docker-compose.override.yml</code> file to modify the <code>docker-compose.yml</code> file. This makes it easier for you to get an updated version of the <code>docker-compose.yml</code> file and not lose any chances you have made to it.</p>
<p>Some of the settings in the <code>docker-compose.yml</code> can be set using a <code>.env</code> file. You can download either the <a href="https://raw.githubusercontent.com/PecanProject/pecan/master/docker/env.example">latest</a> or the <a href="https://raw.githubusercontent.com/PecanProject/pecan/develop/docker/env.example">develop</a> version. If you have cloned the GitHub repository it is also located in the docker folder. This file should be called <code>.env</code> and be placed in the same folder as your <code>docker-compose.yml</code> file. This file will allow you to set which version of PEcAn or BETY to use. See the comments in this file to control the settings. Option you might want to set are:</p>
<ul>
<li><code>PECAN_VERSION</code> : The docker images to use for PEcAn. The default is <code>latest</code> which is the latest released version of PEcAn. Setting this to <code>develop</code> will result in using the version of PEcAn which will become the next release.</li>
<li><code>PECAN_FQDN</code> : Is the name of the server where PEcAn is running. This is what is used to register all files generated by this version of PEcAn (see also <code>TRAEFIK_HOST</code>).</li>
<li><code>PECAN_NAME</code> : A short name of this PEcAn server that is shown in the pull down menu and might be easier to recognize.</li>
<li><code>BETY_VERSION</code> : This controls the version of BETY. The default is <code>latest</code> which is the latest released version of BETY. Setting this to <code>develop</code> will result in using the version of BETY which will become the next release.</li>
<li><code>TRAEFIK_HOST</code> : Should be the FQDN of the server, this is needed when generating a SSL certificate. For SSL certificates you will need to set <code>TRAEFIK_ACME_ENABLE</code> as well as <code>TRAEFIK_ACME_EMAIL</code>.</li>
<li><code>TRAEFIK_IPFILTER</code> : is used to limit access to certain resources, such as RabbitMQ and the Traefik dashboard.</li>
</ul>
<p>A final file, which is optional, is a <code>docker-compose.override.yml</code>. You can download a version for the <a href="https://raw.githubusercontent.com/PecanProject/pecan/master/docker/docker-compose.example.yml">latest</a> and <a href="https://raw.githubusercontent.com/PecanProject/pecan/develop/docker/docker-compose.example.yml">develop</a> versions. If you have cloned the GitHub repository it is located in the docker folder. Use this file as an example of what you can do, only copy the pieces over that you really need. This will allow you to make changes to the docker-compose file for your local installation. You can use this to add additional containers to your stack, change the path where docker stores the data for the containers, or you can use this to open up the postgresql port.</p>
<div class="sourceCode" id="cb285"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb285-1" data-line-number="1"><span class="fu">version:</span><span class="at"> </span><span class="st">&quot;3&quot;</span></a>
<a class="sourceLine" id="cb285-2" data-line-number="2"></a>
<a class="sourceLine" id="cb285-3" data-line-number="3"><span class="fu">services:</span></a>
<a class="sourceLine" id="cb285-4" data-line-number="4">  <span class="co"># expose database to localhost for ease of access</span></a>
<a class="sourceLine" id="cb285-5" data-line-number="5">  <span class="fu">postgres:</span></a>
<a class="sourceLine" id="cb285-6" data-line-number="6">    <span class="fu">ports:</span></a>
<a class="sourceLine" id="cb285-7" data-line-number="7">      <span class="kw">-</span> <span class="fu">5432:</span><span class="at">5432</span></a></code></pre></div>
<p>Once you have the <code>docker-compose.yml</code> file as well as the optional <code>.env</code> and <code>docker-compose.override.yml</code> in a folder you can start the PEcAn stack. The following instructions assume you are in the same directory as the file (if not, <code>cd</code> into it).</p>
<p>In the rest of this section we will use a few arguments for the <code>docker-compose</code> application. The location of these arguments are important. The general syntax of <code>docker-compose</code> is <code>docker-compose &lt;ARGUMENTS FOR DOCKER COMPOSE&gt; &lt;COMMAND&gt; &lt;ARGUMENTS FOR COMMAND&gt; [SERVICES]</code>. More generally, <code>docker-compose</code> options are very sensitive to their location relative to other commands in the same line – that is, <code>docker-compose -f /my/docker-compose.yml -p pecan up -d postgres</code> is <em>not</em> the same as <code>docker-compose -d postgres -p pecan up -f /my/docker-compose.yml</code>. If expected ever don’t seem to be working, check that the arguments are in the right order.)</p>
<ul>
<li><code>-f &lt;filename&gt;</code> : <em>ARGUMENTS FOR DOCKER COMPOSE</em> : Allows you to specify a docker-compose.yml file explicitly. You can use this argument multiple times. Default is to use the docker-compose.yml and docker-compose.override.yml in your current folder.</li>
<li><code>-p &lt;projectname&gt;</code> : <em>ARGUMENTS FOR DOCKER COMPOSE</em> : Project name, all volumes, networks, and containers will be prefixed with this argument. The default value is to use the current folder name.</li>
<li><code>-d</code> : <em>ARGUMENTS FOR <code>up</code> COMMAND</em> : Will start all the containers in the background and return back to the command shell.</li>
</ul>
<p>If no services as added to the docker-compose command all services possible will be started.</p>
</div>
<div id="pecan-docker-quickstart-init" class="section level3">
<h3><span class="header-section-number">22.2.2</span> Initialize PEcAn (first time only)</h3>
<p>Before you can start to use PEcAn for the first time you will need to initialize the database (and optionally add some data). The following two sections will <a href="docker-index.html#pecan-docker-quickstart-init-db">first initialize the database</a> and <a href="docker-index.html#pecan-docker-quickstart-init-data">secondly add some data</a> to the system.</p>
<div id="pecan-docker-quickstart-init-db" class="section level4">
<h4><span class="header-section-number">22.2.2.1</span> Initialize the PEcAn database</h4>
<p>The commands described in this section will set up the PEcAn database (BETY) and pre-load it with some common “default” data.</p>
<div class="sourceCode" id="cb286"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb286-1" data-line-number="1"><span class="ex">docker-compose</span> -p pecan up -d postgres</a>
<a class="sourceLine" id="cb286-2" data-line-number="2"></a>
<a class="sourceLine" id="cb286-3" data-line-number="3"><span class="co"># If you have a custom docker-compose file:</span></a>
<a class="sourceLine" id="cb286-4" data-line-number="4"><span class="co"># docker-compose -f /path/to/my-docker-compose.yml -p pecan up -d postgres</span></a></code></pre></div>
<p>The breakdown of this command is as follows:</p>
<ul>
<li><code>-p pecan</code> – This tells <code>docker-compose</code> to do all of this as part of a “project” <code>-p</code> we’ll call <code>pecan</code>. By default, the project name is set to the name of the current working directory. The project name will be used as a prefix to all containers started by this <code>docker-compose</code> instance (so, if we have a service called <code>postgres</code>, this will create a container called <code>pecan_postgres</code>).</li>
<li><code>up -d</code> – <code>up</code> is a command that initializes the containers. Initialization involves downloading and building the target containers and any containers they depend on, and then running them. Normally, this happens in the foreground, printing logs directly to <code>stderr</code>/<code>stdout</code> (meaning you would have to interrupt it with Ctrl-C), but the <code>-d</code> flag forces this to happen more quietly and in the background.</li>
<li><code>postgres</code> – This indicates that we only want to initialize the service called <code>postgres</code> (and its dependencies). If we omitted this, <code>docker-compose</code> would initialize all containers in the stack.</li>
</ul>
<p>The end result of this command is to initialize a “blank” PostGIS container that will run in the background.
This container is not connected to any data (yet), and is basically analogous to just installing and starting PostgreSQL to your system.
As a side effect, the above command will also create blank data <a href="https://docs.docker.com/storage/volumes/">“volumes”</a> and a <a href="https://docs.docker.com/network/">“network”</a> that containers will use to communicate with each other.
Because our project is called <code>pecan</code> and <code>docker-compose.yml</code> describes a network called <code>pecan</code>, the resulting network is called <code>pecan_pecan</code>.
This is relevant to the following commands, which will actually initialize and populate the BETY database.</p>
<p>Assuming the above ran successfully, next run the following:</p>
<div class="sourceCode" id="cb287"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb287-1" data-line-number="1"><span class="ex">docker-compose</span> run --rm bety initialize</a></code></pre></div>
<p>The breakdown of this command is as follows: {#docker-run-init}</p>
<ul>
<li><code>docker-compose run</code> – This says we will be running a specific command inside the target service (bety in this case).</li>
<li><code>--rm</code> – This automatically removes the resulting container once the specified command exits, as well as any volumes associated with the container. This is useful as a general “clean-up” flag for one-off commands (like this one) to make sure you don’t leave any “zombie” containers or volumes around at the end.</li>
<li><code>bety</code> – This is the name of the service in which we want to run the specified command.</li>
<li>Everything after the service name (here, <code>bety</code>) is interpreted as an argument to the image’s specified <a href="https://docs.docker.com/engine/reference/builder/#entrypoint">entrypoint</a>. For the <code>bety</code> service, the entrypoint is the script <a href="https://github.com/PecanProject/bety/blob/master/docker/entrypoint.sh"><code>docker/entrypoint.sh</code></a> located in the BETY repository. Here, the <code>initialize</code> argument is parsed to mean “Create a new database”, which first runs <code>psql</code> commands to create the <code>bety</code> role and database and then runs the <code>load.bety.sh</code> script.
<ul>
<li>NOTE: The entrypoint script that is used is the one copied into the Docker container at the time it was built, which, depending on the indicated image version and how often images are built on Docker Hub relative to updates to the source, may be older than whatever is in the source code.</li>
</ul></li>
</ul>
<p>Note that this command may throw a bunch of errors related to functions and/or operators already existing.
This is normal – it just means that the PostGIS extension to PostgreSQL is already installed.
The important thing is that you see output near the end like:</p>
<pre><code>CREATED SCHEMA
Loading  schema_migrations         : ADDED 61
Started psql (pid=507)
Updated  formats                   :     35 (+35)
Fixed    formats                   : 46
Updated  machines                  :     23 (+23)
Fixed    machines                  : 24
Updated  mimetypes                 :    419 (+419)
Fixed    mimetypes                 : 1095
...
...
...
Added carya41 with access_level=4 and page_access_level=1 with id=323
Added carya42 with access_level=4 and page_access_level=2 with id=325
Added carya43 with access_level=4 and page_access_level=3 with id=327
Added carya44 with access_level=4 and page_access_level=4 with id=329
Added guestuser with access_level=4 and page_access_level=4 with id=331</code></pre>
<p>If you do not see this output, you can look at the <a href="docker-index.html#docker-quickstart-troubleshooting">troubleshooting</a> section at the end of this section for some troubleshooting tips, as well as some solutions to common problems.</p>
<p>Once the command has finished successfully, proceed with the next step which will load some initial data into the database and place the data in the docker volumes.</p>
</div>
<div id="pecan-docker-quickstart-init-data" class="section level4">
<h4><span class="header-section-number">22.2.2.2</span> Add example data (first time only)</h4>
<p>The following command will add some initial data to the PEcAn stack and register the data with the database.</p>
<div class="sourceCode" id="cb289"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb289-1" data-line-number="1"><span class="ex">docker</span> run -ti --rm --network pecan_pecan --volume pecan_pecan:/data --env FQDN=docker pecan/data:develop</a></code></pre></div>
<p>The breakdown of this command is as follows:</p>
<ul>
<li><code>docker run</code> – This says we will be running a specific command inside the target Docker container. See <code>docker run --help</code> and the <a href="https://docs.docker.com/engine/reference/run/">Docker run reference</a> for more information.</li>
<li><code>-ti</code> – This is actually two flags, <code>-t</code> to allocate a pseudo-tty and <code>-i</code> to keep STDIN open even if detached. <code>-t</code> is necessary to ensure lower-level script commands run correctly. <code>-i</code> makes sure that the command output (<code>stdin</code>) is displayed.</li>
<li><code>--rm</code> – This automatically removes the resulting container once the specified command exits, as well as any volumes associated with the container. This is useful as a general “clean-up” flag for one-off commands (like this one) to make sure you don’t leave any “zombie” containers or volumes around at the end.</li>
<li><code>--network pecan_pecan</code> – This indicates that the container will use the existing <code>pecan_pecan</code> network. This network is what ensures communication between the <code>postgres</code> container (which, recall, is <em>just</em> a PostGIS installation with some data) and the “volumes” where the actual data are persistently stored.</li>
<li><code>pecan/data:develop</code> – This is the name of the image in which to run the specified command, in the form <code>repository/image:version</code>. This is interpreted as follows:
<ul>
<li>First, it sees if there are any images called <code>pecan/data:develop</code> available on your local machine. If there are, it uses that one.</li>
<li>If that image version is <em>not</em> available locally, it will next try to find the image online. By default, it searches <a href="https://hub.docker.com/">Docker Hub</a>, such that <code>pecan/data</code> gets expanded to the container at <code>https://hub.docker.com/r/pecan/data</code>. For custom repositories, a full name can be given, such as <code>hub.ncsa.illinois.edu/pecan/data:latest</code>.</li>
<li>If <code>:version</code> is omitted, Docker assumes <code>:latest</code>. NOTE that while online containers <em>should</em> have a <code>:latest</code> version, not all of them do, and if a <code>:latest</code> version does not exist, Docker will be unable to find the image and will throw an error.</li>
</ul></li>
<li>Everything after the image name (here, <code>pecan/data:develop</code>) is interpreted as an argument to the image’s specified <a href="https://docs.docker.com/engine/reference/builder/#entrypoint">entrypoint</a>.</li>
<li><code>--volume pecan_pecan:/data</code> – This mounts the data from the subsequent container (<code>pecan/data:develop</code>) onto the current project volume, called <code>pecan_pecan</code> (as with the network, the project name <code>pecan</code> is the prefix, and the volume name also happens to be <code>pecan</code> as specified in the <code>docker-compose.yml</code> file).</li>
<li><code>--env FQDN=docker</code> – the Fully Qualified Domain Name, this is the same value as specified in the <code>.env</code> file (for the web, monitor and executor containers). This will link the data files to the name in the machines table in BETY.</li>
<li><code>pecan/data:develop</code> – As above, this is the target image to run. Since there is no argument after the image name, this command will run the default command (<a href="https://docs.docker.com/engine/reference/builder/#cmd"><code>CMD</code></a>) specified for this docker container. In this case, it is the <a href="https://github.com/PecanProject/pecan/blob/develop/docker/add-data.sh"><code>docker/add_data.sh</code></a> script from the PEcAn repository.</li>
</ul>
<p>Under the hood, this container runs the <code>docker/add-data.sh</code> script, which copies a bunch of input files and registers them with the PEcAn database.</p>
<p>Successful execution of this command should take some time because it involves copying reasonably large amounts of data and performing a number of database operations.</p>
</div>
<div id="start-pecan" class="section level4">
<h4><span class="header-section-number">22.2.2.3</span> Start PEcAn</h4>
<p>If you already completed the above steps, you can start the full stack by just running the following:</p>
<div class="sourceCode" id="cb290"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb290-1" data-line-number="1"><span class="ex">docker-compose</span> -p pecan up -d</a></code></pre></div>
<p>This will build and start all containers required to run PEcAn.
With the <code>-d</code> flag, this will run all of these containers quietly in the background, and show a nice architecture diagram with the name and status of each container while they are starting.
Once this is done you have a working instance of PEcAn.</p>
<p>If all of the containers started successfully, you should be able to access the various components from a browser via the following URLs (if you run these commands on a remote machine replace localhost with the actual hostname).</p>
<ul>
<li>PEcAn web interface (running models) – <a href="http://localhost:8000/pecan/" class="uri">http://localhost:8000/pecan/</a> (NOTE: The trailing backslash is necessary.)</li>
<li>PEcAn documentation and home page – <a href="http://localhost:8000/" class="uri">http://localhost:8000/</a></li>
<li>BETY web interface – <a href="http://localhost:8000/bety/" class="uri">http://localhost:8000/bety/</a></li>
<li>File browser (minio) – <a href="http://localhost:8000/minio/" class="uri">http://localhost:8000/minio/</a></li>
<li>RabbitMQ management console (for managing queued processes) – <a href="http://localhost:8000/rabbitmq/" class="uri">http://localhost:8000/rabbitmq/</a></li>
<li>Traefik, webserver showing maps from URLs onto their respective containers – <a href="http://localhost:8000/traefik/" class="uri">http://localhost:8000/traefik/</a></li>
<li>Monitor, service that monitors models and shows all models that are online as well as how many instances are online and the number of jobs waiting. The output is in JSON – <a href="http://localhost:8000/monitor/" class="uri">http://localhost:8000/monitor/</a></li>
</ul>
</div>
<div id="curl-model-runs" class="section level4">
<h4><span class="header-section-number">22.2.2.4</span> Start model runs using curl</h4>
<p>To test PEcAn you can use the following <code>curl</code> statement, or use the webpage to submit a request (if you run these commands on a remote machine replace localhost with the actual hostname):</p>
<div class="sourceCode" id="cb291"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb291-1" data-line-number="1"><span class="ex">curl</span> -v -X POST \</a>
<a class="sourceLine" id="cb291-2" data-line-number="2">    -F <span class="st">&#39;hostname=docker&#39;</span> \</a>
<a class="sourceLine" id="cb291-3" data-line-number="3">    -F <span class="st">&#39;modelid=5000000002&#39;</span> \</a>
<a class="sourceLine" id="cb291-4" data-line-number="4">    -F <span class="st">&#39;sitegroupid=1&#39;</span> \</a>
<a class="sourceLine" id="cb291-5" data-line-number="5">    -F <span class="st">&#39;siteid=772&#39;</span> \</a>
<a class="sourceLine" id="cb291-6" data-line-number="6">    -F <span class="st">&#39;sitename=Niwot Ridge Forest/LTER NWT1 (US-NR1)&#39;</span> \</a>
<a class="sourceLine" id="cb291-7" data-line-number="7">    -F <span class="st">&#39;pft[]=temperate.coniferous&#39;</span> \</a>
<a class="sourceLine" id="cb291-8" data-line-number="8">    -F <span class="st">&#39;start=2004/01/01&#39;</span> \</a>
<a class="sourceLine" id="cb291-9" data-line-number="9">    -F <span class="st">&#39;end=2004/12/31&#39;</span> \</a>
<a class="sourceLine" id="cb291-10" data-line-number="10">    -F <span class="st">&#39;input_met=5000000005&#39;</span> \</a>
<a class="sourceLine" id="cb291-11" data-line-number="11">    -F <span class="st">&#39;email=&#39;</span> \</a>
<a class="sourceLine" id="cb291-12" data-line-number="12">    -F <span class="st">&#39;notes=&#39;</span> \</a>
<a class="sourceLine" id="cb291-13" data-line-number="13">    <span class="st">&#39;http://localhost:8000/pecan/04-runpecan.php&#39;</span></a></code></pre></div>
<p>This should return some text with in there <code>Location:</code> this is shows the workflow id, you can prepend <a href="http://localhost:8000/pecan/" class="uri">http://localhost:8000/pecan/</a> to the front of this, for example: <a href="http://localhost:8000/pecan/05-running.php?workflowid=99000000001" class="uri">http://localhost:8000/pecan/05-running.php?workflowid=99000000001</a>. Here you will be able to see the progress of the workflow.</p>
<p>To see what is happening behind the scenes you can use look at the log file of the specific docker containers, once of interest are <code>pecan_executor_1</code> this is the container that will execute a single workflow and <code>pecan_sipnet_1</code> which executes the sipnet mode. To see the logs you use <code>docker logs pecan_executor_1</code> Following is an example output:</p>
<pre><code>2018-06-13 15:50:37,903 [MainThread     ] INFO    : pika.adapters.base_connection - Connecting to 172.18.0.2:5672
2018-06-13 15:50:37,924 [MainThread     ] INFO    : pika.adapters.blocking_connection - Created channel=1
2018-06-13 15:50:37,941 [MainThread     ] INFO    : root -  [*] Waiting for messages. To exit press CTRL+C
2018-06-13 19:44:49,523 [MainThread     ] INFO    : root - b&#39;{&quot;folder&quot;: &quot;/data/workflows/PEcAn_99000000001&quot;, &quot;workflowid&quot;: &quot;99000000001&quot;}&#39;
2018-06-13 19:44:49,524 [MainThread     ] INFO    : root - Starting job in /data/workflows/PEcAn_99000000001.
2018-06-13 19:45:15,555 [MainThread     ] INFO    : root - Finished running job.</code></pre>
<p>This shows that the executor connects to RabbitMQ, waits for messages. Once it picks up a message it will print the message, and execute the workflow in the folder passed in with the message. Once the workflow (including any model executions) is finished it will print Finished. The log file for <code>pecan_sipnet_1</code> is very similar, in this case it runs the <code>job.sh</code> in the run folder.</p>
<p>To run multiple executors in parallel you can duplicate the executor section in the docker-compose file and just rename it from executor to executor1 and executor2 for example. The same can be done for the models. To make this easier it helps to deploy the containers using Kubernetes allowing to easily scale up and down the containers.</p>
</div>
</div>
<div id="docker-quickstart-troubleshooting" class="section level3">
<h3><span class="header-section-number">22.2.3</span> Troubleshooting</h3>
<p>When initializing the database, you will know you have encountered more serious errors if the command exits or hangs with output resembling the following:</p>
<pre><code>LINE 1: SELECT count(*) FROM formats WHERE ...
                             ^
Error: Relation `formats` does not exist</code></pre>
<p><strong>If the above command fails</strong>, you can try to fix things interactively by first opening a shell inside the container…</p>
<pre><code>docker run -ti --rm --network pecan_pecan pecan/bety:latest /bin/bash</code></pre>
<p>…and then running the following commands, which emulate the functionality of the <code>entrypoint.sh</code> with the <code>initialize</code> argument.</p>
<div class="sourceCode" id="cb295"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb295-1" data-line-number="1"><span class="co"># Create the bety role in the postgresql database</span></a>
<a class="sourceLine" id="cb295-2" data-line-number="2"><span class="ex">psql</span> -h postgres -p 5432 -U postgres -c <span class="st">&quot;CREATE ROLE bety WITH LOGIN CREATEDB NOSUPERUSER NOCREATEROLE PASSWORD &#39;bety&#39;&quot;</span></a>
<a class="sourceLine" id="cb295-3" data-line-number="3"></a>
<a class="sourceLine" id="cb295-4" data-line-number="4"><span class="co"># Initialize the bety database itself, and set to be owned by role bety</span></a>
<a class="sourceLine" id="cb295-5" data-line-number="5"><span class="ex">psql</span> -h postgres -p 5432 -U postgres -c <span class="st">&quot;CREATE DATABASE bety WITH OWNER bety&quot;</span></a>
<a class="sourceLine" id="cb295-6" data-line-number="6"></a>
<a class="sourceLine" id="cb295-7" data-line-number="7"><span class="co"># If either of these fail with a &quot;role/database bety already exists&quot;,</span></a>
<a class="sourceLine" id="cb295-8" data-line-number="8"><span class="co"># that&#39;s fine. You can safely proceed to the next command.</span></a>
<a class="sourceLine" id="cb295-9" data-line-number="9"></a>
<a class="sourceLine" id="cb295-10" data-line-number="10"><span class="co"># Load the actual bety database tables and values</span></a>
<a class="sourceLine" id="cb295-11" data-line-number="11"><span class="ex">./script/load.bety.sh</span> -a <span class="st">&quot;postgres&quot;</span> -d <span class="st">&quot;bety&quot;</span> -p <span class="st">&quot;-h postgres -p 5432&quot;</span> -o bety -c -u -g -m <span class="va">${LOCAL_SERVER}</span> -r 0 -w https://ebi-forecast.igb.illinois.edu/pecan/dump/all/bety.tar.gz</a></code></pre></div>

</div>
</div>
<div id="pecan-docker" class="section level2">
<h2><span class="header-section-number">22.3</span> PEcAn Docker Architecture</h2>
<ul>
<li><a href="docker-index.html#pecan-docker-overview">Overview</a></li>
<li><a href="docker-index.html#pecan-docker-compose">PEcAn’s <code>docker-compose</code></a></li>
<li><a href="docker-index.html#pecan-dc-structure">Top-level structure</a></li>
<li><a href="docker-index.html#pecan-dc-traefik"><code>traefik</code></a></li>
<li><a href="docker-index.html#pecan-dc-portainer"><code>portainer</code></a></li>
<li><a href="docker-index.html#pecan-dc-minio"><code>minio</code></a></li>
<li><a href="docker-index.html#pecan-dc-thredds"><code>thredds</code></a></li>
<li><a href="docker-index.html#pecan-dc-postgres"><code>postgres</code></a></li>
<li><a href="docker-index.html#pecan-dc-rabbitmq"><code>rabbitmq</code></a></li>
<li><a href="docker-index.html#pecan-dc-bety"><code>bety</code></a></li>
<li><a href="docker-index.html#pecan-dc-docs"><code>docs</code></a></li>
<li><a href="docker-index.html#pecan-dc-web"><code>web</code></a></li>
<li><a href="docker-index.html#pecan-dc-executor"><code>executor</code></a></li>
<li><a href="docker-index.html#pecan-dc-monitor"><code>monitor</code></a></li>
<li><a href="docker-index.html#pecan-dc-models">Model-specific containers</a></li>
</ul>
<div id="pecan-docker-overview" class="section level3">
<h3><span class="header-section-number">22.3.1</span> Overview</h3>
<p>The PEcAn docker architecture consists of many containers (see figure below) that will communicate with each other. The goal of this architecture is to easily expand the PEcAn system by deploying new model containers and registering them with PEcAn. Once this is done the user can now use these new models in their work. The PEcAn framework will setup the configurations for the models, and send a message to the model containers to start execution. Once the execution is finished the PEcAn framework will continue. This is exactly as if the model is running on a HPC machine. Models can be executed in parallel by launching multiple model containers.</p>
<p><img src="06_reference/04_docker/pecan-docker.png" width="50%" height="50%" style="display: block; margin: auto;" /></p>
<p>As can be seen in the figure the architecture leverages of two standard containers (in orange). The first container is postgresql with postgis (<a href="https://hub.docker.com/r/mdillon/postgis/">mdillon/postgis</a>) which is used to store the database used by both BETY and PEcAn. The second containers is a messagebus, more specifically RabbitMQ (<a href="https://hub.docker.com/_/rabbitmq/">rabbitmq</a>).</p>
<p>The BETY app container (<a href="https://hub.docker.com/r/pecan/bety/">pecan/bety</a>) is the front end to the BETY database and is connected to the postgresql container. A http server can be put in front of this container for SSL termination as well to allow for load balancing (by using multiple BETY app containers).</p>
<p>The PEcAn framework containers consist of multiple unique ways to interact with the PEcAn system (none of these containers will have any models installed):</p>
<ul>
<li>PEcAn shiny hosts the shiny applications developed and will interact with the database to get all information necessary to display</li>
<li>PEcAn rstudio is a rstudio environment with the PEcAn libraries preloaded. This allows for prototyping of new algorithms that can be used as part of the PEcAn framework later.</li>
<li>PEcAn web allows the user to create a new PEcAn workflow. The workflow is stored in the database, and the models are executed by the model containers.</li>
<li>PEcAn cli will allow the user to give a pecan.xml file that will be executed by the PEcAn framework. The workflow created from the XML file is stored in the database, and the models are executed by the model containers.</li>
</ul>
<p>The model containers contain the actual models that are executed as well as small wrappers to make them work in the PEcAn framework. The containers will run the model based on the parameters received from the message bus and convert the outputs back to the standard PEcAn output format. Once the container is finished processing a message it will immediatly get the next message and start processing it.</p>
</div>
<div id="pecan-docker-compose" class="section level3">
<h3><span class="header-section-number">22.3.2</span> PEcAn’s <code>docker-compose</code></h3>
<p>The PEcAn Docker architecture is described in full by the PEcAn <code>docker-compose.yml</code> file.
For full <code>docker-compose</code> syntax, see the <a href="https://docs.docker.com/compose/">official documentation</a>.</p>
<p>This section describes the <a href="docker-index.html#pecan-dc-structure">top-level structure</a> and each of the services, which are as follows:</p>
<ul>
<li><a href="docker-index.html#pecan-dc-traefik"><code>traefik</code></a></li>
<li><a href="docker-index.html#pecan-dc-portainer"><code>portainer</code></a></li>
<li><a href="docker-index.html#pecan-dc-minio"><code>minio</code></a></li>
<li><a href="docker-index.html#pecan-dc-thredds"><code>thredds</code></a></li>
<li><a href="docker-index.html#pecan-dc-postgres"><code>postgres</code></a></li>
<li><a href="docker-index.html#pecan-dc-rabbitmq"><code>rabbitmq</code></a></li>
<li><a href="docker-index.html#pecan-dc-bety"><code>bety</code></a></li>
<li><a href="docker-index.html#pecan-dc-docs"><code>docs</code></a></li>
<li><a href="docker-index.html#pecan-dc-web"><code>web</code></a></li>
<li><a href="docker-index.html#pecan-dc-executor"><code>executor</code></a></li>
<li><a href="docker-index.html#pecan-dc-monitor"><code>monitor</code></a></li>
<li><a href="docker-index.html#pecan-dc-models">Model-specific services</a></li>
</ul>
<p>For reference, the complete <code>docker-compose</code> file is as follows:</p>
<pre><code>version: &#39;3&#39;
services:
  traefik:
    image: traefik:1.7
    command:
    - --loglevel=INFO
    - --api
    - --defaultentrypoints=https,http
    - --entryPoints=Name:http Address::${TRAEFIK_HTTP_PORT:-8000} ${TRAEFIK_HTTP_REDIRECT:-&quot;&quot;}
    - --entryPoints=Name:https Address::${TRAEFIK_HTTPS_PORT:-8443} ${TRAEFIK_HTTPS_OPTIONS:-TLS}
    - --acme=${TRAEFIK_ACME_ENABLE:-false}
    - --acme.email=${TRAEFIK_ACME_EMAIL:-&quot;&quot;}
    - --acme.entrypoint=https
    - --acme.onhostrule=true
    - --acme.storage=/config/acme.json
    - --acme.httpchallenge.entrypoint=http
    - --acme.storage=/config/acme.json
    - --acme.acmelogging=true
    - --docker=true
    - --docker.endpoint=unix:///var/run/docker.sock
    - --docker.exposedbydefault=false
    - --docker.watch=true
    restart: unless-stopped
    networks: pecan
    ports:
    - ${TRAEFIK_HTTP_PORT-8000}:${TRAEFIK_HTTP_PORT:-8000}
    - ${TRAEFIK_HTTPS_PORT-8443}:${TRAEFIK_HTTPS_PORT:-8443}
    labels:
    - traefik.enable=true
    - traefik.backend=traefik
    - traefik.port=8080
    - &#39;traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefixStrip: /traefik&#39;
    - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock:ro
    - traefik:/config
  portainer:
    image: portainer/portainer:latest
    command:
    - --admin-password=${PORTAINER_PASSWORD:-}
    - --host=unix:///var/run/docker.sock
    restart: unless-stopped
    networks: pecan
    labels:
    - traefik.enable=true
    - traefik.backend=portainer
    - &#39;traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefixStrip: /portainer&#39;
    - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
    volumes:
    - /var/run/docker.sock:/var/run/docker.sock
    - portainer:/data
  minio:
    image: minio/minio:latest
    command: server /data
    restart: unless-stopped
    networks: pecan
    environment:
    - MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY:-carya}
    - MINIO_SECRET_KEY=${MINIO_SECRET_KEY:-illinois}
    labels:
    - traefik.enable=true
    - traefik.backend=minio
    - traefik.port=9000
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/minio/
    volumes: pecan:/data
  thredds:
    image: pecan/thredds:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    volumes: pecan:/data
    labels:
    - traefik.enable=true
    - traefik.port=8080
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/thredds
    - traefik.backend=thredds
  rabbitmq:
    image: rabbitmq:management
    restart: unless-stopped
    networks: pecan
    environment:
    - RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS=-rabbitmq_management path_prefix &quot;/rabbitmq&quot;
    - RABBITMQ_DEFAULT_USER=${RABBITMQ_DEFAULT_USER:-guest}
    - RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS:-guest}
    labels:
    - traefik.enable=true
    - traefik.backend=rabbitmq
    - traefik.port=15672
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/rabbitmq
    - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
    volumes: rabbitmq:/var/lib/rabbitmq
  postgres:
    image: mdillon/postgis:9.5
    restart: unless-stopped
    networks: pecan
    volumes: postgres:/var/lib/postgresql/data
  bety:
    image: pecan/bety:${BETY_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment:
    - UNICORN_WORKER_PROCESSES=1
    - SECRET_KEY_BASE=${BETY_SECRET_KEY:-notasecret}
    - RAILS_RELATIVE_URL_ROOT=/bety
    - LOCAL_SERVER=${BETY_LOCAL_SERVER:-99}
    depends_on: postgres
    labels:
    - traefik.enable=true
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/bety/
    - traefik.backend=bety
  rstudio-nginx:
    image: pecan/rstudio-nginx:${PECAN_VERSION:-latest}
    networks: pecan
    labels:
    - traefik.enable=true
    - traefik.backend=rstudio
    - traefik.port=80
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/rstudio
    - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
  rstudio:
    image: pecan/base:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment:
    - USER=${PECAN_RSTUDIO_USER:-carya}
    - PASSWORD=${PECAN_RSTUDIO_PASS:-illinois}
    entrypoint: /init
    volumes:
    - pecan:/data
    - rstudio:/home
  docs:
    image: pecan/docs:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    labels:
    - traefik.enable=true
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/
    - traefik.backend=docs
  web:
    image: pecan/web:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment:
    - RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
    - FQDN=${PECAN_FQDN:-docker}
    - NAME=${PECAN_NAME:-docker}
    depends_on:
    - postgres
    - rabbitmq
    labels:
    - traefik.enable=true
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/pecan/
    - traefik.backend=pecan
    volumes:
    - pecan:/data
    - pecan:/var/www/html/pecan/data
  monitor:
    image: pecan/monitor:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    ports: 9999:9999
    environment:
    - RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
    - FQDN=${PECAN_FQDN:-docker}
    depends_on: rabbitmq
    labels:
    - traefik.enable=true
    - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefixStrip:/monitor/
    - traefik.backend=monitor
    volumes: pecan:/data
  executor:
    image: pecan/executor:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment:
    - RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
    - FQDN=${PECAN_FQDN:-docker}
    depends_on:
    - postgres
    - rabbitmq
    volumes: pecan:/data
  sipnet:
    image: pecan/model-sipnet-r136:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment: RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
    depends_on: rabbitmq
    volumes: pecan:/data
  ed2:
    image: pecan/model-ed2-git:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment: RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
    depends_on: rabbitmq
    volumes: pecan:/data
  maespa:
    image: pecan/model-maespa-git:${PECAN_VERSION:-latest}
    restart: unless-stopped
    networks: pecan
    environment: RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
    depends_on: rabbitmq
    volumes: pecan:/data
networks:
  pecan: ~
volumes:
  traefik: ~
  postgres: ~
  rabbitmq: ~
  pecan: ~
  portainer: ~
  rstudio: ~</code></pre>
<p>There are two ways you can override different values in the docker-compose.yml file. The first method is to create a file called <code>.env</code> that is placed in the same folder as the docker-compose.yml file. This file can override some of configuration variables used by docker-compose. For example the following is an example of the env file</p>
<pre><code># This file will override the configation options in the docker-compose
# file. Copy this file to the same folder as docker-compose as .env

# ----------------------------------------------------------------------
# GENERAL CONFIGURATION
# ----------------------------------------------------------------------

# project name (-p flag for docker-compose)
#COMPOSE_PROJECT_NAME=dev

# ----------------------------------------------------------------------
# TRAEFIK CONFIGURATION
# ----------------------------------------------------------------------

# hostname of server
#TRAEFIK_HOST=Host:pecan-docker.ncsa.illinois.edu;

# only allow access from localhost and NCSA
#TRAEFIK_IPFILTER=172.16.0.0/12, 141.142.0.0/16

# Run traffik on port 80 (http) and port 443 (https)
#TRAEFIK_HTTP_PORT=80
#TRAEFIK_HTTPS_PORT=443
#TRAEFIK_HTTPS_OPTIONS=TLS

# enable SSL cerificate generation
#TRAEFIK_ACME_ENABLE=true

# Use you real email address here to be notified if cert expires
#TRAEFIK_ACME_EMAIL=pecanproj@gmail.com

# Always use https, trafic to http is redirected to https
#TRAEFIK_HTTP_REDIRECT=Redirect.EntryPoint:https

# ----------------------------------------------------------------------
# PEcAn CONFIGURATION
# ----------------------------------------------------------------------

# what version of pecan to use
#PECAN_VERSION=develop

# the fully qualified hostname used for this server
#PECAN_FQDN=pecan-docker.ncsa.illinois.edu

# short name shown in the menu
#PECAN_NAME=pecan-docker

# ----------------------------------------------------------------------
# BETY CONFIGURATION
# ----------------------------------------------------------------------

# what version of BETY to use
#BETY_VERSION=develop

# what is our server number, 99=vm, 98=docker
#BETY_LOCAL_SERVER=98

# secret used to encrypt cookies in BETY
#BETY_SECRET_KEY=1208q7493e8wfhdsohfo9ewhrfiouaho908ruq30oiewfdjspadosuf08q345uwrasdy98t7q243

# ----------------------------------------------------------------------
# MINIO CONFIGURATION
# ----------------------------------------------------------------------

# minio username and password
#MINIO_ACCESS_KEY=carya
#MINIO_SECRET_KEY=illinois

# ----------------------------------------------------------------------
# PORTAINER CONFIGURATION
# ----------------------------------------------------------------------

# password for portainer admin account
# use docker run --rm httpd:2.4-alpine htpasswd -nbB admin &lt;password&gt; | cut -d &quot;:&quot; -f 2
#PORTAINER_PASSWORD=$2y$05$5meDPBtS3NNxyGhBpYceVOxmFhiiC3uY5KEy2m0YRbWghhBr2EVn2

# ----------------------------------------------------------------------
# RABBITMQ CONFIGURATION
# ----------------------------------------------------------------------

# RabbitMQ username and password
#RABBITMQ_DEFAULT_USER=carya
#RABBITMQ_DEFAULT_PASS=illinois

# create the correct URI with above username and password
#RABBITMQ_URI=amqp://carya:illinois@rabbitmq/%2F

# ----------------------------------------------------------------------
# RSTUDIO CONFIGURATION
# ----------------------------------------------------------------------

# Default RStudio username and password for startup of container
#PECAN_RSTUDIO_USER=carya
#PECAN_RSTUDIO_PASS=illinois</code></pre>
<p>You can also extend the <code>docker-compose.yml</code> file with a <code>docker-compose.override.yml</code> file (in the same directory), allowing you to add more services, or for example to change where the volumes are stored (see <a href="https://docs.docker.com/compose/extends/">official documentation</a>). For example the following will change the volume for postgres to be stored in your home directory:</p>
<pre><code>version: &quot;3&quot;

volumes:
  postgres:
    driver_opts:
      type: none
      device: ${HOME}/postgres
      o: bind</code></pre>
</div>
<div id="pecan-dc-structure" class="section level3">
<h3><span class="header-section-number">22.3.3</span> Top-level structure</h3>
<p>The root of the <code>docker-compose.yml</code> file contains three sections:</p>
<ul>
<li><p><code>services</code> – This is a list of services provided by the application, with each service corresponding to a container.
When communicating with each other internally, the hostnames of containers correspond to their names in this section.
For instance, regardless of the “project” name passed to <code>docker-compose up</code>, the hostname for connecting to the PostgreSQL database of any given container is <em>always</em> going to be <code>postgres</code> (e.g. you should be able to access the PostgreSQL database by calling the following from inside the container: <code>psql -d bety -U bety -h postgres</code>).
The services comprising the PEcAn application are described below.</p></li>
<li><p><code>networks</code> – This is a list of networks used by the application.
Containers can only communicate with each other (via ports and hostnames) if they are on the same Docker network, and containers on different networks can only communicate through ports exposed by the host machine.
We just provide the network name (<code>pecan</code>) and resort to Docker’s default network configuration.
Note that the services we want connected to this network include a <code>networks: ... - pecan</code> tag.
For more details on Docker networks, see the <a href="https://docs.docker.com/network/">official documentation</a>.</p></li>
<li><p><code>volumes</code> – Similarly to <code>networks</code>, this just contains a list of volume names we want.
Briefly, in Docker, volumes are directories containing files that are meant to be shared across containers.
Each volume corresponds to a directory, which can be mounted at a specific location by different containers.
For example, syntax like <code>volumes: ... - pecan:/data</code> in a service definition means to mount the <code>pecan</code> “volume” (including its contents) in the <code>/data</code> directory of that container.
Volumes also allow data to persist on containers between restarts, as normally, any data created by a container during its execution is lost when the container is re-launched.
For example, using a volume for the database allows data to be saved between different runs of the database container.
Without volumes, we would start with a blank database every time we restart the containers.
For more details on Docker volumes, see the <a href="https://docs.docker.com/storage/volumes/">official documentation</a>.
Here, we define three volumes:</p>
<ul>
<li><p><code>postgres</code> – This contains the data files underlying the PEcAn PostgreSQL database (BETY).
Notice that it is mounted by the <code>postgres</code> container to <code>/var/lib/postgresql/data</code>.
This is the data that we pre-populate when we run the Docker commands to <a href="docker-index.html#pecan-docker-quickstart-init">initialize the PEcAn database</a>.
Note that these are the values stored <em>directly in the PostgreSQL database</em>.
The default files to which the database points (i.e. <code>dbfiles</code>) are stored in the <code>pecan</code> volume, described below.</p></li>
<li><p><code>rabbitmq</code> – This volume contains persistent data for RabbitMQ.
It is only used by the <code>rabbitmq</code> service.</p></li>
<li><p><code>pecan</code> – This volume contains PEcAn’s <code>dbfiles</code>, which include downloaded and converted model inputs, processed configuration files, and outputs.
It is used by almost all of the services in the PEcAn stack, and is typically mounted to <code>/data</code>.</p></li>
</ul></li>
</ul>
</div>
<div id="pecan-dc-traefik" class="section level3">
<h3><span class="header-section-number">22.3.4</span> <code>traefik</code></h3>
<p><a href="https://traefik.io/">Traefik</a> manages communication among the different PEcAn services and between PEcAn and the web.
Among other things, <code>traefik</code> facilitates the setup of web access to each PEcAn service via common and easy-to-remember URLs.
For instance, the following lines in the <code>web</code> service configure access to the PEcAn web interface via the URL <a href="http://localhost:8000/pecan/" class="uri">http://localhost:8000/pecan/</a> :</p>
<pre><code>labels:
- traefik.enable=true
- traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/pecan/
- traefik.backend=pecan</code></pre>
<p>(Further details in the works…)</p>
<p>The traefik service configuration looks like this:</p>
<pre><code>traefik:
  image: traefik:1.7
  command:
  - --loglevel=INFO
  - --api
  - --defaultentrypoints=https,http
  - --entryPoints=Name:http Address::${TRAEFIK_HTTP_PORT:-8000} ${TRAEFIK_HTTP_REDIRECT:-&quot;&quot;}
  - --entryPoints=Name:https Address::${TRAEFIK_HTTPS_PORT:-8443} ${TRAEFIK_HTTPS_OPTIONS:-TLS}
  - --acme=${TRAEFIK_ACME_ENABLE:-false}
  - --acme.email=${TRAEFIK_ACME_EMAIL:-&quot;&quot;}
  - --acme.entrypoint=https
  - --acme.onhostrule=true
  - --acme.storage=/config/acme.json
  - --acme.httpchallenge.entrypoint=http
  - --acme.storage=/config/acme.json
  - --acme.acmelogging=true
  - --docker=true
  - --docker.endpoint=unix:///var/run/docker.sock
  - --docker.exposedbydefault=false
  - --docker.watch=true
  restart: unless-stopped
  networks: pecan
  ports:
  - ${TRAEFIK_HTTP_PORT-8000}:${TRAEFIK_HTTP_PORT:-8000}
  - ${TRAEFIK_HTTPS_PORT-8443}:${TRAEFIK_HTTPS_PORT:-8443}
  labels:
  - traefik.enable=true
  - traefik.backend=traefik
  - traefik.port=8080
  - &#39;traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefixStrip: /traefik&#39;
  - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
  volumes:
  - /var/run/docker.sock:/var/run/docker.sock:ro
  - traefik:/config</code></pre>
</div>
<div id="pecan-dc-portainer" class="section level3">
<h3><span class="header-section-number">22.3.5</span> <code>portainer</code></h3>
<p><a href="https://portainer.io/">portainer</a> is lightweight management UI that allows you to manage the docker host (or swarm). You can use this service to monitor the different containers, see the logfiles, and start and stop containers.</p>
<p>The portainer service configuration looks like this:</p>
<pre><code>portainer:
  image: portainer/portainer:latest
  command:
  - --admin-password=${PORTAINER_PASSWORD:-}
  - --host=unix:///var/run/docker.sock
  restart: unless-stopped
  networks: pecan
  labels:
  - traefik.enable=true
  - traefik.backend=portainer
  - &#39;traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefixStrip: /portainer&#39;
  - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
  volumes:
  - /var/run/docker.sock:/var/run/docker.sock
  - portainer:/data</code></pre>
<p>Portainer is accessible by browsing to <code>localhost:8000/portainer/</code>. You can either set the password in the <code>.env</code> file (for an example see env.example) or you can use the web browser and go to the portainer url. If this is the first time it will ask for your password.</p>
</div>
<div id="pecan-dc-minio" class="section level3">
<h3><span class="header-section-number">22.3.6</span> <code>minio</code></h3>
<p><a href="https://github.com/minio/minio">Minio</a> is a service that provides access to the a folder on disk through a variety of protocols, including S3 buckets and web-based access.
We mainly use Minio to facilitate access to PEcAn data using a web browser without the need for CLI tools.</p>
<p>Our current configuration is as follows:</p>
<pre><code>minio:
  image: minio/minio:latest
  command: server /data
  restart: unless-stopped
  networks: pecan
  environment:
  - MINIO_ACCESS_KEY=${MINIO_ACCESS_KEY:-carya}
  - MINIO_SECRET_KEY=${MINIO_SECRET_KEY:-illinois}
  labels:
  - traefik.enable=true
  - traefik.backend=minio
  - traefik.port=9000
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/minio/
  volumes: pecan:/data</code></pre>
<p>The Minio interface is accessible by browsing to <code>localhost:8000/minio/</code>.
From there, you can browse directories and download files.
You can also upload files by clicking the red “+” in the bottom-right corner.</p>
<p>Note that it is currently impossible to create or upload directories using the Minio interface (except in the <code>/data</code> root directory – those folders are called “buckets” in Minio).
Therefore, the recommended way to perform any file management tasks other than individual file uploads is through the command line, e.g.</p>
<div class="sourceCode" id="cb303"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb303-1" data-line-number="1"><span class="ex">docker</span> run -it --rm --volumes pecan_pecan:/data --volumes /path/to/local/directory:/localdir ubuntu</a>
<a class="sourceLine" id="cb303-2" data-line-number="2"></a>
<a class="sourceLine" id="cb303-3" data-line-number="3"><span class="co"># Now, you can move files between `/data` and `/localdir`, create new directories, etc.</span></a></code></pre></div>
</div>
<div id="pecan-dc-thredds" class="section level3">
<h3><span class="header-section-number">22.3.7</span> <code>thredds</code></h3>
<p>This service allows PEcAn model outputs to be accessible via the <a href="https://www.unidata.ucar.edu/software/thredds/current/tds/">THREDDS data server (TDS)</a>.
When the PEcAn stack is running, the catalog can be explored in a web browser at <a href="http://localhost:8000/thredds/catalog.html" class="uri">http://localhost:8000/thredds/catalog.html</a>.
Specific output files can also be accessed from the command line via commands like the following:</p>
<p>Note that everything after <code>outputs/</code> exactly matches the directory structure of the <code>workflows</code> directory.</p>
<p>Which files are served, which subsetting services are available, and other aspects of the data server’s behavior are configured in the <code>docker/thredds_catalog.xml</code> file.
Specifically, this XML tells the data server to use the <code>datasetScan</code> tool to serve all files within the <code>/data/workflows</code> directory, with the additional <code>filter</code> that only files ending in <code>.nc</code> are served.
For additional information about the syntax of this file, see the extensive <a href="https://www.unidata.ucar.edu/software/thredds/current/tds/reference/index.html">THREDDS documentation</a>.</p>
<p>Our current configuration is as follows:</p>
<pre><code>thredds:
  image: pecan/thredds:${PECAN_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  volumes: pecan:/data
  labels:
  - traefik.enable=true
  - traefik.port=8080
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/thredds
  - traefik.backend=thredds</code></pre>
</div>
<div id="pecan-dc-postgres" class="section level3">
<h3><span class="header-section-number">22.3.8</span> <code>postgres</code></h3>
<p>This service provides a working PostGIS database.
Our configuration is fairly straightforward:</p>
<pre><code>postgres:
  image: mdillon/postgis:9.5
  restart: unless-stopped
  networks: pecan
  volumes: postgres:/var/lib/postgresql/data</code></pre>
<p>Some additional details about our configuration:</p>
<ul>
<li><p><code>image</code> – This pulls a container with PostgreSQL + PostGIS pre-installed.
Note that by default, we use PostgreSQL version 9.5.
To experiment with other versions, you can change <code>9.5</code> accordingly.</p></li>
<li><p><code>networks</code> – This allows PostgreSQL to communicate with other containers on the <code>pecan</code> network.
As mentioned above, the hostname of this service is just its name, i.e. <code>postgres</code>, so to connect to the database from inside a running container, use a command like the following: <code>psql -d bety -U bety -h postgres</code></p></li>
<li><p><code>volumes</code> – Note that the PostgreSQL data files (which store the values in the SQL database) are stored on a <em>volume</em> called <code>postgres</code> (which is <em>not</em> the same as the <code>postgres</code> <em>service</em>, even though they share the same name).</p></li>
</ul>
</div>
<div id="pecan-dc-rabbitmq" class="section level3">
<h3><span class="header-section-number">22.3.9</span> <code>rabbitmq</code></h3>
<p><a href="https://www.rabbitmq.com/">RabbitMQ</a> is a message broker service.
In PEcAn, RabbitMQ functions as a task manager and scheduler, coordinating the execution of different tasks (such as running models and analyzing results) associated with the PEcAn workflow.</p>
<p>Our configuration is as follows:</p>
<pre><code>rabbitmq:
  image: rabbitmq:management
  restart: unless-stopped
  networks: pecan
  environment:
  - RABBITMQ_SERVER_ADDITIONAL_ERL_ARGS=-rabbitmq_management path_prefix &quot;/rabbitmq&quot;
  - RABBITMQ_DEFAULT_USER=${RABBITMQ_DEFAULT_USER:-guest}
  - RABBITMQ_DEFAULT_PASS=${RABBITMQ_DEFAULT_PASS:-guest}
  labels:
  - traefik.enable=true
  - traefik.backend=rabbitmq
  - traefik.port=15672
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/rabbitmq
  - traefik.website.frontend.whiteList.sourceRange=${TRAEFIK_IPFILTER:-172.16.0.0/12}
  volumes: rabbitmq:/var/lib/rabbitmq</code></pre>
<p>Note that the <code>traefik.frontend.rule</code> indicates that browsing to <a href="http://localhost:8000/rabbitmq/" class="uri">http://localhost:8000/rabbitmq/</a> leads to the RabbitMQ management console.</p>
<p>By default, the RabbitMQ management console has username/password <code>guest/guest</code>, which is highly insecure.
For production instances of PEcAn, we highly recommend changing these credentials to something more secure, and removing access to the RabbitMQ management console via Traefik.</p>
</div>
<div id="pecan-dc-bety" class="section level3">
<h3><span class="header-section-number">22.3.10</span> <code>bety</code></h3>
<p>This service operates the BETY web interface, which is effectively a web-based front-end to the PostgreSQL database.
Unlike the <code>postgres</code> service, which contains all the data needed to run PEcAn models, this service is not essential to the PEcAn workflow.
However, note that certain features of the PEcAn web interface do link to the BETY web interface and will not work if this container is not running.</p>
<p>Our configuration is as follows:</p>
<pre><code>bety:
  image: pecan/bety:${BETY_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  environment:
  - UNICORN_WORKER_PROCESSES=1
  - SECRET_KEY_BASE=${BETY_SECRET_KEY:-notasecret}
  - RAILS_RELATIVE_URL_ROOT=/bety
  - LOCAL_SERVER=${BETY_LOCAL_SERVER:-99}
  depends_on: postgres
  labels:
  - traefik.enable=true
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/bety/
  - traefik.backend=bety</code></pre>
<p>The BETY container Dockerfile is located in the root directory of the <a href="https://github.com/pecan/bety">BETY GitHub repository</a> (<a href="https://github.com/PecanProject/bety/blob/master/Dockerfile">direct link</a>).</p>
</div>
<div id="pecan-dc-docs" class="section level3">
<h3><span class="header-section-number">22.3.11</span> <code>docs</code></h3>
<p>This service will show the documentation for the version of PEcAn running as well as a homepage with links to all relevant endpoints. You can access this at <a href="http://localhost:8000/" class="uri">http://localhost:8000/</a>. You can find the documentation for PEcAn at <a href="http://localhost:8000/docs/pecan/" class="uri">http://localhost:8000/docs/pecan/</a>.</p>
<p>Our current configuration is as follows:</p>
<pre><code>docs:
  image: pecan/docs:${PECAN_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  labels:
  - traefik.enable=true
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/
  - traefik.backend=docs</code></pre>
</div>
<div id="pecan-dc-web" class="section level3">
<h3><span class="header-section-number">22.3.12</span> <code>web</code></h3>
<p>This service runs the PEcAn web interface.
It is effectively a thin wrapper around a standard Apache web server container from Docker Hub that installs some additional dependencies and copies over the necessary files from the PEcAn source code.</p>
<p>Our configuration is as follows:</p>
<pre><code>web:
  image: pecan/web:${PECAN_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  environment:
  - RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
  - FQDN=${PECAN_FQDN:-docker}
  - NAME=${PECAN_NAME:-docker}
  depends_on:
  - postgres
  - rabbitmq
  labels:
  - traefik.enable=true
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefix:/pecan/
  - traefik.backend=pecan
  volumes:
  - pecan:/data
  - pecan:/var/www/html/pecan/data</code></pre>
<p>Its Dockerfile ships with the PEcAn source code, in <a href="https://github.com/PecanProject/pecan/blob/develop/docker/base/Dockerfile.web"><code>docker/base/Dockerfile.web</code></a>.</p>
<p>In terms of <a href="#pecan-docker-develop">actively developing PEcAn using Docker</a>, this is the service to modify when making changes to the web interface (i.e. PHP, HTML, and JavaScript code located in the PEcAn <code>web</code> directory).</p>
</div>
<div id="pecan-dc-executor" class="section level3">
<h3><span class="header-section-number">22.3.13</span> <code>executor</code></h3>
<p>This service is in charge of running the R code underlying the core PEcAn workflow.
However, it is <em>not</em> in charge of executing the models themselves – model binaries are located on their <a href="docker-index.html#pecan-dc-models">own dedicated Docker containers</a>, and model execution is coordinated by RabbitMQ.</p>
<p>Our configuration is as follows:</p>
<pre><code>executor:
  image: pecan/executor:${PECAN_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  environment:
  - RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
  - FQDN=${PECAN_FQDN:-docker}
  depends_on:
  - postgres
  - rabbitmq
  volumes: pecan:/data</code></pre>
<p>Its Dockerfile is ships with the PEcAn source code, in <a href="https://github.com/PecanProject/pecan/blob/develop/docker/base/Dockerfile.executor"><code>docker/base/Dockerfile.executor</code></a>.
Its image is built on top of the <code>pecan/base</code> image (<a href="https://github.com/PecanProject/pecan/blob/develop/docker/base/Dockerfile.base"><code>docker/base/Dockerfile.base</code></a>), which contains the actual PEcAn source.
To facilitate caching, the <code>pecan/base</code> image is itself built on top of the <code>pecan/depends</code> image (<a href="https://github.com/PecanProject/pecan/blob/develop/docker/base/Dockerfile.depends"><code>docker/base/Dockerfile.depends</code></a>), a large image that contains an R installation and PEcAn’s many system and R package dependencies (which usually take ~30 minutes or longer to install from scratch).</p>
<p>In terms of <a href="#pecan-docker-develop">actively developing PEcAn using Docker</a>, this is the service to modify when making changes to the PEcAn R source code.
Note that, unlike changes to the <code>web</code> image’s PHP code, changes to the R source code do not immediately propagate to the PEcAn container; instead, you have to re-compile the code by running <code>make</code> inside the container.</p>
</div>
<div id="pecan-dc-monitor" class="section level3">
<h3><span class="header-section-number">22.3.14</span> <code>monitor</code></h3>
<p>This service will show all models that are currently running <a href="http://localhost:8000/monitor/" class="uri">http://localhost:8000/monitor/</a>. This list returned is JSON and shows all models (grouped by type and version) that are currently running, or where seen in the past. This list will also contain a list of all current active containers, as well as how many jobs are waiting to be processed.</p>
<p>This service is also responsible for registering any new models with PEcAn so users can select it and execute the model from the web interface.</p>
<p>Our current configuration is as follows:</p>
<pre><code>monitor:
  image: pecan/monitor:${PECAN_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  ports: 9999:9999
  environment:
  - RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
  - FQDN=${PECAN_FQDN:-docker}
  depends_on: rabbitmq
  labels:
  - traefik.enable=true
  - traefik.frontend.rule=${TRAEFIK_FRONTEND_RULE:-}PathPrefixStrip:/monitor/
  - traefik.backend=monitor
  volumes: pecan:/data</code></pre>
</div>
<div id="pecan-dc-models" class="section level3">
<h3><span class="header-section-number">22.3.15</span> Model-specific containers</h3>
<p>Additional models are added as additional services.
In general, their configuration should be similar to the following configuration for SIPNET, which ships with PEcAn:</p>
<pre><code>sipnet:
  image: pecan/model-sipnet-r136:${PECAN_VERSION:-latest}
  restart: unless-stopped
  networks: pecan
  environment: RABBITMQ_URI=${RABBITMQ_URI:-amqp://guest:guest@rabbitmq/%2F}
  depends_on: rabbitmq
  volumes: pecan:/data</code></pre>
<p>The PEcAn source contains Dockerfiles for ED2 (<a href="https://github.com/PecanProject/pecan/blob/develop/docker/models/Dockerfile.ed2"><code>docker/models/Dockerfile.ed2</code></a>) and SIPNET (<a href="https://github.com/PecanProject/pecan/blob/develop/docker/models/Dockerfile.sipnet"><code>docker/models/Dockerfile.sipnet</code></a>) that can serve as references.
For additional tips on constructing a Dockerfile for your model, see <a href="docker-index.html#model-docker">Dockerfiles for Models</a>.</p>

</div>
</div>
<div id="model-docker" class="section level2">
<h2><span class="header-section-number">22.4</span> Models using Docker</h2>
<p>This section will discuss how to add new models to PEcAn docker. To be able to add a new model to PEcAn when using docker is as simple as starting a new container. The model will come online and let the PEcAn framework know there is a new model available, there is no need to go through the process of registering this model with PEcAn. Users will be able to select this new model from web interface and run with this model selected.</p>
<p>For this process to work a docker image of the model will need to be created as well as small json file that is used to announce this new model. A separate service in PEcAn (<a href="docker-index.html#pecan-dc-monitor"><code>monitor</code></a>) will use this json file to keep track of all models available as well as register these models with PEcAn.</p>
<p><a href="docker-index.html#model-docker-json-file">Model information</a>
<a href="docker-index.html#model-docker-Dockerfile">Model build</a>
<a href="docker-index.html#common-docker-problems">Common problems</a></p>
<div id="model-docker-json-file" class="section level3">
<h3><span class="header-section-number">22.4.1</span> Model information</h3>
<p>Each model will have a small json file called model_info.json that is used to describe the model and used by the monitor service to register the model with PEcAn. This file will contain information about the model that is send as part of the heartbeat of the container to the monitor service. Below is an example of this file for the ED model. The required fields are <code>name</code>, <code>type</code>, <code>version</code> and <code>binary</code>. The fields <code>type</code> and <code>version</code> are used by PEcAn to send the messages to RabbitMQ. There is no need to specify the queue name explicitly. The queue name will be created by combining these two fields with an underscore. The field <code>binary</code> is used to point to the actual binary in the docker container.</p>
<p>There are 2 special values that can be used, <code>@VERSION@</code> which will be replaced by the version that is passed in when building the container, and <code>@BINARY@</code> which will be replaced by the binary when building the docker image.</p>
<div class="sourceCode" id="cb313"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb313-1" data-line-number="1"><span class="fu">{</span></a>
<a class="sourceLine" id="cb313-2" data-line-number="2">  <span class="dt">&quot;name&quot;</span><span class="fu">:</span> <span class="st">&quot;ED2.2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-3" data-line-number="3">  <span class="dt">&quot;type&quot;</span><span class="fu">:</span> <span class="st">&quot;ED2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-4" data-line-number="4">  <span class="dt">&quot;version&quot;</span><span class="fu">:</span> <span class="st">&quot;@VERSION@&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-5" data-line-number="5">  <span class="dt">&quot;binary&quot;</span><span class="fu">:</span> <span class="st">&quot;@BINARY@&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-6" data-line-number="6">  <span class="dt">&quot;description&quot;</span><span class="fu">:</span> <span class="st">&quot;The Ecosystem Demography Biosphere Model (ED2) is an integrated terrestrial biosphere model incorporating hydrology, land-surface biophysics, vegetation dynamics, and soil carbon and nitrogen biogeochemistry&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-7" data-line-number="7">  <span class="dt">&quot;author&quot;</span><span class="fu">:</span> <span class="st">&quot;Mike Dietze&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-8" data-line-number="8">  <span class="dt">&quot;contributors&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;David LeBauer&quot;</span><span class="ot">,</span> <span class="st">&quot;Xiaohui Feng&quot;</span><span class="ot">,</span> <span class="st">&quot;Dan Wang&quot;</span><span class="ot">,</span> <span class="st">&quot;Carl Davidson&quot;</span><span class="ot">,</span> <span class="st">&quot;Rob Kooper&quot;</span><span class="ot">,</span> <span class="st">&quot;Shawn Serbin&quot;</span><span class="ot">,</span> <span class="st">&quot;Alexey Shiklomanov&quot;</span><span class="ot">]</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-9" data-line-number="9">  <span class="dt">&quot;links&quot;</span><span class="fu">:</span> <span class="fu">{</span></a>
<a class="sourceLine" id="cb313-10" data-line-number="10">    <span class="dt">&quot;source&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/EDmodel/ED2&quot;</span><span class="fu">,</span></a>
<a class="sourceLine" id="cb313-11" data-line-number="11">    <span class="dt">&quot;issues&quot;</span><span class="fu">:</span> <span class="st">&quot;https://github.com/EDmodel/ED2/issues&quot;</span></a>
<a class="sourceLine" id="cb313-12" data-line-number="12">  <span class="fu">},</span></a>
<a class="sourceLine" id="cb313-13" data-line-number="13">  <span class="dt">&quot;inputs&quot;</span><span class="fu">:</span> <span class="fu">{},</span></a>
<a class="sourceLine" id="cb313-14" data-line-number="14">  <span class="dt">&quot;citation&quot;</span><span class="fu">:</span> <span class="ot">[</span><span class="st">&quot;Medvigy D., Wofsy S. C., Munger J. W., Hollinger D. Y., Moorcroft P. R. 2009. Mechanistic scaling of ecosystem function and dynamics in space and time: Ecosystem Demography model version 2. J. Geophys. Res. 114 (doi:10.1029/2008JG000812)&quot;</span><span class="ot">]</span></a>
<a class="sourceLine" id="cb313-15" data-line-number="15"><span class="fu">}</span></a></code></pre></div>
<p>Other fields that are recommended, but currently not used yet, are:</p>
<ul>
<li><code>description</code> : a longer description of the model.</li>
<li><code>creator</code> : contact person about this docker image.</li>
<li><code>contribuor</code> : other people that have contributed to this docker image.</li>
<li><code>links</code> : addtional links to help people when using this docker image, for example values that can be used are <code>source</code> to link to the source code, <code>issues</code> to link to issue tracking system, and <code>documentation</code> to link to model specific documentation.</li>
<li><code>citation</code> : how the model should be cited in publications.</li>
</ul>
</div>
<div id="model-docker-Dockerfile" class="section level3">
<h3><span class="header-section-number">22.4.2</span> Model build</h3>
<p>In general we try to minimize the size of the images. To be able to do this we split the process of creating the building of the model images into two pieces (or leverage of an image that exists from the original model developers). If you look at the example Dockerfile you will see that there are 2 sections, the first section will build the model binary, the second section will build the actual PEcAn model, which copies the binary from the first section.</p>
<p>This is an example of how the ED2 model is build. This will install all the packages needed to build ED2 model, gets the latest version from GitHub and builds the model.</p>
<p>The second section will create the actual model runner. This will leverage the PEcAn model image that has PEcAn already installed as well as the python code to listen for messages and run the actual model code. This will install some additional packages needed by the model binary (more about that below), copy the model_info.json file and change the <code>@VERSION@</code> and <code>@BINARY@</code> placeholders.</p>
<p>It is important values for <code>type</code> and <code>version</code> are set correct. The PEcAn code will use these to register the model with the BETY database, which is then used by PEcAn to send out a message to a specfic worker queue, if you do not set these variables correctly your model executor will pick up messages for the wrong model.</p>
<p>To build the docker image, we use a Dockerfile (see example below) and run the following command. This command will expect the Dockerfile to live in the model specific folder and the command is executed in the root pecan folder. It will copy the content of the pecan folder and make it available to the build process (in this example we do not need any additional files).</p>
<p>Since we can have multiple different versions of a model be available for PEcAn we ar using the following naming schema <code>pecan/model-&lt;modeltype&gt;-&lt;version&gt;:&lt;pecan version</code>. For example the image below will be named pecan/model-ed2-git, since we do not specify the exact version it will be atomically be named <code>pecan/model-ed2-git:latest</code>.</p>
<div class="sourceCode" id="cb314"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb314-1" data-line-number="1"><span class="ex">docker</span> build \</a>
<a class="sourceLine" id="cb314-2" data-line-number="2">    --tag pecan/model-ed2-git \</a>
<a class="sourceLine" id="cb314-3" data-line-number="3">    --file models/ed/Dockerfile \</a>
<a class="sourceLine" id="cb314-4" data-line-number="4">    .</a></code></pre></div>
<p>Example of a Dockerfile, in this case to build the ED2 model.</p>
<div class="sourceCode" id="cb315"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb315-1" data-line-number="1"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-2" data-line-number="2"><span class="co"># BUILD MODEL BINARY</span></a>
<a class="sourceLine" id="cb315-3" data-line-number="3"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-4" data-line-number="4"><span class="kw">FROM</span> debian:stretch as model-binary</a>
<a class="sourceLine" id="cb315-5" data-line-number="5"></a>
<a class="sourceLine" id="cb315-6" data-line-number="6"><span class="co"># Some variables that can be used to set control the docker build</span></a>
<a class="sourceLine" id="cb315-7" data-line-number="7"><span class="kw">ARG</span> MODEL_VERSION=git</a>
<a class="sourceLine" id="cb315-8" data-line-number="8"></a>
<a class="sourceLine" id="cb315-9" data-line-number="9"><span class="co"># install dependencies</span></a>
<a class="sourceLine" id="cb315-10" data-line-number="10"><span class="kw">RUN</span> apt-get update \</a>
<a class="sourceLine" id="cb315-11" data-line-number="11">    &amp;&amp; apt-get install -y --no-install-recommends \</a>
<a class="sourceLine" id="cb315-12" data-line-number="12">       build-essential \</a>
<a class="sourceLine" id="cb315-13" data-line-number="13">       curl \</a>
<a class="sourceLine" id="cb315-14" data-line-number="14">       gfortran \</a>
<a class="sourceLine" id="cb315-15" data-line-number="15">       git \</a>
<a class="sourceLine" id="cb315-16" data-line-number="16">       libhdf5-dev \</a>
<a class="sourceLine" id="cb315-17" data-line-number="17">       libopenmpi-dev \</a>
<a class="sourceLine" id="cb315-18" data-line-number="18">    &amp;&amp; rm -rf /var/lib/apt/lists/*</a>
<a class="sourceLine" id="cb315-19" data-line-number="19"></a>
<a class="sourceLine" id="cb315-20" data-line-number="20"><span class="co"># download, unzip and build ed2</span></a>
<a class="sourceLine" id="cb315-21" data-line-number="21"><span class="kw">WORKDIR</span> /src</a>
<a class="sourceLine" id="cb315-22" data-line-number="22"><span class="kw">RUN</span> git -c http.sslVerify=false clone https://github.com/EDmodel/ED2.git \</a>
<a class="sourceLine" id="cb315-23" data-line-number="23">    &amp;&amp; cd ED2/ED/build \</a>
<a class="sourceLine" id="cb315-24" data-line-number="24">    &amp;&amp; curl -o make/include.mk.VM http://isda.ncsa.illinois.edu/~kooper/EBI/include.mk.opt.Linux \</a>
<a class="sourceLine" id="cb315-25" data-line-number="25">    &amp;&amp; if [ <span class="st">&quot;${MODEL_VERSION}&quot;</span> != <span class="st">&quot;git&quot;</span> ]; then git checkout ${MODEL_VERSION}; fi \</a>
<a class="sourceLine" id="cb315-26" data-line-number="26">    &amp;&amp; ./install.sh -g -p VM</a>
<a class="sourceLine" id="cb315-27" data-line-number="27"></a>
<a class="sourceLine" id="cb315-28" data-line-number="28"><span class="co">########################################################################</span></a>
<a class="sourceLine" id="cb315-29" data-line-number="29"></a>
<a class="sourceLine" id="cb315-30" data-line-number="30"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-31" data-line-number="31"><span class="co"># BUILD PECAN FOR MODEL</span></a>
<a class="sourceLine" id="cb315-32" data-line-number="32"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-33" data-line-number="33"><span class="kw">FROM</span> pecan/models:latest</a>
<a class="sourceLine" id="cb315-34" data-line-number="34"></a>
<a class="sourceLine" id="cb315-35" data-line-number="35"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-36" data-line-number="36"><span class="co"># INSTALL MODEL SPECIFIC PIECES</span></a>
<a class="sourceLine" id="cb315-37" data-line-number="37"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-38" data-line-number="38"></a>
<a class="sourceLine" id="cb315-39" data-line-number="39"><span class="kw">RUN</span> apt-get update \</a>
<a class="sourceLine" id="cb315-40" data-line-number="40">    &amp;&amp; apt-get install -y --no-install-recommends \</a>
<a class="sourceLine" id="cb315-41" data-line-number="41">       libgfortran3 \</a>
<a class="sourceLine" id="cb315-42" data-line-number="42">       libopenmpi2 \</a>
<a class="sourceLine" id="cb315-43" data-line-number="43">    &amp;&amp; rm -rf /var/lib/apt/lists/*</a>
<a class="sourceLine" id="cb315-44" data-line-number="44"></a>
<a class="sourceLine" id="cb315-45" data-line-number="45"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-46" data-line-number="46"><span class="co"># SETUP FOR SPECIFIC MODEL</span></a>
<a class="sourceLine" id="cb315-47" data-line-number="47"><span class="co"># ----------------------------------------------------------------------</span></a>
<a class="sourceLine" id="cb315-48" data-line-number="48"></a>
<a class="sourceLine" id="cb315-49" data-line-number="49"><span class="co"># Some variables that can be used to set control the docker build</span></a>
<a class="sourceLine" id="cb315-50" data-line-number="50"><span class="kw">ARG</span> MODEL_VERSION=git</a>
<a class="sourceLine" id="cb315-51" data-line-number="51"></a>
<a class="sourceLine" id="cb315-52" data-line-number="52"><span class="co"># Setup model_info file</span></a>
<a class="sourceLine" id="cb315-53" data-line-number="53"><span class="kw">COPY</span> models/ed/model_info.json /work/model.json</a>
<a class="sourceLine" id="cb315-54" data-line-number="54"><span class="kw">RUN</span> sed -i -e <span class="st">&quot;s/@VERSION@/${MODEL_VERSION}/g&quot;</span> \</a>
<a class="sourceLine" id="cb315-55" data-line-number="55">           -e <span class="st">&quot;s#@BINARY@#/usr/local/bin/ed2.${MODEL_VERSION}#g&quot;</span> /work/model.json</a>
<a class="sourceLine" id="cb315-56" data-line-number="56"></a>
<a class="sourceLine" id="cb315-57" data-line-number="57"><span class="co"># COPY model binary</span></a>
<a class="sourceLine" id="cb315-58" data-line-number="58"><span class="kw">COPY</span> --from=model-binary /src/ED2/ED/build/ed_2.1-opt /usr/local/bin/ed2.${MODEL_VERSION}</a></code></pre></div>
<p><strong>WARNING</strong>: Dockerfile environment variables set via <code>ENV</code> are assigned <em>all at once</em>; <em>they do not evaluate successively, left to right</em>.
Consider the following block:</p>
<div class="sourceCode" id="cb316"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb316-1" data-line-number="1"><span class="co"># Don&#39;t do this!</span></a>
<a class="sourceLine" id="cb316-2" data-line-number="2"><span class="kw">ENV</span> MODEL_TYPE=<span class="st">&quot;SIPNET&quot;</span> \</a>
<a class="sourceLine" id="cb316-3" data-line-number="3">    MODEL_VERSION=136 \</a>
<a class="sourceLine" id="cb316-4" data-line-number="4">    MODEL_TYPE_VERSION=${MODEL_TYPE}_${MODEL_VERSION}   <span class="co"># &lt;- Doesn&#39;t know about MODEL_TYPE or MODEL_VERSION!</span></a></code></pre></div>
<p>In this block, the expansion for setting <code>MODEL_TYPE_VERSION</code> <em>is not aware</em> of the current values of <code>MODEL_TYPE</code> or <code>MODEL_VERSION</code>, and will therefore be set incorrectly to just <code>_</code> (unless they have been set previously, in which case it will be aware only of their earlier values).
As such, <strong>variables depending on other variables must be set in a separate, subsequent <code>ENV</code> statement than the variables they depend on</strong>.</p>
<p>Once the model has build and is working we can add it to the PEcAn stack and be able to use this model in the web interface. There are two methods to start this new model. First, we can add it to the <code>docker-compose.yml</code> file and start the container using <code>docker-compose -p pecan -d up</code>.</p>
<div class="sourceCode" id="cb317"><pre class="sourceCode yaml"><code class="sourceCode yaml"><a class="sourceLine" id="cb317-1" data-line-number="1">  <span class="fu">sipnet:</span></a>
<a class="sourceLine" id="cb317-2" data-line-number="2">    <span class="fu">image:</span><span class="at"> pecan/model-ed2-git</span></a>
<a class="sourceLine" id="cb317-3" data-line-number="3">    <span class="fu">networks:</span></a>
<a class="sourceLine" id="cb317-4" data-line-number="4">      <span class="kw">-</span> pecan</a>
<a class="sourceLine" id="cb317-5" data-line-number="5">    <span class="fu">volumes:</span></a>
<a class="sourceLine" id="cb317-6" data-line-number="6">      <span class="kw">-</span> <span class="fu">pecan:</span><span class="at">/data</span></a>
<a class="sourceLine" id="cb317-7" data-line-number="7">    <span class="fu">depends_on:</span></a>
<a class="sourceLine" id="cb317-8" data-line-number="8">       <span class="kw">-</span> rabbitmq</a>
<a class="sourceLine" id="cb317-9" data-line-number="9">    <span class="fu">restart:</span><span class="at"> unless-stopped</span></a></code></pre></div>
<p>Alternatively we can start the container manually using the following command.</p>
<div class="sourceCode" id="cb318"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb318-1" data-line-number="1"><span class="ex">docker</span> run \</a>
<a class="sourceLine" id="cb318-2" data-line-number="2">    --detach \</a>
<a class="sourceLine" id="cb318-3" data-line-number="3">    --rm \</a>
<a class="sourceLine" id="cb318-4" data-line-number="4">    --name pecan-ed2-git \</a>
<a class="sourceLine" id="cb318-5" data-line-number="5">    --networks pecan_pecan \</a>
<a class="sourceLine" id="cb318-6" data-line-number="6">    --volume pecan_pecan:/data</a>
<a class="sourceLine" id="cb318-7" data-line-number="7">    <span class="ex">pecan/model-ed2-git</span></a></code></pre></div>
</div>
<div id="common-docker-problems" class="section level3">
<h3><span class="header-section-number">22.4.3</span> Common problems</h3>
<p>Following are some solutions for common problems that you might encounter when building the docker images for a model.</p>
</div>
<div id="debugging-missing-libraries" class="section level3">
<h3><span class="header-section-number">22.4.4</span> Debugging missing libraries</h3>
<p>When building the model binary it might require specific libraries to be installed. In the second stage the model binary is copied into a new image, which could result in the binary missing specific libraries. In the case of the ED2 model the following was used to find the libraries that are needed to be installed (libgfortran5 and libopenmpi3).</p>
<p>The first step is to build the model using the Dockerfile (in this case the ap-get install was missing in the second stage).</p>
<pre><code>Step 5/9 : RUN git clone https://github.com/EDmodel/ED2.git     &amp;&amp; cd ED2/ED/build     &amp;&amp; curl -o make/include.mk.VM http://isda.ncsa.illinois.edu/~kooper/EBI/include.mk.opt.`uname -s`     &amp;&amp; if [ &quot;${MODEL_VERSION}&quot; != &quot;git&quot; ]; then git checkout ${MODEL_VERSION}; fi     &amp;&amp; ./install.sh -g -p VM
... LOTS OF OUTPUT ...
make[1]: Leaving directory &#39;/src/ED2/ED/build/bin-opt-E&#39;
Installation Complete.
Removing intermediate container a53eba9a8fc1
 ---&gt; 7f23c6302130
Step 6/9 : FROM pecan/executor:latest
 ---&gt; f19d81b739f5
... MORE OUTPUT ...
Step 9/9 : COPY --from=model-binary /src/ED2/ED/build/ed_2.1-opt /usr/local/bin/ed2.${MODEL_VERSION}
 ---&gt; 07ac841be457
Successfully built 07ac841be457
Successfully tagged pecan/pecan-ed2:latest</code></pre>
<p>At this point we have created a docker image with the binary and all PEcAn code that is needed to run the model. Some models (especially those build as native code) might be missing additional packages that need to be installed in the docker image. To see if all libraries are installed for the binary.</p>
<div class="sourceCode" id="cb320"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb320-1" data-line-number="1"><span class="op">&gt;</span> <span class="ex">docker</span> run -ti --rm pecan/pecan-ed2 /bin/bash</a>
<a class="sourceLine" id="cb320-2" data-line-number="2"><span class="ex">root@8a95ee8b6b47</span>:/work# ldd /usr/local/bin/ed2.git  <span class="kw">|</span> <span class="fu">grep</span> <span class="st">&quot;not found&quot;</span></a>
<a class="sourceLine" id="cb320-3" data-line-number="3">    <span class="ex">libmpi_usempif08.so.40</span> =<span class="op">&gt;</span> not found</a>
<a class="sourceLine" id="cb320-4" data-line-number="4">    <span class="ex">libmpi_usempi_ignore_tkr.so.40</span> =<span class="op">&gt;</span> not found</a>
<a class="sourceLine" id="cb320-5" data-line-number="5">    <span class="ex">libmpi_mpifh.so.40</span> =<span class="op">&gt;</span> not found</a>
<a class="sourceLine" id="cb320-6" data-line-number="6">    <span class="ex">libmpi.so.40</span> =<span class="op">&gt;</span> not found</a>
<a class="sourceLine" id="cb320-7" data-line-number="7">    <span class="ex">libgfortran.so.5</span> =<span class="op">&gt;</span> not found</a></code></pre></div>
<p>Start the build container again (this is the number before the line FROM pecan/executor:latest, 7f23c6302130 in the example), and find the missing libraries listed above (for example libmpi_usempif08.so.40):</p>
<div class="sourceCode" id="cb321"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb321-1" data-line-number="1"><span class="op">&gt;</span> <span class="ex">docker</span> run --rm -ti 7f23c6302130</a>
<a class="sourceLine" id="cb321-2" data-line-number="2"><span class="ex">root@e716c63c031f</span>:/src# dpkg -S libmpi_usempif08.so.40</a>
<a class="sourceLine" id="cb321-3" data-line-number="3"><span class="ex">libopenmpi3</span>:amd64: /usr/lib/x86_64-linux-gnu/openmpi/lib/libmpi_usempif08.so.40.10.1</a>
<a class="sourceLine" id="cb321-4" data-line-number="4"><span class="ex">libopenmpi3</span>:amd64: /usr/lib/x86_64-linux-gnu/libmpi_usempif08.so.40.10.1</a>
<a class="sourceLine" id="cb321-5" data-line-number="5"><span class="ex">libopenmpi3</span>:amd64: /usr/lib/x86_64-linux-gnu/libmpi_usempif08.so.40</a></code></pre></div>
<p>This shows the pages is libopenmpi3 that needs to be installed, do this for all missing packages, modify the Dockerfile and rebuild. Next time you run the ldd command there should be no more packages being listed.</p>

</div>
</div>
<div id="docker-build-images" class="section level2">
<h2><span class="header-section-number">22.5</span> Building and modifying images</h2>
<p>The only other section on this page is:
<a href="docker-index.html#docker-local-devel">Local development and testing with Docker</a></p>
<p>For general use, it is sufficient to use the pre-built PEcAn images hosted on <a href="https://hub.docker.com/r/pecan/">Docker Hub</a> (see <a href="docker-index.html#docker-quickstart">Docker quickstart</a>).
However, there are cases where it makes sense to re-build the Docker images locally.
The following is a list of PEcAn-specific images and reasons why you would want to rebuild them locally:</p>
<ul>
<li><code>pecan/depends</code> – Rebuild if:
<ul>
<li>You modify the <code>docker/base/Dockerfile.depends</code></li>
<li>You introduce new system dependencies (i.e. things that need to be installed with <code>apt-get</code>)</li>
<li>You introduce new R package dependencies, and you want those R package installations to be cached during future builds. For packages with fast build times, it may be fine to let them be installed as part of PEcAn’s standard build process (i.e. <code>make</code>).</li>
</ul></li>
<li><code>pecan/base</code> – Rebuild if:
<ul>
<li>You built a new version of <code>pecan/depends</code> (on which <code>pecan/base</code> depends)</li>
<li>You modify the <code>docker/base/Dockerfile.base</code></li>
<li>You made changes to the PEcAn R package source code, the Makefile, or <code>web/workflow.R</code>.
<ul>
<li>NOTE that changes to the web interface code affect <code>pecan/web</code>, <em>not</em> <code>pecan/base</code></li>
</ul></li>
</ul></li>
<li><code>pecan/executor</code> – Rebuild if:
<ul>
<li>You built a new version of <code>pecan/base</code> (on which <code>pecan/executor</code> depends) and/or, <code>pecan/depends</code> (on which <code>pecan/base</code> depends)</li>
<li>You modified the <code>docker/base/Dockerfile.executor</code></li>
<li>You modified the RabbitMQ Python scripts (e.g. <code>docker/receiver.py</code>, <code>docker/sender.py</code>)</li>
</ul></li>
<li><code>pecan/web</code> – Rebuild if you modified any of the following:
<ul>
<li><code>docker/base/Dockerfile.web</code></li>
<li>The PHP/HTML/JavaScript code for the PEcAn web interface in <code>web/</code> (<em>except</em> <code>web/workflow.R</code> – that goes in <code>pecan/base</code>)</li>
<li><code>docker/config.docker.php</code> (the <code>config.php</code> file for Docker web instances)</li>
<li><code>documentation/index_vm.html</code> (the documentation HTML website)</li>
<li>NOTE: Because changes to this code are applied instantly (i.e. do not require compilation or installation), a more effective way to do local development may be to mount the <code>web/</code> or other relevant folders as a volume onto the <code>pecan/web</code> container.</li>
</ul></li>
</ul>
<p>The easiest way to quickly re-build all of the images is using the <code>docker.sh</code> script in the PEcAn source code root directory.
This script will build all of the docker images locally on your machine, and tag them as <code>latest</code>.
This will not build the <code>pecan/depends</code> image by default because that takes considerably longer.
However, you can force the script to build <code>pecan/depends</code> as well by setting the <code>DEPEND</code> environment variable to 1 (i.e. <code>DEPEND=1 ./docker.sh</code>).
The following instructions provide details on how to build each image individually.</p>
<p>To build an image locally, use the <code>docker build</code> command as described below.
For more details, see <code>docker build --help</code> or the <a href="https://docs.docker.com/engine/reference/commandline/build/">online Docker build documentation</a>.</p>
<p>First, in a terminal window, navigate (<code>cd</code>) into the PEcAn source code root directory.
From there, the general syntax for building an image looks like the following:</p>
<div class="sourceCode" id="cb322"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb322-1" data-line-number="1"><span class="ex">docker</span> build -t pecan/<span class="op">&lt;</span>image name<span class="op">&gt;</span>:<span class="op">&lt;</span>image version<span class="op">&gt;</span> -f docker/base/Dockerfile.<span class="op">&lt;</span>image name<span class="op">&gt;</span> .</a></code></pre></div>
<p>For instance, to build a local version of the <code>pecan/depends:latest</code> image, you would run:</p>
<div class="sourceCode" id="cb323"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb323-1" data-line-number="1"><span class="ex">docker</span> build -t pecan/depends:latest -f docker/base/Dockerfile.depends .</a></code></pre></div>
<p>The breakdown of this command is as follows:</p>
<ul>
<li><p><code>docker build</code> – This is the core command.
The standard syntax is <code>docker build [OPTIONS] &lt;PATH&gt;</code>, where <code>&lt;PATH&gt;</code> refers to the directory to be used as the “build context”.
The “build context” is the working directory assumed by the Dockerfiles.
In PEcAn, this is always the PEcAn source code root directory, which allows Dockerfiles to use instructions such as <code>COPY web/workflow.R /work/</code>.
In this example, the <code>&lt;PATH&gt;</code> is set to the current working directory, i.e. <code>.</code> because we are already in the PEcAn root directory.
If you were located in a different directory, you would have to provide a path to the PEcAn source code root directory.
Also, by default, <code>docker build</code> will look for a Dockerfile located at <code>&lt;PATH&gt;/Dockerfile</code>, but this is modified by the <code>-f</code> option described below.</p></li>
<li><code>-t pecan/depends:latest</code> – The <code>-t/--tag</code> option specifies how the image will be labeled.
By default, Docker only defines unique image IDs, which are hexidecimal strings that are unintuitive and hard to remember.
Tags are useful for referring to specific images in a human-readable way.
Note that the same unique image can have multiple tags associated with it, so it is possible for, e.g. <code>pecan/depends:latest</code>, <code>pecan/depends:custom</code>, and even <code>mypecan/somethingelse:20.0</code> to refer to the same exact image.
To see a table of all local images, including their tags and IDs, run <code>docker image ls</code>.
<ul>
<li><strong>NOTE</strong>: PEcAn’s <code>docker-compose.yml</code> can be configured via the <code>PECAN</code> environment variable to point at different versions of PEcAn images.
By default, it points to the <code>:latest</code> versions of all images.
However, if you wanted to, for instance, build <code>:local</code> images corresponding to your local source code and then run that version of PEcAn, you would run:</li>
</ul>
<pre><code>PECAN=local docker-compose -p pecan up -d</code></pre>
<p>This is an effective way to do local development and testing of different PEcAn versions, as described <a href="docker-index.html#docker-local-devel">below</a>.</p></li>
<li><p><code>-f docker/base/Dockerfile.depends</code> – The <code>-f/--file</code> tag is used to provide an alternative location and file name for the Dockerfile.
The convention in PEcAn is to put Dockerfiles for core PEcAn functionality in <code>docker/base/</code> and for specific models in <code>docker/models/</code>, and to name these files <code>Dockerfile.&lt;image name&gt;</code>.</p></li>
</ul>
<div id="docker-local-devel" class="section level3">
<h3><span class="header-section-number">22.5.1</span> Local development and testing with Docker</h3>
<p>The following is an example of one possible workflow for developing and testing PEcAn using local Docker images.
The basic idea is to mount a local version of the PEcAn source code onto a running <code>pecan/executor</code> image, and then send a special “rebuild” RabbitMQ message to the container to trigger the rebuild whenever you make changes.
NOTE: All commands assume you are working from the PEcAn source code root directory.</p>
<ol style="list-style-type: decimal">
<li><p>In the PEcAn source code directory, create a <code>docker-compose.override.yml</code> file with the following contents.:</p>
<div class="sourceCode" id="cb325"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb325-1" data-line-number="1"><span class="fu">version:</span><span class="at"> </span><span class="st">&quot;3&quot;</span></a>
<a class="sourceLine" id="cb325-2" data-line-number="2"><span class="fu">services:</span></a>
<a class="sourceLine" id="cb325-3" data-line-number="3">  <span class="fu">executor:</span></a>
<a class="sourceLine" id="cb325-4" data-line-number="4">    <span class="fu">volumes:</span></a>
<a class="sourceLine" id="cb325-5" data-line-number="5">      <span class="kw">-</span> <span class="fu">.:</span><span class="at">/pecan</span></a></code></pre></div>
<p>This will mount the current directory <code>.</code> to the <code>/pecan</code> directory in the <code>executor</code> container.
The special <code>docker-compose.override.yml</code> file is read automatically by <code>docker-compose</code> and overrides or extends any instructions set in the original <code>docker-compose.yml</code> file.
It provides a convenient way to host server-specific configurations without having to modify the project-wide (and version-controlled) default configuration.
For more details, see the <a href="https://docs.docker.com/compose/extends/">Docker Compose documentation</a>.</p></li>
<li><p>Update your PEcAn Docker stack with <code>docker-compose up -d</code>.
If the stack is already running, this should only restart your <code>executor</code> instance while leaving the remaining containers running.</p></li>
<li><p>To update to the latest local code, run <code>./scripts/docker_rebuild.sh</code>.
Under the hood, this uses <code>curl</code> to post a RabbitMQ message to a running Docker instance.
By default, the scripts assumes that username and password are both <code>guest</code> and that the RabbitMQ URL is <code>http://localhost:8000/rabbitmq</code>.
All of these can be customized by setting the environment variables <code>RABBITMQ_USER</code>, <code>RABBITMQ_PASSWORD</code>, and <code>RABBITMQ_URL</code>, respectively (or running the script prefixed with those variables, e.g. <code>RABBITMQ_USER=carya RABBITMQ_PASSWORD=illinois ./scripts/docker_rebuild.sh</code>).
This step can be repeated whenever you want to trigger a rebuild of the local code.</p></li>
</ol>
<p>NOTE: The updates with this workflow are <em>specific to the running container session</em>; restarting the <code>executor</code> container will revert to the previous versions of the installed packages.
To make persistent changes, you should re-build the <code>pecan/base</code> and <code>pecan/executor</code> containers against the current version of the source code.</p>
<p>NOTE: The mounted PEcAn source code directory includes <em>everything</em> in your local source directory, <em>including installation artifacts used by make</em>.
This can lead to two common issues:
- Any previous make cache files (stuff in the <code>.install</code>, <code>.docs</code>, etc. directories) persist across container instances, even though the installed packages may not. To ensure a complete build, it’s a good idea to run <code>make clean</code> on the host machine to remove these artifacts.
- Similarly, any installation artifacts from local builds will be carried over to the build. In particular, be wary of packages with compiled code, such as <code>modules/rtm</code> (<code>PEcAnRTM</code>) – the compiled <code>.o</code>, <code>.so</code>, <code>.mod</code>, etc. files from compilation of such packages will carry over into the build, which can cause conflicts if the package was also built locally.</p>
<p>The <code>docker-compose.override.yml</code> is useful for some other local modifications.
For instance, the following adds a custom ED2 “develop” model container.</p>
<div class="sourceCode" id="cb326"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb326-1" data-line-number="1"><span class="fu">services:</span></a>
<a class="sourceLine" id="cb326-2" data-line-number="2">  <span class="co"># ...</span></a>
<a class="sourceLine" id="cb326-3" data-line-number="3">  <span class="fu">ed2devel:</span></a>
<a class="sourceLine" id="cb326-4" data-line-number="4">    <span class="fu">image:</span><span class="at"> pecan/model-ed2-develop:latest</span></a>
<a class="sourceLine" id="cb326-5" data-line-number="5">    <span class="fu">build:</span></a>
<a class="sourceLine" id="cb326-6" data-line-number="6">      <span class="fu">context:</span><span class="at"> ../ED2  </span><span class="co"># Or wherever ED2 source code is found</span></a>
<a class="sourceLine" id="cb326-7" data-line-number="7">    <span class="fu">networks:</span></a>
<a class="sourceLine" id="cb326-8" data-line-number="8">      <span class="kw">-</span> pecan</a>
<a class="sourceLine" id="cb326-9" data-line-number="9">    <span class="fu">depends_on:</span></a>
<a class="sourceLine" id="cb326-10" data-line-number="10">      <span class="kw">-</span> rabbitmq</a>
<a class="sourceLine" id="cb326-11" data-line-number="11">    <span class="fu">volumes:</span></a>
<a class="sourceLine" id="cb326-12" data-line-number="12">      <span class="kw">-</span> <span class="fu">pecan:</span><span class="at">/data</span></a>
<a class="sourceLine" id="cb326-13" data-line-number="13">    <span class="fu">restart:</span><span class="at"> unless-stopped</span></a></code></pre></div>
<p>Similarly, this snippet modifies the <code>pecan</code> network to use a custom IP subnet mask.
This is required on the PNNL cluster because its servers’ IP addresses often clash with Docker’s default IP mask.</p>
<div class="sourceCode" id="cb327"><pre class="sourceCode yml"><code class="sourceCode yaml"><a class="sourceLine" id="cb327-1" data-line-number="1"><span class="fu">networks:</span></a>
<a class="sourceLine" id="cb327-2" data-line-number="2">  <span class="fu">pecan:</span></a>
<a class="sourceLine" id="cb327-3" data-line-number="3">    <span class="fu">ipam:</span></a>
<a class="sourceLine" id="cb327-4" data-line-number="4">      <span class="fu">config:</span></a>
<a class="sourceLine" id="cb327-5" data-line-number="5">        <span class="kw">-</span> <span class="fu">subnet:</span><span class="at"> 10.17.1.0/24</span></a></code></pre></div>

</div>
</div>
<div id="docker-troubleshooting" class="section level2">
<h2><span class="header-section-number">22.6</span> Troubleshooting Docker</h2>
<div id="package-not-available-while-building-images" class="section level3">
<h3><span class="header-section-number">22.6.1</span> “Package not available” while building images</h3>
<p><strong>PROBLEM</strong>: Packages fail to install while building <code>pecan/depends</code> and/or <code>pecan/base</code> with an error like the following:</p>
<pre><code>Installing package into ‘/usr/local/lib/R/site-library’
(as ‘lib’ is unspecified)
Warning: unable to access index for repository https://mran.microsoft.com/snapshot/2018-09-01/src/contrib:
 cannot open URL &#39;https://mran.microsoft.com/snapshot/2018-09-01/src/contrib/PACKAGES&#39;
Warning message:
package ‘&lt;PACKAGE&gt;’ is not available (for R version 3.5.1)</code></pre>
<p><strong>CAUSE</strong>: This can sometimes happen if there are problems with Microsoft’s CRAN snapshots, which are the default repository for the <code>rocker/tidyverse</code> containers.
See GitHub issues <a href="https://github.com/rocker-org/rocker-versioned/issues/102">rocker-org/rocker-versioned#102</a> and <a href="https://github.com/rocker-org/rocker-versioned/issues/58">#58</a>.</p>
<p><strong>SOLUTION</strong>: Add the following line to the <code>depends</code> and/or <code>base</code> Dockerfiles <em>before</em> (i.e. above) any commands that install R packages (e.g. <code>Rscript -e &quot;install.packages(...)&quot;</code>):</p>
<pre><code>RUN echo &quot;options(repos = c(CRAN = &#39;https://cran.rstudio.org&#39;))&quot; &gt;&gt; /usr/local/lib/R/etc/Rprofile.site</code></pre>
<p>This will set the default repository to the more reliable (albeit, more up-to-date; beware of breaking package changes!) RStudio CRAN mirror.
Then, build the image as usual.</p>

</div>
</div>
<div id="docker-migrate" class="section level2">
<h2><span class="header-section-number">22.7</span> Migrating PEcAn from VM to Docker</h2>
<p>This document assumes you have read through the <a href="docker-index.html#docker-intro">Introduction to Docker</a> as well as <a href="docker-index.html#docker-quickstart">Docker quickstart</a> and have docker running on the VM.</p>
<p>This document will slowly replace each of the components with the appropriate docker images. At then end of this document you should be able to use the docker-compose command to bring up the full docker stack as if you had started with this origianally.</p>
<div id="running-bety-as-a-docker-container" class="section level3">
<h3><span class="header-section-number">22.7.1</span> Running BETY as a docker container</h3>
<p>This will replace the BETY application running on the machine with a docker image. This will assume you still have the database running on the local machine and the only thing we replace is the BETY application.</p>
<p>If you are running systemd (Ubuntu 16.04 or Centos 7) you can copy the following file to /etc/systemd/system/bety.service (replace LOCAL_SERVER=99 with your actual server). If you have postgres running on another server replace 127.0.0.1 with the actual ip address of the postgres server.</p>
<pre><code>[Unit]
Description=BETY container
After=docker.service

[Service]
Restart=always
ExecStart=/usr/bin/docker run -t --rm --name bety --add-host=postgres:127.0.0.1 --network=host --env RAILS_RELATIVE_URL_ROOT=/bety --env LOCAL_SERVER=99 pecan/bety
ExecStop=/usr/bin/docker stop -t 2 bety

[Install]
WantedBy=local.target</code></pre>
<p>At this point we can enable the bety service (this only needs to be done once). First we need to tell systemd a new service is available using <code>systemctl daemon-reload</code>. Next we enable the BETY service so it will restart automatically when the machine reboots, using <code>systemctl enable bety</code>. Finally we can start the BETY service using <code>systemctl start bety</code>. At this point BETY is running as a docker container on port 8000. You can see the log messages using <code>journalctl -u bety</code>.</p>
<p>Next we need to modify apache configuration files. The file /etc/apache2/conf-enabled/bety.conf will be replaced with the following content:</p>
<pre><code>ProxyPass                /bety/ http://localhost:8000/bety/
ProxyPassReverse         /bety/ http://localhost:8000/bety/
RedirectMatch permanent ^/bety$ /bety/</code></pre>
<p>Once this modified we can restart apache using <code>systemctl restart apache2</code>. At this point BETY is running in a container and is accessable trough the webserver at <a href="http://server/bety/" class="uri">http://server/bety/</a>.</p>
<p>To upgrade to a new version of BETY you can now use the docker commands. You can use the following commands to stop BETY, pull the latest image down, migrate the database (you made a backup correct?) and start BETY again.</p>
<pre><code>systemctl stop bety
docker pull pecan/bety:latest
docker run -ti --rm --add-host=postgres:127.0.0.1 --network=host --env LOCAL_SERVER=99 pecan/bety migrate
systemctl start bety</code></pre>
<p>Once you are satisfied with the migration of BETY you can remove the bety folder as well as any ruby binaries you have installed.</p>

</div>
</div>
<div id="pecan-api" class="section level2">
<h2><span class="header-section-number">22.8</span> The PEcAn Docker API</h2>
<p>If you have a running instance of Dockerized PEcAn (or other setup where PEcAn workflows are submitted via <a href="docker-index.html#rabbitmq">RabbitMQ</a>),
you have the option of running and managing PEcAn workflows using the <code>pecanapi</code> package.</p>
<p>For more details, see the <code>pecanapi</code> <a href="https://github.com/PecanProject/pecan/blob/develop/api/vignettes/pecanapi.Rmd">package vignette</a> and function-level documentation.
What follows is a lightning introduction.</p>
<div id="installation" class="section level4">
<h4><span class="header-section-number">22.8.0.1</span> Installation</h4>
<p>The package can be installed directly from GitHub via <code>devtools::install_github</code>:</p>
<div class="sourceCode" id="cb333"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb333-1" data-line-number="1">devtools<span class="op">::</span><span class="kw">install_github</span>(<span class="st">&quot;pecanproject/pecan/api@develop&quot;</span>)</a></code></pre></div>
</div>
<div id="creating-and-submitting-a-workflow" class="section level4">
<h4><span class="header-section-number">22.8.0.2</span> Creating and submitting a workflow</h4>
<p>With <code>pecanapi</code>, creating a workflow, submitting it to RabbitMQ, monitoring its progress, and processing its output can all be accomplished via an R script.</p>
<p>Start by loading the package (and the <code>magrittr</code> package, for the <code>%&gt;%</code> pipe operator).</p>
<div class="sourceCode" id="cb334"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb334-1" data-line-number="1"><span class="kw">library</span>(pecanapi)</a>
<a class="sourceLine" id="cb334-2" data-line-number="2"><span class="kw">library</span>(magrittr)</a></code></pre></div>
<p>Set your PEcAn database user ID, and create a database connection object, which will be used for database operations throughout the workflow.</p>
<div class="sourceCode" id="cb335"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb335-1" data-line-number="1"><span class="kw">options</span>(<span class="dt">pecanapi.user_id =</span> <span class="dv">99000000002</span>)</a>
<a class="sourceLine" id="cb335-2" data-line-number="2">con &lt;-<span class="st"> </span>DBI<span class="op">::</span><span class="kw">dbConnect</span>(</a>
<a class="sourceLine" id="cb335-3" data-line-number="3">  RPostgres<span class="op">::</span><span class="kw">Postgres</span>(),</a>
<a class="sourceLine" id="cb335-4" data-line-number="4">  <span class="dt">user =</span> <span class="st">&quot;bety&quot;</span>,</a>
<a class="sourceLine" id="cb335-5" data-line-number="5">  <span class="dt">password =</span> <span class="st">&quot;bety&quot;</span>,</a>
<a class="sourceLine" id="cb335-6" data-line-number="6">  <span class="dt">host =</span> <span class="st">&quot;localhost&quot;</span>,</a>
<a class="sourceLine" id="cb335-7" data-line-number="7">  <span class="dt">port =</span> <span class="dv">5432</span></a>
<a class="sourceLine" id="cb335-8" data-line-number="8">)</a></code></pre></div>
<p>Find model and site IDs for the site and model you want to run.</p>
<div class="sourceCode" id="cb336"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb336-1" data-line-number="1">model_id &lt;-<span class="st"> </span><span class="kw">get_model_id</span>(con, <span class="st">&quot;SIPNET&quot;</span>, <span class="st">&quot;136&quot;</span>)</a>
<a class="sourceLine" id="cb336-2" data-line-number="2">all_umbs &lt;-<span class="st"> </span><span class="kw">search_sites</span>(con, <span class="st">&quot;umbs%disturbance&quot;</span>)</a>
<a class="sourceLine" id="cb336-3" data-line-number="3">site_id &lt;-<span class="st"> </span><span class="kw">subset</span>(all_umbs, <span class="op">!</span><span class="kw">is.na</span>(mat))[[<span class="st">&quot;id&quot;</span>]]</a></code></pre></div>
<p>Insert a new workflow into the PEcAn database, and extract its ID.</p>
<div class="sourceCode" id="cb337"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb337-1" data-line-number="1">workflow &lt;-<span class="st"> </span><span class="kw">insert_new_workflow</span>(con, site_id, model_id,</a>
<a class="sourceLine" id="cb337-2" data-line-number="2">                                <span class="dt">start_date =</span> <span class="st">&quot;2004-01-01&quot;</span>,</a>
<a class="sourceLine" id="cb337-3" data-line-number="3">                                <span class="dt">end_date =</span> <span class="st">&quot;2004-12-31&quot;</span>)</a>
<a class="sourceLine" id="cb337-4" data-line-number="4">workflow_id &lt;-<span class="st"> </span>workflow[[<span class="st">&quot;id&quot;</span>]]</a></code></pre></div>
<p>Pull all of this information together into a settings list object.</p>
<div class="sourceCode" id="cb338"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb338-1" data-line-number="1">settings &lt;-<span class="st"> </span><span class="kw">list</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-2" data-line-number="2"><span class="st">  </span><span class="kw">add_workflow</span>(workflow) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-3" data-line-number="3"><span class="st">  </span><span class="kw">add_database</span>() <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-4" data-line-number="4"><span class="st">  </span><span class="kw">add_pft</span>(<span class="st">&quot;temperate.deciduous&quot;</span>) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-5" data-line-number="5"><span class="st">  </span><span class="kw">add_rabbitmq</span>(<span class="dt">con =</span> con) <span class="op">%&gt;%</span></a>
<a class="sourceLine" id="cb338-6" data-line-number="6"><span class="st">  </span><span class="kw">modifyList</span>(<span class="kw">list</span>(</a>
<a class="sourceLine" id="cb338-7" data-line-number="7">    <span class="dt">meta.analysis =</span> <span class="kw">list</span>(<span class="dt">iter =</span> <span class="dv">3000</span>, <span class="dt">random.effects =</span> <span class="kw">list</span>(<span class="dt">on =</span> <span class="ot">FALSE</span>, <span class="dt">use_ghs =</span> <span class="ot">TRUE</span>)),</a>
<a class="sourceLine" id="cb338-8" data-line-number="8">    <span class="dt">run =</span> <span class="kw">list</span>(<span class="dt">inputs =</span> <span class="kw">list</span>(<span class="dt">met =</span> <span class="kw">list</span>(<span class="dt">source =</span> <span class="st">&quot;CRUNCEP&quot;</span>, <span class="dt">output =</span> <span class="st">&quot;SIPNET&quot;</span>, <span class="dt">method =</span> <span class="st">&quot;ncss&quot;</span>))),</a>
<a class="sourceLine" id="cb338-9" data-line-number="9">    <span class="dt">ensemble =</span> <span class="kw">list</span>(<span class="dt">size =</span> <span class="dv">1</span>, <span class="dt">variable =</span> <span class="st">&quot;NPP&quot;</span>)</a>
<a class="sourceLine" id="cb338-10" data-line-number="10">  ))</a></code></pre></div>
<p>Submit the workflow via RabbitMQ, and monitor its progress in the R process.</p>
<div class="sourceCode" id="cb339"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb339-1" data-line-number="1"><span class="kw">submit_workflow</span>(settings)</a>
<a class="sourceLine" id="cb339-2" data-line-number="2"><span class="kw">watch_workflow</span>(workflow_id)</a></code></pre></div>
<p>Use THREDDS to access and analyze the output.</p>
<div class="sourceCode" id="cb340"><pre class="sourceCode r"><code class="sourceCode r"><a class="sourceLine" id="cb340-1" data-line-number="1">sipnet_out &lt;-<span class="st"> </span>ncdf4<span class="op">::</span><span class="kw">nc_open</span>(<span class="kw">run_dap</span>(workflow_id, <span class="st">&quot;2004.nc&quot;</span>))</a>
<a class="sourceLine" id="cb340-2" data-line-number="2">gpp &lt;-<span class="st"> </span>ncdf4<span class="op">::</span><span class="kw">ncvar_get</span>(sipnet_out, <span class="st">&quot;GPP&quot;</span>)</a>
<a class="sourceLine" id="cb340-3" data-line-number="3">time &lt;-<span class="st"> </span>ncdf4<span class="op">::</span><span class="kw">ncvar_get</span>(sipnet_out, <span class="st">&quot;time&quot;</span>)</a>
<a class="sourceLine" id="cb340-4" data-line-number="4">ncdf4<span class="op">::</span><span class="kw">nc_close</span>(sipnet_out)</a>
<a class="sourceLine" id="cb340-5" data-line-number="5"><span class="kw">plot</span>(time, gpp, <span class="dt">type =</span> <span class="st">&quot;l&quot;</span>)</a></code></pre></div>

</div>
</div>
<div id="rabbitmq" class="section level2">
<h2><span class="header-section-number">22.9</span> RabbitMQ</h2>
<p>This section provides additional details about how PEcAn uses RabbitMQ to manage communication between its Docker containers.</p>
<p>In PEcAn, we use the Python <a href="http://www.rabbitmq.com/tutorials/tutorial-one-python.html"><code>pika</code></a> client to post and retrieve messages from RabbitMQ.
As such, every Docker container that communicates with RabbitMQ contains two Python scripts: <code>sender.py</code> and <code>reciever.py</code>.
Both are located in the <code>docker</code> directory in the PEcAn source code root.</p>
<div id="rabbitmq-basics-sender" class="section level3">
<h3><span class="header-section-number">22.9.1</span> Producer – <code>sender.py</code></h3>
<p>The <code>sender.py</code> script is in charge of posting messages to RabbitMQ.
In the RabbitMQ documentation, it is known as a “producer”.
It runs once for every message posted to RabbitMQ, and then immediately exits (unlike the <code>receiver.py</code>, which runs continuously – see <a href="docker-index.html#rabbitmq-basics-receiver">below</a>).</p>
<p>Its usage is as follows:</p>
<div class="sourceCode" id="cb341"><pre class="sourceCode bash"><code class="sourceCode bash"><a class="sourceLine" id="cb341-1" data-line-number="1"><span class="ex">python3</span> sender.py <span class="op">&lt;</span>URI<span class="op">&gt;</span> <span class="op">&lt;</span>queue<span class="op">&gt;</span> <span class="op">&lt;</span>message<span class="op">&gt;</span></a></code></pre></div>
<p>The arguments are:</p>
<ul>
<li><p><code>&lt;URI&gt;</code> – The unique identifier of the RabbitMQ instance, similar to a URL.
The format is <code>amqp://username:password@host/vhost</code>.
By default, this is <code>amqp://guest:guest@rabbitmq/%2F</code> (the <code>%2F</code> here is the hexadecimal encoding for the <code>/</code> character).</p></li>
<li><p><code>&lt;queue&gt;</code> – The name of the queue on which to post the message.</p></li>
<li><p><code>&lt;message&gt;</code> – The contents of the message to post, in JSON format.
A typical message posted by PEcAn looks like the following:</p>
<div class="sourceCode" id="cb342"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb342-1" data-line-number="1"><span class="fu">{</span> <span class="dt">&quot;folder&quot;</span> <span class="fu">:</span> <span class="st">&quot;/path/to/PEcAn_WORKFLOWID&quot;</span><span class="fu">,</span> <span class="dt">&quot;workflow&quot;</span> <span class="fu">:</span> <span class="st">&quot;WORKFLOWID&quot;</span> <span class="fu">}</span></a></code></pre></div></li>
</ul>
<p>The <code>PEcAn.remote::start_rabbitmq</code> function is a wrapper for this script that provides an easy way to post a <code>folder</code> message to RabbitMQ from R.</p>
</div>
<div id="rabbitmq-basics-receiver" class="section level3">
<h3><span class="header-section-number">22.9.2</span> Consumer – <code>receiver.py</code></h3>
<p>Unlike <code>sender.py</code>, <code>receiver.py</code> runs like a daemon, constantly listening for messages.
In the RabbitMQ documentation, it is known as a “consumer”.
In PEcAn, you can tell that it is ready to receive messages if the corresponding logs (e.g. <code>docker-compose logs executor</code>) show the following message:</p>
<pre><code>[*] Waiting for messages. To exit press CTRL+C.</code></pre>
<p>Our <code>reciever</code> is configured by three environment variables:</p>
<ul>
<li><p><code>RABBITMQ_URI</code> – This defines the URI where RabbitMQ is running.
See corresponding argument in the <a href="docker-index.html#rabbitmq-basics-sender">producer</a></p></li>
<li><p><code>RABBITMQ_QUEUE</code> – This is the name of the queue on which the consumer will listen for messages, just as in the <a href="docker-index.html#rabbitmq-basics-sender">producer</a>.</p></li>
<li><p><code>APPLICATION</code> – This specifies the name (including the path) of the default executable to run when receiving a message.
At the moment, it should be an executable that runs in the directory specified by the message’s <code>folder</code> variable.
In the case of PEcAn models, this is usually <code>./job.sh</code>, such that the <code>folder</code> corresponds to the <code>run</code> directory associated with a particular <code>runID</code> (i.e. where the <code>job.sh</code> is located).
For the PEcAn workflow itself, this is set to <code>R CMD BATCH workflow.R</code>, such that the <code>folder</code> is the root directory of the workflow (in the <code>executor</code> Docker container, something like <code>/data/workflows/PEcAn_&lt;workflowID&gt;</code>).
This default executable is <em>overridden</em> if the message contains a <code>custom_application</code> key.
If included, the string specified by the <code>custom_application</code> key will be run as a command exactly as is on the container, from the directory specified by <code>folder</code>.
For instance, in the example below, the container will print “Hello there!” instead of running its default application.</p>
<div class="sourceCode" id="cb344"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb344-1" data-line-number="1"><span class="fu">{</span><span class="dt">&quot;custom_application&quot;</span><span class="fu">:</span> <span class="st">&quot;echo &#39;Hello there!&#39;&quot;</span><span class="fu">,</span> <span class="dt">&quot;folder&quot;</span><span class="fu">:</span> <span class="st">&quot;/path/to/my/dir&quot;</span><span class="fu">}</span></a></code></pre></div>
<p>NOTE that in RabbitMQ messages, the <code>folder</code> key is always required.</p></li>
</ul>
</div>
<div id="rabbitmq-web" class="section level3">
<h3><span class="header-section-number">22.9.3</span> RabbitMQ and the PEcAn web interface</h3>
<p>RabbitMQ is configured by the following variables in <code>config.php</code>:</p>
<ul>
<li><code>$rabbitmq_host</code> – The RabbitMQ server hostname (default: <code>rabbitmq</code>, because that is the name of the <code>rabbitmq</code> service in <code>docker-compose.yml</code>)</li>
<li><code>$rabbitmq_port</code> – The port on which RabbitMQ listens for messages (default: 5672)</li>
<li><code>$rabbitmq_vhost</code> – The path of the RabbitMQ <a href="https://www.rabbitmq.com/vhosts.html">Virtual Host</a> (default: <code>/</code>).</li>
<li><code>$rabbitmq_queue</code> – The name of the RabbitMQ queue associated with the PEcAn workflow (default: <code>pecan</code>)</li>
<li><code>$rabbitmq_username</code> – The RabbitMQ username (default: <code>guest</code>)</li>
<li><code>$rabbitmq_password</code> – The RabbitMQ password (default: <code>guest</code>)</li>
</ul>
<p>In addition, for running models via RabbitMQ, you will also need to add an entry like the following to the <code>config.php</code> <code>$hostlist</code>:</p>
<div class="sourceCode" id="cb345"><pre class="sourceCode php"><code class="sourceCode php"><a class="sourceLine" id="cb345-1" data-line-number="1"><span class="kw">$hostlist</span>=<span class="kw">array</span><span class="ot">(</span><span class="kw">$fqdn</span> =&gt; <span class="kw">array</span><span class="ot">(</span><span class="st">&quot;rabbitmq&quot;</span> =&gt; <span class="st">&quot;amqp://guest:guest@rabbitmq/%2F&quot;</span><span class="ot">),</span> <span class="st">...</span><span class="ot">)</span></a></code></pre></div>
<p>This will set the hostname to the name of the current machine (defined by the <code>$fqdn</code> variable earlier in the <code>config.php</code> file) to an array with one entry, whose key is <code>rabbitmq</code> and whose value is the RabbitMQ URI (<code>amqp://...</code>).</p>
<p>These values are converted into the appropriate entries in the <code>pecan.xml</code> in <code>web/04-runpecan.php</code>.</p>
</div>
<div id="rabbitmq-xml" class="section level3">
<h3><span class="header-section-number">22.9.4</span> RabbitMQ in the PEcAn XML</h3>
<p>RabbitMQ is a special case of remote execution, so it is configured by the <code>host</code> node.
An example RabbitMQ configuration is as follows:</p>
<div class="sourceCode" id="cb346"><pre class="sourceCode xml"><code class="sourceCode xml"><a class="sourceLine" id="cb346-1" data-line-number="1"><span class="kw">&lt;host&gt;</span></a>
<a class="sourceLine" id="cb346-2" data-line-number="2">  <span class="kw">&lt;rabbitmq&gt;</span></a>
<a class="sourceLine" id="cb346-3" data-line-number="3">    <span class="kw">&lt;uri&gt;</span>amqp://guest:guest@rabbitmq/%2F<span class="kw">&lt;/uri&gt;</span></a>
<a class="sourceLine" id="cb346-4" data-line-number="4">    <span class="kw">&lt;queue&gt;</span>sipnet_136<span class="kw">&lt;/queue&gt;</span></a>
<a class="sourceLine" id="cb346-5" data-line-number="5">  <span class="kw">&lt;/rabbitmq&gt;</span></a>
<a class="sourceLine" id="cb346-6" data-line-number="6"><span class="kw">&lt;/host&gt;</span></a></code></pre></div>
<p>Here, <code>uri</code> and <code>queue</code> have the same general meanings as described in <a href="docker-index.html#rabbitmq-basics-sender">“producer”</a>.
Note that <code>queue</code> here refers to the target model.
In PEcAn, RabbitMQ model queues are named as <code>MODELTYPE_REVISION</code>,
so the example above refers to the SIPNET model version 136.
Another example is <code>ED2_git</code>, referring to the latest <code>git</code> version of the ED2 model.</p>
</div>
<div id="rabbitmq-dockerfile" class="section level3">
<h3><span class="header-section-number">22.9.5</span> RabbitMQ configuration in Dockerfiles</h3>
<p>As described in the <a href="docker-index.html#rabbitmq-basics-receiver">“consumer”</a> section, our standard RabbitMQ receiver script is configured using three environment variables: <code>RABBITMQ_URI</code>, <code>RABBITMQ_QUEUE</code>, and <code>APPLICATION</code>.
Therefore, configuring a container to work with PEcAn’s RabbitMQ instance requires setting these three variables in the Dockerfile using an <a href="https://docs.docker.com/engine/reference/builder/#env"><code>ENV</code></a> statement.</p>
<p>For example, this excerpt from <code>docker/base/Dockerfile.executor</code> (for the <code>pecan/executor</code> image responsible for the PEcAn workflow) sets these variables as follows:</p>
<div class="sourceCode" id="cb347"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb347-1" data-line-number="1"><span class="kw">ENV</span> RABBITMQ_URI=<span class="st">&quot;amqp://guest:guest@rabbitmq/%2F&quot;</span> \</a>
<a class="sourceLine" id="cb347-2" data-line-number="2">    RABBITMQ_QUEUE=<span class="st">&quot;pecan&quot;</span> \</a>
<a class="sourceLine" id="cb347-3" data-line-number="3">    APPLICATION=<span class="st">&quot;R CMD BATCH workflow.R&quot;</span></a></code></pre></div>
<p>Similarly, this excerpt from <code>docker/models/Dockerfile.sipnet</code> (which builds the SIPNET model image) is a typical example for a model image.
Note the use of <a href="https://docs.docker.com/engine/reference/builder/#arg"><code>ARG</code></a> here to specify a default version model version of 136 while allowing this to be configurable (via <code>--build-arg MODEL_VERSION=X</code>) at build time:</p>
<div class="sourceCode" id="cb348"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb348-1" data-line-number="1"><span class="kw">ARG</span> MODEL_VERSION=136</a>
<a class="sourceLine" id="cb348-2" data-line-number="2"></a>
<a class="sourceLine" id="cb348-3" data-line-number="3"><span class="kw">ENV</span> APPLICATION=<span class="st">&quot;./job.sh&quot;</span> \</a>
<a class="sourceLine" id="cb348-4" data-line-number="4">    MODEL_TYPE=<span class="st">&quot;SIPNET&quot;</span> \</a>
<a class="sourceLine" id="cb348-5" data-line-number="5">    MODEL_VERSION=<span class="st">&quot;${MODEL_VERSION}&quot;</span></a>
<a class="sourceLine" id="cb348-6" data-line-number="6"></a>
<a class="sourceLine" id="cb348-7" data-line-number="7"><span class="kw">ENV</span> RABBITMQ_QUEUE=<span class="st">&quot;${MODEL_TYPE}_${MODEL_VERSION}&quot;</span></a></code></pre></div>
<p><strong>WARNING</strong>: Dockerfile environment variables set via <code>ENV</code> are assigned <em>all at once</em>; <em>they do not evaluate successively, left to right</em>.
Consider the following block:</p>
<div class="sourceCode" id="cb349"><pre class="sourceCode dockerfile"><code class="sourceCode dockerfile"><a class="sourceLine" id="cb349-1" data-line-number="1"><span class="co"># Don&#39;t do this!</span></a>
<a class="sourceLine" id="cb349-2" data-line-number="2"><span class="kw">ENV</span> MODEL_TYPE=<span class="st">&quot;SIPNET&quot;</span> \</a>
<a class="sourceLine" id="cb349-3" data-line-number="3">    MODEL_VERSION=136 \</a>
<a class="sourceLine" id="cb349-4" data-line-number="4">    RABBITMQ_QUEUE=${MODEL_TYPE}_${MODEL_VERSION}   <span class="co"># &lt;- Doesn&#39;t know about MODEL_TYPE or MODEL_VERSION!</span></a></code></pre></div>
<p>In this block, the expansion for setting <code>RABBITMQ_QUEUE</code> <em>is not aware</em> of the current values of <code>MODEL_TYPE</code> or <code>MODEL_VERSION</code>, and will therefore be set incorrectly to just <code>_</code> (unless they have been set previously, in which case it will be aware only of their earlier values).
As such, <strong>variables depending on other variables must be set in a separate, subsequent <code>ENV</code> statement than the variables they depend on</strong>.</p>
</div>
<div id="rabbitmq-case-study" class="section level3">
<h3><span class="header-section-number">22.9.6</span> Case study: PEcAn web interface</h3>
<p>The following describes in general terms what happens during a typical run of the PEcAn web interface with RabbitMQ.</p>
<ol style="list-style-type: decimal">
<li><p>The user initializes all containers with <code>docker-compose up</code>.
All the services that interact with RabbitMQ (<code>executor</code> and all models) run <code>receiver.py</code> in the foreground, waiting for messages to tell them what to do.</p></li>
<li><p>The user browses to <a href="http://localhost:8000/pecan/" class="uri">http://localhost:8000/pecan/</a> and steps through the web interface.
All the pages up to the <code>04-runpecan.php</code> run on the <code>web</code> container, and are primarily for setting up the <code>pecan.xml</code> file.</p></li>
<li><p>Once the user starts the PEcAn workflow at <code>04-runpecan.php</code>, the underlying PHP code connects to RabbitMQ (based on the URI provided in <code>config.php</code>) and posts the following message to the <code>pecan</code> queue:</p></li>
</ol>
<div class="sourceCode" id="cb350"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb350-1" data-line-number="1">  <span class="fu">{</span><span class="dt">&quot;folder&quot;</span><span class="fu">:</span> <span class="st">&quot;/workflows/PEcAn_WORKFLOWID&quot;</span><span class="fu">,</span> <span class="dt">&quot;workflowid&quot;</span><span class="fu">:</span> <span class="st">&quot;WORKFLOWID&quot;</span><span class="fu">}</span></a></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>The <code>executor</code> service, which is listening on the <code>pecan</code> queue, hears this message and executes its <code>APPLICATION</code> (<code>R CMD BATCH workflow.R</code>) in the working directory specified in the message’s <code>folder</code>.
The <code>executor</code> service then performs the pre-execution steps (e.g. trait meta-analysis, conversions) itself.
Then, to actually execute the model, <code>executor</code> posts the following message to the target model’s queue:</li>
</ol>
<div class="sourceCode" id="cb351"><pre class="sourceCode json"><code class="sourceCode json"><a class="sourceLine" id="cb351-1" data-line-number="1">  <span class="fu">{</span><span class="dt">&quot;folder&quot;</span><span class="fu">:</span> <span class="st">&quot;/workflows/PEcAn_WORKFLOWID/run/RUNID&quot;</span><span class="fu">}</span></a></code></pre></div>
<ol start="5" style="list-style-type: decimal">
<li><p>The target model service, which is listening on its dedicated queue, hears this message and runs its <code>APPLICATION</code>, which is <code>job.sh</code>, in the directory indicated by the message.
Upon exiting (normally), the model service writes its status into a file called <code>rabbitmq.out</code> in the same directory.</p></li>
<li><p>The <code>executor</code> container continuously looks for the <code>rabbitmq.out</code> file as an indication of the model run’s status.
Once it sees this file, it reads the status and proceeds with the post-execution parts of the workflow.
(NOTE that this isn’t perfect. If the model running process exits abnormally, the <code>rabbitmq.out</code> file may not be created, which can cause the <code>executor</code> container to hang. If this happens, the solution is to restart the <code>executor</code> container with <code>docker-compose restart executor</code>).</p></li>
</ol>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="workflow-modules.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="pecan-remote.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/lunr.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tonygardella/pecan/edit/release/vtonydoc/book_source/03_topical_pages/94_docker/00_docker_index.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"toc": {
"collapse": "section"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
