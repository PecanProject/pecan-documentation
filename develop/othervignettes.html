<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>5.5 Other Vignettes | The Predictive Ecosystem Analyzer</title>
  <meta name="description" content="5.5 Other Vignettes | The Predictive Ecosystem Analyzer" />
  <meta name="generator" content="bookdown 0.26 and GitBook 2.6.7" />

  <meta property="og:title" content="5.5 Other Vignettes | The Predictive Ecosystem Analyzer" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="5.5 Other Vignettes | The Predictive Ecosystem Analyzer" />
  
  
  

<meta name="author" content="By: PEcAn Team" />


<meta name="date" content="2022-10-12" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="demo-2.html"/>
<link rel="next" href="advanced-user.html"/>
<script src="assets/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="assets/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="assets/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="assets/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="assets/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="assets/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="assets/htmlwidgets-1.5.4/htmlwidgets.js"></script>
<link href="assets/datatables-css-0.0.0/datatables-crosstalk.css" rel="stylesheet" />
<script src="assets/datatables-binding-0.22/datatables.js"></script>
<link href="assets/dt-core-1.11.3/css/jquery.dataTables.min.css" rel="stylesheet" />
<link href="assets/dt-core-1.11.3/css/jquery.dataTables.extra.css" rel="stylesheet" />
<script src="assets/dt-core-1.11.3/js/jquery.dataTables.min.js"></script>
<link href="assets/dt-ext-fixedcolumns-1.11.3/css/fixedColumns.dataTables.min.css" rel="stylesheet" />
<script src="assets/dt-ext-fixedcolumns-1.11.3/js/dataTables.fixedColumns.min.js"></script>
<script src="assets/jszip-1.11.3/jszip.min.js"></script>
<script src="assets/pdfmake-1.11.3/pdfmake.js"></script>
<script src="assets/pdfmake-1.11.3/vfs_fonts.js"></script>
<link href="assets/dt-ext-buttons-1.11.3/css/buttons.dataTables.min.css" rel="stylesheet" />
<script src="assets/dt-ext-buttons-1.11.3/js/dataTables.buttons.min.js"></script>
<script src="assets/dt-ext-buttons-1.11.3/js/buttons.html5.min.js"></script>
<script src="assets/dt-ext-buttons-1.11.3/js/buttons.colVis.min.js"></script>
<script src="assets/dt-ext-buttons-1.11.3/js/buttons.print.min.js"></script>
<link href="assets/crosstalk-1.2.0/css/crosstalk.min.css" rel="stylesheet" />
<script src="assets/crosstalk-1.2.0/js/crosstalk.min.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li class="chapter" data-level="" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i>Welcome</a></li>
<li class="part"><span><b>I Introduction</b></span></li>
<li class="chapter" data-level="1" data-path="project-overview.html"><a href="project-overview.html"><i class="fa fa-check"></i><b>1</b> Project Overview</a></li>
<li class="chapter" data-level="2" data-path="contributor-covenant-code-of-conduct.html"><a href="contributor-covenant-code-of-conduct.html"><i class="fa fa-check"></i><b>2</b> Contributor Covenant Code of Conduct</a></li>
<li class="chapter" data-level="3" data-path="about-the-pecan-book.html"><a href="about-the-pecan-book.html"><i class="fa fa-check"></i><b>3</b> About the PEcAn Book</a>
<ul>
<li class="chapter" data-level="3.1" data-path="general-feedbackcommentssuggestions.html"><a href="general-feedbackcommentssuggestions.html"><i class="fa fa-check"></i><b>3.1</b> General Feedback/Comments/Suggestions</a></li>
<li class="chapter" data-level="3.2" data-path="bookediting.html"><a href="bookediting.html"><i class="fa fa-check"></i><b>3.2</b> Editing this book</a></li>
<li class="chapter" data-level="3.3" data-path="how-to-create-your-own-version-of-documentation.html"><a href="how-to-create-your-own-version-of-documentation.html"><i class="fa fa-check"></i><b>3.3</b> How to create your own version of Documentation</a></li>
</ul></li>
<li class="part"><span><b>II Tutorials, Demos and How To’s</b></span></li>
<li class="chapter" data-level="4" data-path="pecan-manual-setup.html"><a href="pecan-manual-setup.html"><i class="fa fa-check"></i><b>4</b> Install PEcAn</a>
<ul>
<li class="chapter" data-level="4.1" data-path="install-vm.html"><a href="install-vm.html"><i class="fa fa-check"></i><b>4.1</b> Virtual Machine (VM)</a></li>
<li class="chapter" data-level="4.2" data-path="install-docker.html"><a href="install-docker.html"><i class="fa fa-check"></i><b>4.2</b> Docker</a></li>
<li class="chapter" data-level="4.3" data-path="r-universe.html"><a href="r-universe.html"><i class="fa fa-check"></i><b>4.3</b> Installation From r-universe</a></li>
<li class="chapter" data-level="4.4" data-path="install-native.html"><a href="install-native.html"><i class="fa fa-check"></i><b>4.4</b> (Advanced) Native install</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="user-section.html"><a href="user-section.html"><i class="fa fa-check"></i><b>5</b> Tutorials</a>
<ul>
<li class="chapter" data-level="5.1" data-path="pecan-in-a-nutshell.html"><a href="pecan-in-a-nutshell.html"><i class="fa fa-check"></i><b>5.1</b> How PEcAn Works in a nutshell</a></li>
<li class="chapter" data-level="5.2" data-path="demo-table.html"><a href="demo-table.html"><i class="fa fa-check"></i><b>5.2</b> PEcAn Demos</a></li>
<li class="chapter" data-level="5.3" data-path="demo-1.html"><a href="demo-1.html"><i class="fa fa-check"></i><b>5.3</b> Demo 01: Basic Run PEcAn</a></li>
<li class="chapter" data-level="5.4" data-path="demo-2.html"><a href="demo-2.html"><i class="fa fa-check"></i><b>5.4</b> Demo 02: Sensitivity and Uncertainty Analysis</a>
<ul>
<li class="chapter" data-level="5.4.1" data-path="demo-2.html"><a href="demo-2.html#run-specification-1"><i class="fa fa-check"></i><b>5.4.1</b> Run Specification</a></li>
<li class="chapter" data-level="5.4.2" data-path="demo-2.html"><a href="demo-2.html#additional-outputs"><i class="fa fa-check"></i><b>5.4.2</b> Additional Outputs:</a></li>
</ul></li>
<li class="chapter" data-level="5.5" data-path="othervignettes.html"><a href="othervignettes.html"><i class="fa fa-check"></i><b>5.5</b> Other Vignettes</a>
<ul>
<li class="chapter" data-level="5.5.1" data-path="othervignettes.html"><a href="othervignettes.html#simple-model-data-comparisons"><i class="fa fa-check"></i><b>5.5.1</b> Simple Model-Data Comparisons</a></li>
<li class="chapter" data-level="5.5.2" data-path="othervignettes.html"><a href="othervignettes.html#data-assimilation-concepts"><i class="fa fa-check"></i><b>5.5.2</b> Data Assimilation Concepts</a></li>
<li class="chapter" data-level="5.5.3" data-path="othervignettes.html"><a href="othervignettes.html#parameter-data-assimilation"><i class="fa fa-check"></i><b>5.5.3</b> Parameter Data Assimilation</a></li>
<li class="chapter" data-level="5.5.4" data-path="othervignettes.html"><a href="othervignettes.html#state-variable-data-assimilation"><i class="fa fa-check"></i><b>5.5.4</b> State-Variable Data Assimilation</a></li>
<li class="chapter" data-level="5.5.5" data-path="othervignettes.html"><a href="othervignettes.html#pecan-testing-the-sensitivity-analysis-against-observations"><i class="fa fa-check"></i><b>5.5.5</b> PEcAn: Testing the Sensitivity Analysis Against Observations”</a></li>
</ul></li>
<li class="chapter" data-level="5.6" data-path="advanced-user.html"><a href="advanced-user.html"><i class="fa fa-check"></i><b>5.6</b> Advanced User Guide</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="advanced-user.html"><a href="advanced-user.html#web-curl-submission"><i class="fa fa-check"></i><b>5.6.1</b> Submitting Workflow from Command Line</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="basic-web-workflow.html"><a href="basic-web-workflow.html"><i class="fa fa-check"></i><b>6</b> Basic Web workflow</a>
<ul>
<li class="chapter" data-level="6.1" data-path="web-site-model.html"><a href="web-site-model.html"><i class="fa fa-check"></i><b>6.1</b> Site and model selection</a>
<ul>
<li class="chapter" data-level="6.1.1" data-path="web-site-model.html"><a href="web-site-model.html#selecting-a-model"><i class="fa fa-check"></i><b>6.1.1</b> Selecting a model</a></li>
<li class="chapter" data-level="6.1.2" data-path="web-site-model.html"><a href="web-site-model.html#selecting-a-site"><i class="fa fa-check"></i><b>6.1.2</b> Selecting a site</a></li>
<li class="chapter" data-level="6.1.3" data-path="web-site-model.html"><a href="web-site-model.html#site-groups"><i class="fa fa-check"></i><b>6.1.3</b> Site Groups</a></li>
<li class="chapter" data-level="6.1.4" data-path="web-site-model.html"><a href="web-site-model.html#using-existing-sites"><i class="fa fa-check"></i><b>6.1.4</b> Using existing sites</a></li>
<li class="chapter" data-level="6.1.5" data-path="web-site-model.html"><a href="web-site-model.html#adding-a-new-site"><i class="fa fa-check"></i><b>6.1.5</b> Adding a new site</a></li>
<li class="chapter" data-level="6.1.6" data-path="web-site-model.html"><a href="web-site-model.html#troubleshooting"><i class="fa fa-check"></i><b>6.1.6</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="6.2" data-path="web-model-config.html"><a href="web-model-config.html"><i class="fa fa-check"></i><b>6.2</b> Model configuration</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="web-model-config.html"><a href="web-model-config.html#choosing-meteorology"><i class="fa fa-check"></i><b>6.2.1</b> Choosing meteorology</a></li>
<li class="chapter" data-level="6.2.2" data-path="web-model-config.html"><a href="web-model-config.html#met-workflow"><i class="fa fa-check"></i><b>6.2.2</b> Met workflow</a></li>
<li class="chapter" data-level="6.2.3" data-path="web-model-config.html"><a href="web-model-config.html#troubleshooting-meteorological-conversions"><i class="fa fa-check"></i><b>6.2.3</b> Troubleshooting meteorological conversions</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><i class="fa fa-check"></i><b>6.3</b> Selecting Plant Functional Types (PFTs) and other parameter groupings.</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#using-existing-pfts"><i class="fa fa-check"></i><b>6.3.1</b> Using existing PFTs</a></li>
<li class="chapter" data-level="6.3.2" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#creating-new-pfts"><i class="fa fa-check"></i><b>6.3.2</b> Creating new PFTs</a></li>
<li class="chapter" data-level="6.3.3" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#choosing-initial-vegetation"><i class="fa fa-check"></i><b>6.3.3</b> Choosing initial vegetation</a></li>
<li class="chapter" data-level="6.3.4" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#us-fia"><i class="fa fa-check"></i><b>6.3.4</b> US FIA</a></li>
<li class="chapter" data-level="6.3.5" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#spin-up"><i class="fa fa-check"></i><b>6.3.5</b> Spin up</a></li>
<li class="chapter" data-level="6.3.6" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#selecting-a-soils-product"><i class="fa fa-check"></i><b>6.3.6</b> Selecting a soils product</a></li>
<li class="chapter" data-level="6.3.7" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#soil-texture-depth-and-physical-parameters"><i class="fa fa-check"></i><b>6.3.7</b> Soil texture, depth, and physical parameters</a></li>
<li class="chapter" data-level="6.3.8" data-path="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html"><a href="selecting-plant-functional-types-pfts-and-other-parameter-groupings..html#other-model-inputs"><i class="fa fa-check"></i><b>6.3.8</b> Other model inputs</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="intermediate-user.html"><a href="intermediate-user.html"><i class="fa fa-check"></i><b>7</b> More on the PEcAn Web Interface</a>
<ul>
<li class="chapter" data-level="7.1" data-path="additional-web-configuration.html"><a href="additional-web-configuration.html"><i class="fa fa-check"></i><b>7.1</b> Additional web configuration</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="additional-web-configuration.html"><a href="additional-web-configuration.html#intermediate-web-setup"><i class="fa fa-check"></i><b>7.1.1</b> Web interface setup</a></li>
<li class="chapter" data-level="7.1.2" data-path="additional-web-configuration.html"><a href="additional-web-configuration.html#browndog"><i class="fa fa-check"></i><b>7.1.2</b> Brown Dog</a></li>
<li class="chapter" data-level="7.1.3" data-path="additional-web-configuration.html"><a href="additional-web-configuration.html#intermediate-advanced-setup"><i class="fa fa-check"></i><b>7.1.3</b> Advanced Setup</a></li>
<li class="chapter" data-level="7.1.4" data-path="additional-web-configuration.html"><a href="additional-web-configuration.html#intermediate-model-config"><i class="fa fa-check"></i><b>7.1.4</b> Editing model configurations</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html"><i class="fa fa-check"></i><b>7.2</b> Settings-configured analyses</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#pda"><i class="fa fa-check"></i><b>7.2.1</b> Parameter data assimilation (PDA)</a></li>
<li class="chapter" data-level="7.2.2" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#sda"><i class="fa fa-check"></i><b>7.2.2</b> State data assimilation (SDA)</a></li>
<li class="chapter" data-level="7.2.3" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#running-sda-on-remote"><i class="fa fa-check"></i><b>7.2.3</b> Running SDA on remote</a></li>
<li class="chapter" data-level="7.2.4" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#restart-functionality-in-sda"><i class="fa fa-check"></i><b>7.2.4</b> Restart functionality in SDA</a></li>
<li class="chapter" data-level="7.2.5" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#state-data-assimilation-methods"><i class="fa fa-check"></i><b>7.2.5</b> State Data Assimilation Methods</a></li>
<li class="chapter" data-level="7.2.6" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#multisettings"><i class="fa fa-check"></i><b>7.2.6</b> MultiSettings</a></li>
<li class="chapter" data-level="7.2.7" data-path="settings-configured-analyses.html"><a href="settings-configured-analyses.html#benchmarking"><i class="fa fa-check"></i><b>7.2.7</b> Benchmarking</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="developer-guide.html"><a href="developer-guide.html"><i class="fa fa-check"></i><b>8</b> Developer guide</a>
<ul>
<li class="chapter" data-level="8.1" data-path="updatebety.html"><a href="updatebety.html"><i class="fa fa-check"></i><b>8.1</b> Updating PEcAn Code and Bety Database</a>
<ul>
<li class="chapter" data-level="8.1.1" data-path="updatebety.html"><a href="updatebety.html#pecan-make"><i class="fa fa-check"></i><b>8.1.1</b> Updating PEcAn</a></li>
</ul></li>
<li class="chapter" data-level="8.2" data-path="pecan-git.html"><a href="pecan-git.html"><i class="fa fa-check"></i><b>8.2</b> Git and GitHub Workflow</a>
<ul>
<li class="chapter" data-level="8.2.1" data-path="pecan-git.html"><a href="pecan-git.html#using-git"><i class="fa fa-check"></i><b>8.2.1</b> Using Git</a></li>
<li class="chapter" data-level="8.2.2" data-path="pecan-git.html"><a href="pecan-git.html#recommended-git-workflow"><i class="fa fa-check"></i><b>8.2.2</b> Recommended Git Workflow</a></li>
<li class="chapter" data-level="8.2.3" data-path="pecan-git.html"><a href="pecan-git.html#useful-git-tools"><i class="fa fa-check"></i><b>8.2.3</b> Useful Git tools</a></li>
<li class="chapter" data-level="8.2.4" data-path="pecan-git.html"><a href="pecan-git.html#advanced"><i class="fa fa-check"></i><b>8.2.4</b> Advanced</a></li>
<li class="chapter" data-level="8.2.5" data-path="pecan-git.html"><a href="pecan-git.html#references"><i class="fa fa-check"></i><b>8.2.5</b> References</a></li>
<li class="chapter" data-level="8.2.6" data-path="pecan-git.html"><a href="pecan-git.html#github-use-with-pecan"><i class="fa fa-check"></i><b>8.2.6</b> GitHub use with PEcAn</a></li>
</ul></li>
<li class="chapter" data-level="8.3" data-path="coding-practices.html"><a href="coding-practices.html"><i class="fa fa-check"></i><b>8.3</b> Coding Practices</a>
<ul>
<li class="chapter" data-level="8.3.1" data-path="coding-practices.html"><a href="coding-practices.html#developer-codestyle"><i class="fa fa-check"></i><b>8.3.1</b> Coding Style</a></li>
<li class="chapter" data-level="8.3.2" data-path="coding-practices.html"><a href="coding-practices.html#developer-logging"><i class="fa fa-check"></i><b>8.3.2</b> Logging</a></li>
<li class="chapter" data-level="8.3.3" data-path="coding-practices.html"><a href="coding-practices.html#developer-packagedata"><i class="fa fa-check"></i><b>8.3.3</b> Package Data</a></li>
<li class="chapter" data-level="8.3.4" data-path="coding-practices.html"><a href="coding-practices.html#developer-roxygen"><i class="fa fa-check"></i><b>8.3.4</b> Documenting functions using <code>roxygen2</code></a></li>
</ul></li>
<li class="chapter" data-level="8.4" data-path="developer-testing.html"><a href="developer-testing.html"><i class="fa fa-check"></i><b>8.4</b> Testing</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="developer-testing.html"><a href="developer-testing.html#developer-testing-unit"><i class="fa fa-check"></i><b>8.4.1</b> Unit testing</a></li>
<li class="chapter" data-level="8.4.2" data-path="developer-testing.html"><a href="developer-testing.html#developer-testing-integration"><i class="fa fa-check"></i><b>8.4.2</b> Integration testing</a></li>
<li class="chapter" data-level="8.4.3" data-path="developer-testing.html"><a href="developer-testing.html#continuous-integration"><i class="fa fa-check"></i><b>8.4.3</b> Continuous Integration</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="download-and-compile-pecan.html"><a href="download-and-compile-pecan.html"><i class="fa fa-check"></i><b>8.5</b> Download and Compile PEcAn</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="download-and-compile-pecan.html"><a href="download-and-compile-pecan.html#download-compile-and-install-pecan-from-github"><i class="fa fa-check"></i><b>8.5.1</b> Download, compile and install PEcAn from GitHub</a></li>
<li class="chapter" data-level="8.5.2" data-path="download-and-compile-pecan.html"><a href="download-and-compile-pecan.html#pecan-testrun"><i class="fa fa-check"></i><b>8.5.2</b> PEcAn Testrun</a></li>
</ul></li>
<li class="chapter" data-level="8.6" data-path="directory-structure.html"><a href="directory-structure.html"><i class="fa fa-check"></i><b>8.6</b> Directory structure</a>
<ul>
<li class="chapter" data-level="8.6.1" data-path="directory-structure.html"><a href="directory-structure.html#overview-of-pecan-repository-as-of-pecan-1.5.3"><i class="fa fa-check"></i><b>8.6.1</b> Overview of PEcAn repository as of PEcAn 1.5.3</a></li>
<li class="chapter" data-level="8.6.2" data-path="directory-structure.html"><a href="directory-structure.html#generic-r-package-structure"><i class="fa fa-check"></i><b>8.6.2</b> Generic R package structure:</a></li>
</ul></li>
</ul></li>
<li class="part"><span><b>III Topical Pages</b></span></li>
<li class="chapter" data-level="9" data-path="working-with-vm.html"><a href="working-with-vm.html"><i class="fa fa-check"></i><b>9</b> VM configuration and maintenance</a>
<ul>
<li class="chapter" data-level="9.1" data-path="maintain-vm.html"><a href="maintain-vm.html"><i class="fa fa-check"></i><b>9.1</b> Updating the VM</a></li>
<li class="chapter" data-level="9.2" data-path="ssh-vm.html"><a href="ssh-vm.html"><i class="fa fa-check"></i><b>9.2</b> Connecting to the VM via SSH</a></li>
<li class="chapter" data-level="9.3" data-path="ssh-vm-bety.html"><a href="ssh-vm-bety.html"><i class="fa fa-check"></i><b>9.3</b> Connecting to BETYdb on the VM via SSH</a>
<ul>
<li class="chapter" data-level="9.3.1" data-path="ssh-vm-bety.html"><a href="ssh-vm-bety.html#awsvm"><i class="fa fa-check"></i><b>9.3.1</b> Using Amazon Web Services for a VM (AWS)</a></li>
<li class="chapter" data-level="9.3.2" data-path="ssh-vm-bety.html"><a href="ssh-vm-bety.html#createvm"><i class="fa fa-check"></i><b>9.3.2</b> Creating a Virtual Machine</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="10" data-path="pecan-standards.html"><a href="pecan-standards.html"><i class="fa fa-check"></i><b>10</b> PEcAn standard formats</a>
<ul>
<li class="chapter" data-level="10.1" data-path="defining-new-input-formats.html"><a href="defining-new-input-formats.html"><i class="fa fa-check"></i><b>10.1</b> Defining new input formats</a></li>
<li class="chapter" data-level="10.2" data-path="time-standard.html"><a href="time-standard.html"><i class="fa fa-check"></i><b>10.2</b> Time Standard</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="time-standard.html"><a href="time-standard.html#input-standards"><i class="fa fa-check"></i><b>10.2.1</b> Input Standards</a></li>
<li class="chapter" data-level="10.2.2" data-path="time-standard.html"><a href="time-standard.html#soils-and-vegetation-inputs"><i class="fa fa-check"></i><b>10.2.2</b> Soils and Vegetation Inputs</a></li>
<li class="chapter" data-level="10.2.3" data-path="time-standard.html"><a href="time-standard.html#output-standards"><i class="fa fa-check"></i><b>10.2.3</b> Output Standards</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="11" data-path="pecanXML.html"><a href="pecanXML.html"><i class="fa fa-check"></i><b>11</b> The PEcAn XML</a>
<ul>
<li class="chapter" data-level="11.1" data-path="xml-core-config.html"><a href="xml-core-config.html"><i class="fa fa-check"></i><b>11.1</b> Core configuration</a>
<ul>
<li class="chapter" data-level="11.1.1" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-structure"><i class="fa fa-check"></i><b>11.1.1</b> Top-level structure</a></li>
<li class="chapter" data-level="11.1.2" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-info"><i class="fa fa-check"></i><b>11.1.2</b> <code>info</code>: Run metadata</a></li>
<li class="chapter" data-level="11.1.3" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-outdir"><i class="fa fa-check"></i><b>11.1.3</b> <code>outdir</code>: Output directory</a></li>
<li class="chapter" data-level="11.1.4" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-database"><i class="fa fa-check"></i><b>11.1.4</b> <code>database</code>: PEcAn database settings</a></li>
<li class="chapter" data-level="11.1.5" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-pft"><i class="fa fa-check"></i><b>11.1.5</b> <code>pft</code>: Plant functional type selection</a></li>
<li class="chapter" data-level="11.1.6" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-meta-analysis"><i class="fa fa-check"></i><b>11.1.6</b> <code>meta.analysis</code>: Trait Meta Analysis</a></li>
<li class="chapter" data-level="11.1.7" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-model"><i class="fa fa-check"></i><b>11.1.7</b> <code>model</code>: Model configuration</a></li>
<li class="chapter" data-level="11.1.8" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-run"><i class="fa fa-check"></i><b>11.1.8</b> <code>run</code>: Run Setup</a></li>
<li class="chapter" data-level="11.1.9" data-path="xml-core-config.html"><a href="xml-core-config.html#xml-host"><i class="fa fa-check"></i><b>11.1.9</b> <code>host</code>: Host information for remote execution</a></li>
</ul></li>
<li class="chapter" data-level="11.2" data-path="xml-advanced.html"><a href="xml-advanced.html"><i class="fa fa-check"></i><b>11.2</b> Advanced features</a>
<ul>
<li class="chapter" data-level="11.2.1" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-ensemble"><i class="fa fa-check"></i><b>11.2.1</b> <code>ensemble</code>: Ensemble Runs</a></li>
<li class="chapter" data-level="11.2.2" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-sensitivity-analysis"><i class="fa fa-check"></i><b>11.2.2</b> <code>sensitivity.analysis</code>: Sensitivity analysis</a></li>
<li class="chapter" data-level="11.2.3" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-parameter-data-assimilation"><i class="fa fa-check"></i><b>11.2.3</b> Parameter Data Assimilation</a></li>
<li class="chapter" data-level="11.2.4" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-multi-settings"><i class="fa fa-check"></i><b>11.2.4</b> Multi-Settings</a></li>
<li class="chapter" data-level="11.2.5" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-state-data-assimilation"><i class="fa fa-check"></i><b>11.2.5</b> (experimental) State Data Assimilation</a></li>
<li class="chapter" data-level="11.2.6" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-browndog"><i class="fa fa-check"></i><b>11.2.6</b> (experimental) Brown Dog</a></li>
<li class="chapter" data-level="11.2.7" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-benchmarking"><i class="fa fa-check"></i><b>11.2.7</b> (experimental) Benchmarking</a></li>
<li class="chapter" data-level="11.2.8" data-path="xml-advanced.html"><a href="xml-advanced.html#xml-remote_process"><i class="fa fa-check"></i><b>11.2.8</b> Remote data module</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="12" data-path="workflow.html"><a href="workflow.html"><i class="fa fa-check"></i><b>12</b> PEcAn workflow (web/workflow.R)</a>
<ul>
<li class="chapter" data-level="12.1" data-path="workflow-readsettings.html"><a href="workflow-readsettings.html"><i class="fa fa-check"></i><b>12.1</b> Read Settings</a></li>
<li class="chapter" data-level="12.2" data-path="workflow-input.html"><a href="workflow-input.html"><i class="fa fa-check"></i><b>12.2</b> Input Conversions</a></li>
<li class="chapter" data-level="12.3" data-path="workflow-input-data.html"><a href="workflow-input-data.html"><i class="fa fa-check"></i><b>12.3</b> Input Data</a></li>
<li class="chapter" data-level="12.4" data-path="workflow-input-initial.html"><a href="workflow-input-initial.html"><i class="fa fa-check"></i><b>12.4</b> Initial Conditions</a></li>
<li class="chapter" data-level="12.5" data-path="workflow-met.html"><a href="workflow-met.html"><i class="fa fa-check"></i><b>12.5</b> Meteorological Data</a>
<ul>
<li class="chapter" data-level="12.5.1" data-path="workflow-met.html"><a href="workflow-met.html#workflow-met-download"><i class="fa fa-check"></i><b>12.5.1</b> Downloading Raw data (Description of Process)</a></li>
<li class="chapter" data-level="12.5.2" data-path="workflow-met.html"><a href="workflow-met.html#workflow-met-standard"><i class="fa fa-check"></i><b>12.5.2</b> Converting raw data to PEcAn standard</a></li>
<li class="chapter" data-level="12.5.3" data-path="workflow-met.html"><a href="workflow-met.html#workflow-met-downscale"><i class="fa fa-check"></i><b>12.5.3</b> Downscaling and gapfilling (optional)</a></li>
<li class="chapter" data-level="12.5.4" data-path="workflow-met.html"><a href="workflow-met.html#workflow-met-model"><i class="fa fa-check"></i><b>12.5.4</b> Converting from PEcAn standard to model-specific format</a></li>
</ul></li>
<li class="chapter" data-level="12.6" data-path="workflow-traits.html"><a href="workflow-traits.html"><i class="fa fa-check"></i><b>12.6</b> Traits</a></li>
<li class="chapter" data-level="12.7" data-path="workflow-metaanalysis.html"><a href="workflow-metaanalysis.html"><i class="fa fa-check"></i><b>12.7</b> Meta Analysis</a></li>
<li class="chapter" data-level="12.8" data-path="workflow-modelconfig.html"><a href="workflow-modelconfig.html"><i class="fa fa-check"></i><b>12.8</b> Model Configuration</a></li>
<li class="chapter" data-level="12.9" data-path="workflow-modelrun.html"><a href="workflow-modelrun.html"><i class="fa fa-check"></i><b>12.9</b> Run Execution</a></li>
<li class="chapter" data-level="12.10" data-path="workflow-postrun.html"><a href="workflow-postrun.html"><i class="fa fa-check"></i><b>12.10</b> Post Run Analysis</a></li>
</ul></li>
<li class="chapter" data-level="13" data-path="pecan-models.html"><a href="pecan-models.html"><i class="fa fa-check"></i><b>13</b> PEcAn Models</a>
<ul>
<li class="chapter" data-level="13.1" data-path="models-biocro.html"><a href="models-biocro.html"><i class="fa fa-check"></i><b>13.1</b> BioCro</a>
<ul>
<li class="chapter" data-level="13.1.1" data-path="models-biocro.html"><a href="models-biocro.html#introduction-1"><i class="fa fa-check"></i><b>13.1.1</b> Introduction</a></li>
<li class="chapter" data-level="13.1.2" data-path="models-biocro.html"><a href="models-biocro.html#pecan-configuration-file-additions"><i class="fa fa-check"></i><b>13.1.2</b> PEcAn configuration file additions</a></li>
<li class="chapter" data-level="13.1.3" data-path="models-biocro.html"><a href="models-biocro.html#model-specific-input-files"><i class="fa fa-check"></i><b>13.1.3</b> Model specific input files</a></li>
<li class="chapter" data-level="13.1.4" data-path="models-biocro.html"><a href="models-biocro.html#model-configuration-files"><i class="fa fa-check"></i><b>13.1.4</b> Model configuration files</a></li>
<li class="chapter" data-level="13.1.5" data-path="models-biocro.html"><a href="models-biocro.html#installation-notes"><i class="fa fa-check"></i><b>13.1.5</b> Installation notes</a></li>
</ul></li>
<li class="chapter" data-level="13.2" data-path="models-clm.html"><a href="models-clm.html"><i class="fa fa-check"></i><b>13.2</b> CLM</a></li>
<li class="chapter" data-level="13.3" data-path="models-dalec.html"><a href="models-dalec.html"><i class="fa fa-check"></i><b>13.3</b> DALEC</a></li>
<li class="chapter" data-level="13.4" data-path="models-ed.html"><a href="models-ed.html"><i class="fa fa-check"></i><b>13.4</b> ED2</a>
<ul>
<li class="chapter" data-level="13.4.1" data-path="models-ed.html"><a href="models-ed.html#introduction-2"><i class="fa fa-check"></i><b>13.4.1</b> Introduction</a></li>
<li class="chapter" data-level="13.4.2" data-path="models-ed.html"><a href="models-ed.html#pecan-configuration-file-additions-1"><i class="fa fa-check"></i><b>13.4.2</b> PEcAn configuration file additions</a></li>
<li class="chapter" data-level="13.4.3" data-path="models-ed.html"><a href="models-ed.html#models-ed-pft-configuration"><i class="fa fa-check"></i><b>13.4.3</b> PFT configuration in ED2</a></li>
<li class="chapter" data-level="13.4.4" data-path="models-ed.html"><a href="models-ed.html#model-specific-input-files-1"><i class="fa fa-check"></i><b>13.4.4</b> Model specific input files</a></li>
<li class="chapter" data-level="13.4.5" data-path="models-ed.html"><a href="models-ed.html#model-configuration-files-1"><i class="fa fa-check"></i><b>13.4.5</b> Model configuration files</a></li>
<li class="chapter" data-level="13.4.6" data-path="models-ed.html"><a href="models-ed.html#installation-notes-1"><i class="fa fa-check"></i><b>13.4.6</b> Installation notes</a></li>
</ul></li>
<li class="chapter" data-level="13.5" data-path="models-gday.html"><a href="models-gday.html"><i class="fa fa-check"></i><b>13.5</b> GDAY</a></li>
<li class="chapter" data-level="13.6" data-path="models-ldndc.html"><a href="models-ldndc.html"><i class="fa fa-check"></i><b>13.6</b> LDNDC</a>
<ul>
<li class="chapter" data-level="13.6.1" data-path="models-ldndc.html"><a href="models-ldndc.html#introduction-3"><i class="fa fa-check"></i><b>13.6.1</b> Introduction</a></li>
<li class="chapter" data-level="13.6.2" data-path="models-ldndc.html"><a href="models-ldndc.html#model-specific-input-files-2"><i class="fa fa-check"></i><b>13.6.2</b> Model specific input files</a></li>
<li class="chapter" data-level="13.6.3" data-path="models-ldndc.html"><a href="models-ldndc.html#installation-notes-2"><i class="fa fa-check"></i><b>13.6.3</b> Installation notes</a></li>
</ul></li>
<li class="chapter" data-level="13.7" data-path="models-linkages.html"><a href="models-linkages.html"><i class="fa fa-check"></i><b>13.7</b> LINKAGES</a></li>
<li class="chapter" data-level="13.8" data-path="models-lpjguess.html"><a href="models-lpjguess.html"><i class="fa fa-check"></i><b>13.8</b> LPJ-GUESS</a></li>
<li class="chapter" data-level="13.9" data-path="models-maespa.html"><a href="models-maespa.html"><i class="fa fa-check"></i><b>13.9</b> MAESPA</a></li>
<li class="chapter" data-level="13.10" data-path="models-preles.html"><a href="models-preles.html"><i class="fa fa-check"></i><b>13.10</b> PRELES</a></li>
<li class="chapter" data-level="13.11" data-path="models-sipnet.html"><a href="models-sipnet.html"><i class="fa fa-check"></i><b>13.11</b> SiPNET</a></li>
<li class="chapter" data-level="13.12" data-path="models-stics.html"><a href="models-stics.html"><i class="fa fa-check"></i><b>13.12</b> STICS</a></li>
</ul></li>
<li class="chapter" data-level="14" data-path="met-drivers.html"><a href="met-drivers.html"><i class="fa fa-check"></i><b>14</b> Available Meteorological Drivers</a>
<ul>
<li class="chapter" data-level="14.1" data-path="ameriflux.html"><a href="ameriflux.html"><i class="fa fa-check"></i><b>14.1</b> Ameriflux</a></li>
<li class="chapter" data-level="14.2" data-path="amerifluxlbl.html"><a href="amerifluxlbl.html"><i class="fa fa-check"></i><b>14.2</b> AmerifluxLBL</a></li>
<li class="chapter" data-level="14.3" data-path="fluxnet2015.html"><a href="fluxnet2015.html"><i class="fa fa-check"></i><b>14.3</b> Fluxnet2015</a></li>
<li class="chapter" data-level="14.4" data-path="narr.html"><a href="narr.html"><i class="fa fa-check"></i><b>14.4</b> NARR</a></li>
<li class="chapter" data-level="14.5" data-path="cruncep.html"><a href="cruncep.html"><i class="fa fa-check"></i><b>14.5</b> CRUNCEP</a></li>
<li class="chapter" data-level="14.6" data-path="cmip5.html"><a href="cmip5.html"><i class="fa fa-check"></i><b>14.6</b> CMIP5</a></li>
<li class="chapter" data-level="14.7" data-path="nldas.html"><a href="nldas.html"><i class="fa fa-check"></i><b>14.7</b> NLDAS</a></li>
<li class="chapter" data-level="14.8" data-path="gldas.html"><a href="gldas.html"><i class="fa fa-check"></i><b>14.8</b> GLDAS</a></li>
<li class="chapter" data-level="14.9" data-path="paleon.html"><a href="paleon.html"><i class="fa fa-check"></i><b>14.9</b> PalEON</a></li>
<li class="chapter" data-level="14.10" data-path="fluxnetlathuile.html"><a href="fluxnetlathuile.html"><i class="fa fa-check"></i><b>14.10</b> FluxnetLaThuile</a></li>
<li class="chapter" data-level="14.11" data-path="geostreams.html"><a href="geostreams.html"><i class="fa fa-check"></i><b>14.11</b> Geostreams</a></li>
<li class="chapter" data-level="14.12" data-path="era5.html"><a href="era5.html"><i class="fa fa-check"></i><b>14.12</b> ERA5</a></li>
<li class="chapter" data-level="14.13" data-path="icos-drought-2018.html"><a href="icos-drought-2018.html"><i class="fa fa-check"></i><b>14.13</b> ICOS Drought 2018</a></li>
<li class="chapter" data-level="14.14" data-path="icos-ecosystem-archive.html"><a href="icos-ecosystem-archive.html"><i class="fa fa-check"></i><b>14.14</b> ICOS Ecosystem Archive</a></li>
<li class="chapter" data-level="14.15" data-path="download-gfdl.html"><a href="download-gfdl.html"><i class="fa fa-check"></i><b>14.15</b> Download GFDL</a></li>
<li class="chapter" data-level="14.16" data-path="cm3.html"><a href="cm3.html"><i class="fa fa-check"></i><b>14.16</b> CM3</a></li>
<li class="chapter" data-level="14.17" data-path="esm2m-esm2g.html"><a href="esm2m-esm2g.html"><i class="fa fa-check"></i><b>14.17</b> ESM2M &amp; ESM2G</a></li>
</ul></li>
<li class="chapter" data-level="15" data-path="pecan-project-api.html"><a href="pecan-project-api.html"><i class="fa fa-check"></i><b>15</b> PEcAn Project API</a>
<ul>
<li class="chapter" data-level="15.1" data-path="introduction-4.html"><a href="introduction-4.html"><i class="fa fa-check"></i><b>15.1</b> Introduction</a></li>
<li class="chapter" data-level="15.2" data-path="authentication.html"><a href="authentication.html"><i class="fa fa-check"></i><b>15.2</b> Authentication</a></li>
<li class="chapter" data-level="15.3" data-path="restful-api-endpoints.html"><a href="restful-api-endpoints.html"><i class="fa fa-check"></i><b>15.3</b> RESTful API Endpoints</a></li>
<li class="chapter" data-level="15.4" data-path="examples.html"><a href="examples.html"><i class="fa fa-check"></i><b>15.4</b> Examples:</a>
<ul>
<li class="chapter" data-level="15.4.1" data-path="examples.html"><a href="examples.html#prerequisites-to-interact-with-the-pecan-api-server"><i class="fa fa-check"></i><b>15.4.1</b> Prerequisites to interact with the PEcAn API Server</a></li>
<li><a href="examples.html#section"></a></li>
<li class="chapter" data-level="15.4.2" data-path="examples.html"><a href="examples.html#get-apiping"><i class="fa fa-check"></i><b>15.4.2</b> <code>GET /api/ping</code></a></li>
<li><a href="examples.html#section-1"></a></li>
<li class="chapter" data-level="15.4.3" data-path="examples.html"><a href="examples.html#get-apistatus"><i class="fa fa-check"></i><b>15.4.3</b> <code>GET /api/status</code></a></li>
<li><a href="examples.html#section-2"></a></li>
<li class="chapter" data-level="15.4.4" data-path="examples.html"><a href="examples.html#get-apimodels"><i class="fa fa-check"></i><b>15.4.4</b> <code>GET /api/models/</code></a></li>
<li><a href="examples.html#section-3"></a></li>
<li class="chapter" data-level="15.4.5" data-path="examples.html"><a href="examples.html#get-apimodelsmodel_id"><i class="fa fa-check"></i><b>15.4.5</b> <code>GET /api/models/{model_id}</code></a></li>
<li><a href="examples.html#section-4"></a></li>
<li class="chapter" data-level="15.4.6" data-path="examples.html"><a href="examples.html#get-apisites"><i class="fa fa-check"></i><b>15.4.6</b> <code>GET /api/sites/</code></a></li>
<li><a href="examples.html#section-5"></a></li>
<li class="chapter" data-level="15.4.7" data-path="examples.html"><a href="examples.html#get-apisitessite_id"><i class="fa fa-check"></i><b>15.4.7</b> <code>GET /api/sites/{site_id}</code></a></li>
<li><a href="examples.html#section-6"></a></li>
<li class="chapter" data-level="15.4.8" data-path="examples.html"><a href="examples.html#get-apipfts"><i class="fa fa-check"></i><b>15.4.8</b> <code>GET /api/pfts/</code></a></li>
<li><a href="examples.html#section-7"></a></li>
<li class="chapter" data-level="15.4.9" data-path="examples.html"><a href="examples.html#get-apipftspft_id"><i class="fa fa-check"></i><b>15.4.9</b> <code>GET /api/pfts/{pft_id}</code></a></li>
<li><a href="examples.html#section-8"></a></li>
<li class="chapter" data-level="15.4.10" data-path="examples.html"><a href="examples.html#get-apiformats"><i class="fa fa-check"></i><b>15.4.10</b> <code>GET /api/formats/</code></a></li>
<li><a href="examples.html#section-9"></a></li>
<li class="chapter" data-level="15.4.11" data-path="examples.html"><a href="examples.html#get-apiformatsformat_id"><i class="fa fa-check"></i><b>15.4.11</b> <code>GET /api/formats/{format_id}</code></a></li>
<li><a href="examples.html#section-10"></a></li>
<li class="chapter" data-level="15.4.12" data-path="examples.html"><a href="examples.html#get-apiinputs"><i class="fa fa-check"></i><b>15.4.12</b> <code>GET /api/inputs/</code></a></li>
<li><a href="examples.html#section-11"></a></li>
<li class="chapter" data-level="15.4.13" data-path="examples.html"><a href="examples.html#get-apiinputsinput_id"><i class="fa fa-check"></i><b>15.4.13</b> <code>GET /api/inputs/{input_id}</code></a></li>
<li><a href="examples.html#section-12"></a></li>
<li class="chapter" data-level="15.4.14" data-path="examples.html"><a href="examples.html#get-apiworkflows"><i class="fa fa-check"></i><b>15.4.14</b> <code>GET /api/workflows/</code></a></li>
<li><a href="examples.html#section-13"></a></li>
<li class="chapter" data-level="15.4.15" data-path="examples.html"><a href="examples.html#post-apiworkflows"><i class="fa fa-check"></i><b>15.4.15</b> <code>POST /api/workflows/</code></a></li>
<li><a href="examples.html#section-14"></a></li>
<li class="chapter" data-level="15.4.16" data-path="examples.html"><a href="examples.html#get-apiworkflowsid"><i class="fa fa-check"></i><b>15.4.16</b> <code>GET /api/workflows/{id}</code></a></li>
<li><a href="examples.html#section-15"></a></li>
<li class="chapter" data-level="15.4.17" data-path="examples.html"><a href="examples.html#get-apiworkflowsidstatus"><i class="fa fa-check"></i><b>15.4.17</b> <code>GET /api/workflows/{id}/status</code></a></li>
<li><a href="examples.html#section-16"></a></li>
<li class="chapter" data-level="15.4.18" data-path="examples.html"><a href="examples.html#get-apiworkflowsidfilefilename"><i class="fa fa-check"></i><b>15.4.18</b> <code>GET /api/workflows/{id}/file/{filename}</code></a></li>
<li><a href="examples.html#section-17"></a></li>
<li class="chapter" data-level="15.4.19" data-path="examples.html"><a href="examples.html#get-apiruns"><i class="fa fa-check"></i><b>15.4.19</b> <code>GET /api/runs/</code></a></li>
<li><a href="examples.html#section-18"></a></li>
<li class="chapter" data-level="15.4.20" data-path="examples.html"><a href="examples.html#get-apirunsrun_id"><i class="fa fa-check"></i><b>15.4.20</b> <code>GET /api/runs/{run_id}</code></a></li>
<li><a href="examples.html#section-19"></a></li>
<li class="chapter" data-level="15.4.21" data-path="examples.html"><a href="examples.html#get-apirunsrun_idinputfilename"><i class="fa fa-check"></i><b>15.4.21</b> <code>GET /api/runs/{run_id}/input/{filename}</code></a></li>
<li><a href="examples.html#section-20"></a></li>
<li class="chapter" data-level="15.4.22" data-path="examples.html"><a href="examples.html#get-apirunsrun_idoutputfilename"><i class="fa fa-check"></i><b>15.4.22</b> <code>GET /api/runs/{run_id}/output/{filename}</code></a></li>
<li><a href="examples.html#section-21"></a></li>
<li class="chapter" data-level="15.4.23" data-path="examples.html"><a href="examples.html#get-apirunsrun_idgraphyeary_var"><i class="fa fa-check"></i><b>15.4.23</b> <code>GET /api/runs/{run_id}/graph/{year}/{y_var}</code></a></li>
<li><a href="examples.html#section-22"></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="16" data-path="database-sync.html"><a href="database-sync.html"><i class="fa fa-check"></i><b>16</b> Database synchronization</a>
<ul>
<li class="chapter" data-level="16.1" data-path="how-does-it-work.html"><a href="how-does-it-work.html"><i class="fa fa-check"></i><b>16.1</b> How does it work?</a></li>
<li class="chapter" data-level="16.2" data-path="set-up.html"><a href="set-up.html"><i class="fa fa-check"></i><b>16.2</b> Set up</a></li>
<li class="chapter" data-level="16.3" data-path="fetch-latest-data.html"><a href="fetch-latest-data.html"><i class="fa fa-check"></i><b>16.3</b> Fetch latest data</a></li>
<li class="chapter" data-level="16.4" data-path="sharing-data.html"><a href="sharing-data.html"><i class="fa fa-check"></i><b>16.4</b> Sharing data</a></li>
<li class="chapter" data-level="16.5" data-path="automation.html"><a href="automation.html"><i class="fa fa-check"></i><b>16.5</b> Automation</a></li>
<li class="chapter" data-level="16.6" data-path="database-maintentance.html"><a href="database-maintentance.html"><i class="fa fa-check"></i><b>16.6</b> Database maintentance</a>
<ul>
<li class="chapter" data-level="16.6.1" data-path="database-maintentance.html"><a href="database-maintentance.html#reindexing-the-database"><i class="fa fa-check"></i><b>16.6.1</b> Reindexing the database</a></li>
<li class="chapter" data-level="16.6.2" data-path="database-maintentance.html"><a href="database-maintentance.html#vacuuming-the-database"><i class="fa fa-check"></i><b>16.6.2</b> Vacuuming the database</a></li>
</ul></li>
<li class="chapter" data-level="16.7" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html"><i class="fa fa-check"></i><b>16.7</b> Troubleshooting</a>
<ul>
<li class="chapter" data-level="16.7.1" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html#username-and-password"><i class="fa fa-check"></i><b>16.7.1</b> Username and password</a></li>
<li class="chapter" data-level="16.7.2" data-path="troubleshooting-1.html"><a href="troubleshooting-1.html#db_hba.conf-file"><i class="fa fa-check"></i><b>16.7.2</b> db_hba.conf file</a></li>
</ul></li>
<li class="chapter" data-level="16.8" data-path="network-status-map.html"><a href="network-status-map.html"><i class="fa fa-check"></i><b>16.8</b> Network Status Map</a></li>
<li class="chapter" data-level="16.9" data-path="tasks.html"><a href="tasks.html"><i class="fa fa-check"></i><b>16.9</b> Tasks</a></li>
</ul></li>
<li class="chapter" data-level="17" data-path="standalone-tools-modules.html"><a href="standalone-tools-modules.html"><i class="fa fa-check"></i><b>17</b> Standalone tools (modules)</a>
<ul>
<li class="chapter" data-level="17.1" data-path="LoadData.html"><a href="LoadData.html"><i class="fa fa-check"></i><b>17.1</b> Loading Data in PEcAn</a>
<ul>
<li class="chapter" data-level="17.1.1" data-path="LoadData.html"><a href="LoadData.html#inputs-1"><i class="fa fa-check"></i><b>17.1.1</b> Inputs</a></li>
<li class="chapter" data-level="17.1.2" data-path="LoadData.html"><a href="LoadData.html#output-1"><i class="fa fa-check"></i><b>17.1.2</b> Output</a></li>
<li class="chapter" data-level="17.1.3" data-path="LoadData.html"><a href="LoadData.html#example"><i class="fa fa-check"></i><b>17.1.3</b> Example</a></li>
</ul></li>
<li class="chapter" data-level="17.2" data-path="remote-data-module.html"><a href="remote-data-module.html"><i class="fa fa-check"></i><b>17.2</b> Remote data module</a>
<ul>
<li class="chapter" data-level="17.2.1" data-path="remote-data-module.html"><a href="remote-data-module.html#configuring-remote_process"><i class="fa fa-check"></i><b>17.2.1</b> Configuring <code>remote_process</code></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="18" data-path="shiny.html"><a href="shiny.html"><i class="fa fa-check"></i><b>18</b> Shiny</a>
<ul>
<li class="chapter" data-level="18.1" data-path="testing-the-shiny-server.html"><a href="testing-the-shiny-server.html"><i class="fa fa-check"></i><b>18.1</b> Testing the Shiny Server</a></li>
<li class="chapter" data-level="18.2" data-path="debugging-shiny-apps.html"><a href="debugging-shiny-apps.html"><i class="fa fa-check"></i><b>18.2</b> Debugging Shiny Apps</a></li>
<li class="chapter" data-level="18.3" data-path="checking-log-files.html"><a href="checking-log-files.html"><i class="fa fa-check"></i><b>18.3</b> Checking Log Files</a></li>
</ul></li>
<li class="chapter" data-level="19" data-path="adding-to-pecan.html"><a href="adding-to-pecan.html"><i class="fa fa-check"></i><b>19</b> Adding to PEcAn</a>
<ul>
<li class="chapter" data-level="19.1" data-path="adding-model.html"><a href="adding-model.html"><i class="fa fa-check"></i><b>19.1</b> Adding An Ecosystem Model</a>
<ul>
<li class="chapter" data-level="19.1.1" data-path="adding-model.html"><a href="adding-model.html#using-pecan-database"><i class="fa fa-check"></i><b>19.1.1</b> Using PEcAn Database</a></li>
<li class="chapter" data-level="19.1.2" data-path="adding-model.html"><a href="adding-model.html#define-model_type"><i class="fa fa-check"></i><b>19.1.2</b> Define MODEL_TYPE</a></li>
<li class="chapter" data-level="19.1.3" data-path="adding-model.html"><a href="adding-model.html#machine"><i class="fa fa-check"></i><b>19.1.3</b> MACHINE</a></li>
<li class="chapter" data-level="19.1.4" data-path="adding-model.html"><a href="adding-model.html#model-2"><i class="fa fa-check"></i><b>19.1.4</b> MODEL</a></li>
<li class="chapter" data-level="19.1.5" data-path="adding-model.html"><a href="adding-model.html#formats"><i class="fa fa-check"></i><b>19.1.5</b> FORMATS</a></li>
<li class="chapter" data-level="19.1.6" data-path="adding-model.html"><a href="adding-model.html#model_type---formats"><i class="fa fa-check"></i><b>19.1.6</b> MODEL_TYPE -&gt; Formats</a></li>
<li class="chapter" data-level="19.1.7" data-path="adding-model.html"><a href="adding-model.html#inputs-2"><i class="fa fa-check"></i><b>19.1.7</b> INPUTS</a></li>
<li class="chapter" data-level="19.1.8" data-path="adding-model.html"><a href="adding-model.html#add-plant-functional-types-pfts"><i class="fa fa-check"></i><b>19.1.8</b> Add Plant Functional Types (PFTs)</a></li>
<li class="chapter" data-level="19.1.9" data-path="adding-model.html"><a href="adding-model.html#adding-priors-for-each-variable"><i class="fa fa-check"></i><b>19.1.9</b> Adding Priors for Each Variable</a></li>
<li class="chapter" data-level="19.1.10" data-path="adding-model.html"><a href="adding-model.html#interface-modules"><i class="fa fa-check"></i><b>19.1.10</b> Interface Modules</a></li>
</ul></li>
<li class="chapter" data-level="19.2" data-path="example-met-conversion-wrapper-function.html"><a href="example-met-conversion-wrapper-function.html"><i class="fa fa-check"></i><b>19.2</b> Example met conversion wrapper function</a></li>
<li class="chapter" data-level="19.3" data-path="NewInput.html"><a href="NewInput.html"><i class="fa fa-check"></i><b>19.3</b> Adding input data</a>
<ul>
<li class="chapter" data-level="19.3.1" data-path="NewInput.html"><a href="NewInput.html#input-records-in-bety"><i class="fa fa-check"></i><b>19.3.1</b> Input records in BETY</a></li>
<li class="chapter" data-level="19.3.2" data-path="NewInput.html"><a href="NewInput.html#create-a-database-file-record-for-the-input-data"><i class="fa fa-check"></i><b>19.3.2</b> Create a database file record for the input data</a></li>
<li class="chapter" data-level="19.3.3" data-path="NewInput.html"><a href="NewInput.html#creating-a-new-input-record-in-bety"><i class="fa fa-check"></i><b>19.3.3</b> Creating a new Input record in BETY</a></li>
<li class="chapter" data-level="19.3.4" data-path="NewInput.html"><a href="NewInput.html#InputConversions"><i class="fa fa-check"></i><b>19.3.4</b> Adding a new input converter</a></li>
</ul></li>
<li class="chapter" data-level="19.4" data-path="adding-data-web.html"><a href="adding-data-web.html"><i class="fa fa-check"></i><b>19.4</b> Pecan Data Ingest via Web Interface</a>
<ul>
<li class="chapter" data-level="19.4.1" data-path="adding-data-web.html"><a href="adding-data-web.html#loading-data-1"><i class="fa fa-check"></i><b>19.4.1</b> Loading Data</a></li>
<li class="chapter" data-level="19.4.2" data-path="adding-data-web.html"><a href="adding-data-web.html#local-upload-example"><i class="fa fa-check"></i><b>19.4.2</b> Local Upload Example</a></li>
<li class="chapter" data-level="19.4.3" data-path="adding-data-web.html"><a href="adding-data-web.html#creating-a-format-record"><i class="fa fa-check"></i><b>19.4.3</b> 3. Creating a format record</a></li>
</ul></li>
<li class="chapter" data-level="19.5" data-path="NewFormat.html"><a href="NewFormat.html"><i class="fa fa-check"></i><b>19.5</b> Creating a new format</a>
<ul>
<li class="chapter" data-level="19.5.1" data-path="NewFormat.html"><a href="NewFormat.html#formats-in-bety"><i class="fa fa-check"></i><b>19.5.1</b> Formats in BETY</a></li>
<li class="chapter" data-level="19.5.2" data-path="NewFormat.html"><a href="NewFormat.html#creating-a-new-format-in-bety"><i class="fa fa-check"></i><b>19.5.2</b> Creating a new format in BETY</a></li>
</ul></li>
<li class="chapter" data-level="19.6" data-path="NewBenchmark.html"><a href="NewBenchmark.html"><i class="fa fa-check"></i><b>19.6</b> Creating a new benchmark reference run</a></li>
<li class="chapter" data-level="19.7" data-path="editing-records.html"><a href="editing-records.html"><i class="fa fa-check"></i><b>19.7</b> Editing records</a></li>
</ul></li>
<li class="chapter" data-level="20" data-path="troubleshooting-and-debugging-pecan.html"><a href="troubleshooting-and-debugging-pecan.html"><i class="fa fa-check"></i><b>20</b> Troubleshooting and Debugging PEcAn</a>
<ul>
<li class="chapter" data-level="20.1" data-path="cookies-and-pecan-web-pages.html"><a href="cookies-and-pecan-web-pages.html"><i class="fa fa-check"></i><b>20.1</b> Cookies and pecan web pages</a></li>
<li class="chapter" data-level="20.2" data-path="warning-mkdir-function.mkdir-no-such-file-or-directory.html"><a href="warning-mkdir-function.mkdir-no-such-file-or-directory.html"><i class="fa fa-check"></i><b>20.2</b> <code>Warning: mkdir() [function.mkdir]: No such file or directory</code></a></li>
<li class="chapter" data-level="20.3" data-path="after-creating-a-new-pft-the-tag-for-pft-not-passed-to-config.xml-in-ed.html"><a href="after-creating-a-new-pft-the-tag-for-pft-not-passed-to-config.xml-in-ed.html"><i class="fa fa-check"></i><b>20.3</b> After creating a new PFT the <num> tag for PFT not passed to config.xml in ED</a></li>
<li class="chapter" data-level="20.4" data-path="debugging.html"><a href="debugging.html"><i class="fa fa-check"></i><b>20.4</b> Debugging</a>
<ul>
<li class="chapter" data-level="20.4.1" data-path="debugging.html"><a href="debugging.html#using-testsworkflow.r"><i class="fa fa-check"></i><b>20.4.1</b> Using <code>tests/workflow.R</code></a></li>
</ul></li>
<li class="chapter" data-level="20.5" data-path="useful-scripts.html"><a href="useful-scripts.html"><i class="fa fa-check"></i><b>20.5</b> Useful scripts</a></li>
</ul></li>
<li class="chapter" data-level="21" data-path="database.html"><a href="database.html"><i class="fa fa-check"></i><b>21</b> BETY Database Administration</a>
<ul>
<li class="chapter" data-level="21.1" data-path="database-setup.html"><a href="database-setup.html"><i class="fa fa-check"></i><b>21.1</b> Best practices</a></li>
<li class="chapter" data-level="21.2" data-path="backup-of-bety-database.html"><a href="backup-of-bety-database.html"><i class="fa fa-check"></i><b>21.2</b> Backup of BETY database</a></li>
<li class="chapter" data-level="21.3" data-path="restore-of-bety-database.html"><a href="restore-of-bety-database.html"><i class="fa fa-check"></i><b>21.3</b> Restore of BETY database</a></li>
</ul></li>
<li class="chapter" data-level="22" data-path="workflow-modules.html"><a href="workflow-modules.html"><i class="fa fa-check"></i><b>22</b> Workflow modules</a>
<ul>
<li class="chapter" data-level="22.1" data-path="overview-1.html"><a href="overview-1.html"><i class="fa fa-check"></i><b>22.1</b> Overview</a></li>
<li class="chapter" data-level="22.2" data-path="load-settings.html"><a href="load-settings.html"><i class="fa fa-check"></i><b>22.2</b> Load Settings</a>
<ul>
<li class="chapter" data-level="22.2.1" data-path="load-settings.html"><a href="load-settings.html#read.settingshomepecanpecan.xml"><i class="fa fa-check"></i><b>22.2.1</b> <code>read.settings("/home/pecan/pecan.xml")</code></a></li>
</ul></li>
<li class="chapter" data-level="22.3" data-path="query-database.html"><a href="query-database.html"><i class="fa fa-check"></i><b>22.3</b> Query Database</a>
<ul>
<li class="chapter" data-level="22.3.1" data-path="query-database.html"><a href="query-database.html#get.trait.data"><i class="fa fa-check"></i><b>22.3.1</b> <code>get.trait.data()</code></a></li>
</ul></li>
<li class="chapter" data-level="22.4" data-path="meta-analysis.html"><a href="meta-analysis.html"><i class="fa fa-check"></i><b>22.4</b> Meta Analysis</a>
<ul>
<li class="chapter" data-level="22.4.1" data-path="meta-analysis.html"><a href="meta-analysis.html#run.meta.analysis"><i class="fa fa-check"></i><b>22.4.1</b> <code>run.meta.analysis()</code></a></li>
</ul></li>
<li class="chapter" data-level="22.5" data-path="write-configuration-files.html"><a href="write-configuration-files.html"><i class="fa fa-check"></i><b>22.5</b> Write Configuration Files</a>
<ul>
<li class="chapter" data-level="22.5.1" data-path="write-configuration-files.html"><a href="write-configuration-files.html#write.configsmodel"><i class="fa fa-check"></i><b>22.5.1</b> <code>write.configs(model)</code></a></li>
</ul></li>
<li class="chapter" data-level="22.6" data-path="start-runs.html"><a href="start-runs.html"><i class="fa fa-check"></i><b>22.6</b> Start Runs</a>
<ul>
<li class="chapter" data-level="22.6.1" data-path="start-runs.html"><a href="start-runs.html#start.runsmodel"><i class="fa fa-check"></i><b>22.6.1</b> <code>start.runs(model)</code></a></li>
</ul></li>
<li class="chapter" data-level="22.7" data-path="get-model-output.html"><a href="get-model-output.html"><i class="fa fa-check"></i><b>22.7</b> Get Model Output</a>
<ul>
<li class="chapter" data-level="22.7.1" data-path="get-model-output.html"><a href="get-model-output.html#get.model.outputmodel"><i class="fa fa-check"></i><b>22.7.1</b> <code>get.model.output(model)</code></a></li>
</ul></li>
<li class="chapter" data-level="22.8" data-path="ensemble-analysis.html"><a href="ensemble-analysis.html"><i class="fa fa-check"></i><b>22.8</b> Ensemble Analysis</a>
<ul>
<li class="chapter" data-level="22.8.1" data-path="ensemble-analysis.html"><a href="ensemble-analysis.html#run.ensemble.analysis"><i class="fa fa-check"></i><b>22.8.1</b> <code>run.ensemble.analysis()</code></a></li>
</ul></li>
<li class="chapter" data-level="22.9" data-path="sensitivity-analysis-variance-decomposition.html"><a href="sensitivity-analysis-variance-decomposition.html"><i class="fa fa-check"></i><b>22.9</b> Sensitivity Analysis, Variance Decomposition</a>
<ul>
<li class="chapter" data-level="22.9.1" data-path="sensitivity-analysis-variance-decomposition.html"><a href="sensitivity-analysis-variance-decomposition.html#run.sensitivity.analysis"><i class="fa fa-check"></i><b>22.9.1</b> <code>run.sensitivity.analysis()</code></a></li>
</ul></li>
<li class="chapter" data-level="22.10" data-path="glossary.html"><a href="glossary.html"><i class="fa fa-check"></i><b>22.10</b> Glossary</a></li>
</ul></li>
<li class="chapter" data-level="23" data-path="installation-details.html"><a href="installation-details.html"><i class="fa fa-check"></i><b>23</b> Installation details</a>
<ul>
<li class="chapter" data-level="23.1" data-path="pecanvm.html"><a href="pecanvm.html"><i class="fa fa-check"></i><b>23.1</b> PEcAn Virtual Machine</a></li>
<li class="chapter" data-level="23.2" data-path="aws-setup.html"><a href="aws-setup.html"><i class="fa fa-check"></i><b>23.2</b> AWS Setup</a>
<ul>
<li class="chapter" data-level="23.2.1" data-path="aws-setup.html"><a href="aws-setup.html#convert-pecan-vm"><i class="fa fa-check"></i><b>23.2.1</b> Convert PEcAn VM</a></li>
<li class="chapter" data-level="23.2.2" data-path="aws-setup.html"><a href="aws-setup.html#set-up-an-account-on-aws"><i class="fa fa-check"></i><b>23.2.2</b> Set up an account on <span>AWS</span></a></li>
<li class="chapter" data-level="23.2.3" data-path="aws-setup.html"><a href="aws-setup.html#install-ec2-command-line-tools"><i class="fa fa-check"></i><b>23.2.3</b> Install <span>EC2 command line tools</span></a></li>
<li class="chapter" data-level="23.2.4" data-path="aws-setup.html"><a href="aws-setup.html#create-an-aws-s3-bucket-to-upload-vm-to"><i class="fa fa-check"></i><b>23.2.4</b> Create an AWS S3 ‘bucket’ to upload VM to</a></li>
<li class="chapter" data-level="23.2.5" data-path="aws-setup.html"><a href="aws-setup.html#upload"><i class="fa fa-check"></i><b>23.2.5</b> Upload</a></li>
<li class="chapter" data-level="23.2.6" data-path="aws-setup.html"><a href="aws-setup.html#configuring-the-vm"><i class="fa fa-check"></i><b>23.2.6</b> Configuring the VM</a></li>
<li class="chapter" data-level="23.2.7" data-path="aws-setup.html"><a href="aws-setup.html#set-up-multiple-instances-optional"><i class="fa fa-check"></i><b>23.2.7</b> Set up multiple instances (optional)</a></li>
<li class="chapter" data-level="23.2.8" data-path="aws-setup.html"><a href="aws-setup.html#booting-the-vm"><i class="fa fa-check"></i><b>23.2.8</b> Booting the VM</a></li>
</ul></li>
<li class="chapter" data-level="23.3" data-path="shiny-setup.html"><a href="shiny-setup.html"><i class="fa fa-check"></i><b>23.3</b> Shiny Setup</a>
<ul>
<li class="chapter" data-level="23.3.1" data-path="shiny-setup.html"><a href="shiny-setup.html#install-the-shiny-r-package-and-shiny-server"><i class="fa fa-check"></i><b>23.3.1</b> Install the Shiny R package and Shiny server</a></li>
<li class="chapter" data-level="23.3.2" data-path="shiny-setup.html"><a href="shiny-setup.html#modify-the-shiny-configuration-file"><i class="fa fa-check"></i><b>23.3.2</b> Modify the shiny configuration file</a></li>
<li class="chapter" data-level="23.3.3" data-path="shiny-setup.html"><a href="shiny-setup.html#set-the-apache-proxy"><i class="fa fa-check"></i><b>23.3.3</b> Set the Apache proxy</a></li>
<li class="chapter" data-level="23.3.4" data-path="shiny-setup.html"><a href="shiny-setup.html#enable-and-start-the-shiny-server-and-restart-apache"><i class="fa fa-check"></i><b>23.3.4</b> Enable and start the shiny server, and restart apache</a></li>
<li class="chapter" data-level="23.3.5" data-path="shiny-setup.html"><a href="shiny-setup.html#troubleshooting-2"><i class="fa fa-check"></i><b>23.3.5</b> Troubleshooting</a></li>
<li class="chapter" data-level="23.3.6" data-path="shiny-setup.html"><a href="shiny-setup.html#further-reading"><i class="fa fa-check"></i><b>23.3.6</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="23.4" data-path="thredds-setup.html"><a href="thredds-setup.html"><i class="fa fa-check"></i><b>23.4</b> Thredds Setup</a>
<ul>
<li class="chapter" data-level="23.4.1" data-path="thredds-setup.html"><a href="thredds-setup.html#install-the-tomcat-8-and-thredds-webapp"><i class="fa fa-check"></i><b>23.4.1</b> Install the Tomcat 8 and Thredds webapp</a></li>
<li class="chapter" data-level="23.4.2" data-path="thredds-setup.html"><a href="thredds-setup.html#update-the-catalog"><i class="fa fa-check"></i><b>23.4.2</b> Update the catalog</a></li>
<li class="chapter" data-level="23.4.3" data-path="thredds-setup.html"><a href="thredds-setup.html#troubleshooting-3"><i class="fa fa-check"></i><b>23.4.3</b> Troubleshooting</a></li>
<li class="chapter" data-level="23.4.4" data-path="thredds-setup.html"><a href="thredds-setup.html#further-reading-1"><i class="fa fa-check"></i><b>23.4.4</b> Further reading</a></li>
</ul></li>
<li class="chapter" data-level="23.5" data-path="osinstall.html"><a href="osinstall.html"><i class="fa fa-check"></i><b>23.5</b> OS Specific Installations</a>
<ul>
<li class="chapter" data-level="23.5.1" data-path="osinstall.html"><a href="osinstall.html#ubuntu"><i class="fa fa-check"></i><b>23.5.1</b> Ubuntu</a></li>
<li class="chapter" data-level="23.5.2" data-path="osinstall.html"><a href="osinstall.html#centosredhat"><i class="fa fa-check"></i><b>23.5.2</b> CentOS/RedHat</a></li>
<li class="chapter" data-level="23.5.3" data-path="osinstall.html"><a href="osinstall.html#macosx"><i class="fa fa-check"></i><b>23.5.3</b> Mac OSX</a></li>
<li class="chapter" data-level="23.5.4" data-path="osinstall.html"><a href="osinstall.html#install-bety"><i class="fa fa-check"></i><b>23.5.4</b> Installing BETY</a></li>
<li class="chapter" data-level="23.5.5" data-path="osinstall.html"><a href="osinstall.html#install-models"><i class="fa fa-check"></i><b>23.5.5</b> Install Models</a></li>
<li class="chapter" data-level="23.5.6" data-path="osinstall.html"><a href="osinstall.html#install-data"><i class="fa fa-check"></i><b>23.5.6</b> Installing data for PEcAn</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="24" data-path="docker-index.html"><a href="docker-index.html"><i class="fa fa-check"></i><b>24</b> Docker</a>
<ul>
<li class="chapter" data-level="24.1" data-path="docker-intro.html"><a href="docker-intro.html"><i class="fa fa-check"></i><b>24.1</b> Introduction to Docker?</a>
<ul>
<li class="chapter" data-level="24.1.1" data-path="docker-intro.html"><a href="docker-intro.html#what-is-docker"><i class="fa fa-check"></i><b>24.1.1</b> What is Docker?</a></li>
<li class="chapter" data-level="24.1.2" data-path="docker-intro.html"><a href="docker-intro.html#working-with-docker"><i class="fa fa-check"></i><b>24.1.2</b> Working with Docker</a></li>
<li class="chapter" data-level="24.1.3" data-path="docker-intro.html"><a href="docker-intro.html#docker-compose"><i class="fa fa-check"></i><b>24.1.3</b> <code>docker-compose</code></a></li>
</ul></li>
<li class="chapter" data-level="24.2" data-path="docker-quickstart.html"><a href="docker-quickstart.html"><i class="fa fa-check"></i><b>24.2</b> Quick-start docker install</a></li>
<li class="chapter" data-level="24.3" data-path="the-pecan-docker-install-process-in-detail.html"><a href="the-pecan-docker-install-process-in-detail.html"><i class="fa fa-check"></i><b>24.3</b> The PEcAn docker install process in detail</a>
<ul>
<li class="chapter" data-level="24.3.1" data-path="the-pecan-docker-install-process-in-detail.html"><a href="the-pecan-docker-install-process-in-detail.html#pecan-setup-compose-configure"><i class="fa fa-check"></i><b>24.3.1</b> Configure docker-compose</a></li>
<li class="chapter" data-level="24.3.2" data-path="the-pecan-docker-install-process-in-detail.html"><a href="the-pecan-docker-install-process-in-detail.html#pecan-docker-quickstart-init"><i class="fa fa-check"></i><b>24.3.2</b> Initialize PEcAn (first time only)</a></li>
<li class="chapter" data-level="24.3.3" data-path="the-pecan-docker-install-process-in-detail.html"><a href="the-pecan-docker-install-process-in-detail.html#docker-quickstart-troubleshooting"><i class="fa fa-check"></i><b>24.3.3</b> Troubleshooting</a></li>
</ul></li>
<li class="chapter" data-level="24.4" data-path="pecan-docker.html"><a href="pecan-docker.html"><i class="fa fa-check"></i><b>24.4</b> PEcAn Docker Architecture</a>
<ul>
<li class="chapter" data-level="24.4.1" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-docker-overview"><i class="fa fa-check"></i><b>24.4.1</b> Overview</a></li>
<li class="chapter" data-level="24.4.2" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-docker-compose"><i class="fa fa-check"></i><b>24.4.2</b> PEcAn’s <code>docker-compose</code></a></li>
<li class="chapter" data-level="24.4.3" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-structure"><i class="fa fa-check"></i><b>24.4.3</b> Top-level structure</a></li>
<li class="chapter" data-level="24.4.4" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-traefik"><i class="fa fa-check"></i><b>24.4.4</b> <code>traefik</code></a></li>
<li class="chapter" data-level="24.4.5" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-portainer"><i class="fa fa-check"></i><b>24.4.5</b> <code>portainer</code></a></li>
<li class="chapter" data-level="24.4.6" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-minio"><i class="fa fa-check"></i><b>24.4.6</b> <code>minio</code></a></li>
<li class="chapter" data-level="24.4.7" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-thredds"><i class="fa fa-check"></i><b>24.4.7</b> <code>thredds</code></a></li>
<li class="chapter" data-level="24.4.8" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-postgres"><i class="fa fa-check"></i><b>24.4.8</b> <code>postgres</code></a></li>
<li class="chapter" data-level="24.4.9" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-rabbitmq"><i class="fa fa-check"></i><b>24.4.9</b> <code>rabbitmq</code></a></li>
<li class="chapter" data-level="24.4.10" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-bety"><i class="fa fa-check"></i><b>24.4.10</b> <code>bety</code></a></li>
<li class="chapter" data-level="24.4.11" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-docs"><i class="fa fa-check"></i><b>24.4.11</b> <code>docs</code></a></li>
<li class="chapter" data-level="24.4.12" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-web"><i class="fa fa-check"></i><b>24.4.12</b> <code>web</code></a></li>
<li class="chapter" data-level="24.4.13" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-executor"><i class="fa fa-check"></i><b>24.4.13</b> <code>executor</code></a></li>
<li class="chapter" data-level="24.4.14" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-monitor"><i class="fa fa-check"></i><b>24.4.14</b> <code>monitor</code></a></li>
<li class="chapter" data-level="24.4.15" data-path="pecan-docker.html"><a href="pecan-docker.html#pecan-dc-models"><i class="fa fa-check"></i><b>24.4.15</b> Model-specific containers</a></li>
</ul></li>
<li class="chapter" data-level="24.5" data-path="model-docker.html"><a href="model-docker.html"><i class="fa fa-check"></i><b>24.5</b> Models using Docker</a>
<ul>
<li class="chapter" data-level="24.5.1" data-path="model-docker.html"><a href="model-docker.html#model-docker-json-file"><i class="fa fa-check"></i><b>24.5.1</b> Model information</a></li>
<li class="chapter" data-level="24.5.2" data-path="model-docker.html"><a href="model-docker.html#model-docker-Dockerfile"><i class="fa fa-check"></i><b>24.5.2</b> Model build</a></li>
<li class="chapter" data-level="24.5.3" data-path="model-docker.html"><a href="model-docker.html#common-docker-problems"><i class="fa fa-check"></i><b>24.5.3</b> Common problems</a></li>
<li class="chapter" data-level="24.5.4" data-path="model-docker.html"><a href="model-docker.html#debugging-missing-libraries"><i class="fa fa-check"></i><b>24.5.4</b> Debugging missing libraries</a></li>
</ul></li>
<li class="chapter" data-level="24.6" data-path="docker-build-images.html"><a href="docker-build-images.html"><i class="fa fa-check"></i><b>24.6</b> Building and modifying images</a>
<ul>
<li class="chapter" data-level="24.6.1" data-path="docker-build-images.html"><a href="docker-build-images.html#docker-local-devel"><i class="fa fa-check"></i><b>24.6.1</b> Local development and testing with Docker</a></li>
</ul></li>
<li class="chapter" data-level="24.7" data-path="docker-index.html"><a href="docker-index.html#docker-troubleshooting"><i class="fa fa-check"></i><b>24.7</b> Troubleshooting Docker</a>
<ul>
<li class="chapter" data-level="24.7.1" data-path="docker-troubleshooting.html"><a href="docker-troubleshooting.html"><i class="fa fa-check"></i><b>24.7.1</b> “Package not available” while building images</a></li>
</ul></li>
<li class="chapter" data-level="24.8" data-path="docker-migrate.html"><a href="docker-migrate.html"><i class="fa fa-check"></i><b>24.8</b> Migrating PEcAn from VM to Docker</a>
<ul>
<li class="chapter" data-level="24.8.1" data-path="docker-migrate.html"><a href="docker-migrate.html#running-bety-as-a-docker-container"><i class="fa fa-check"></i><b>24.8.1</b> Running BETY as a docker container</a></li>
</ul></li>
<li class="chapter" data-level="24.9" data-path="pecan-api.html"><a href="pecan-api.html"><i class="fa fa-check"></i><b>24.9</b> The PEcAn Docker API</a></li>
<li class="chapter" data-level="24.10" data-path="rabbitmq.html"><a href="rabbitmq.html"><i class="fa fa-check"></i><b>24.10</b> RabbitMQ</a>
<ul>
<li class="chapter" data-level="24.10.1" data-path="rabbitmq.html"><a href="rabbitmq.html#rabbitmq-basics-sender"><i class="fa fa-check"></i><b>24.10.1</b> Producer – <code>PEcAn.remote::rabbitmq_post_message</code></a></li>
<li class="chapter" data-level="24.10.2" data-path="rabbitmq.html"><a href="rabbitmq.html#rabbitmq-basics-receiver"><i class="fa fa-check"></i><b>24.10.2</b> Consumer – <code>receiver.py</code></a></li>
<li class="chapter" data-level="24.10.3" data-path="rabbitmq.html"><a href="rabbitmq.html#rabbitmq-web"><i class="fa fa-check"></i><b>24.10.3</b> RabbitMQ and the PEcAn web interface</a></li>
<li class="chapter" data-level="24.10.4" data-path="rabbitmq.html"><a href="rabbitmq.html#rabbitmq-xml"><i class="fa fa-check"></i><b>24.10.4</b> RabbitMQ in the PEcAn XML</a></li>
<li class="chapter" data-level="24.10.5" data-path="rabbitmq.html"><a href="rabbitmq.html#rabbitmq-dockerfile"><i class="fa fa-check"></i><b>24.10.5</b> RabbitMQ configuration in Dockerfiles</a></li>
<li class="chapter" data-level="24.10.6" data-path="rabbitmq.html"><a href="rabbitmq.html#rabbitmq-case-study"><i class="fa fa-check"></i><b>24.10.6</b> Case study: PEcAn web interface</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="25" data-path="pecan-remote.html"><a href="pecan-remote.html"><i class="fa fa-check"></i><b>25</b> Remote execution with PEcAn</a>
<ul>
<li class="chapter" data-level="25.1" data-path="basics-of-ssh.html"><a href="basics-of-ssh.html"><i class="fa fa-check"></i><b>25.1</b> Basics of SSH</a></li>
<li class="chapter" data-level="25.2" data-path="ssh-authentication-password-vs.-ssh-key.html"><a href="ssh-authentication-password-vs.-ssh-key.html"><i class="fa fa-check"></i><b>25.2</b> SSH authentication – password vs. SSH key</a></li>
<li class="chapter" data-level="25.3" data-path="ssh-tunneling.html"><a href="ssh-tunneling.html"><i class="fa fa-check"></i><b>25.3</b> SSH tunneling</a></li>
<li class="chapter" data-level="25.4" data-path="ssh-tunnels-and-pecan.html"><a href="ssh-tunnels-and-pecan.html"><i class="fa fa-check"></i><b>25.4</b> SSH tunnels and PEcAn</a></li>
<li class="chapter" data-level="25.5" data-path="basic-remote-execute-functions.html"><a href="basic-remote-execute-functions.html"><i class="fa fa-check"></i><b>25.5</b> Basic remote execute functions</a></li>
<li class="chapter" data-level="25.6" data-path="remote-model-execution-with-pecan.html"><a href="remote-model-execution-with-pecan.html"><i class="fa fa-check"></i><b>25.6</b> Remote model execution with PEcAn</a></li>
<li class="chapter" data-level="25.7" data-path="xml-configuration.html"><a href="xml-configuration.html"><i class="fa fa-check"></i><b>25.7</b> XML configuration</a></li>
<li class="chapter" data-level="25.8" data-path="configuration-for-pecan-web-interface.html"><a href="configuration-for-pecan-web-interface.html"><i class="fa fa-check"></i><b>25.8</b> Configuration for PEcAn web interface</a></li>
<li class="chapter" data-level="25.9" data-path="running-pecan-code-for-remotely.html"><a href="running-pecan-code-for-remotely.html"><i class="fa fa-check"></i><b>25.9</b> Running PEcAn code for remotely</a></li>
<li class="chapter" data-level="25.10" data-path="special-case-geo.bu.html"><a href="special-case-geo.bu.html"><i class="fa fa-check"></i><b>25.10</b> Special case: <code>geo.bu.edu</code></a></li>
</ul></li>
<li class="chapter" data-level="26" data-path="data-assimilation-with-dart.html"><a href="data-assimilation-with-dart.html"><i class="fa fa-check"></i><b>26</b> Data assimilation with DART</a></li>
<li class="part"><span><b>IV Appendix</b></span></li>
<li class="chapter" data-level="27" data-path="miscellaneous.html"><a href="miscellaneous.html"><i class="fa fa-check"></i><b>27</b> Miscellaneous</a>
<ul>
<li class="chapter" data-level="27.1" data-path="todo.html"><a href="todo.html"><i class="fa fa-check"></i><b>27.1</b> TODO</a></li>
<li class="chapter" data-level="27.2" data-path="using-the-pecan-download.file-function.html"><a href="using-the-pecan-download.file-function.html"><i class="fa fa-check"></i><b>27.2</b> Using the PEcAn download.file() function</a></li>
</ul></li>
<li class="chapter" data-level="28" data-path="faq.html"><a href="faq.html"><i class="fa fa-check"></i><b>28</b> FAQ</a></li>
<li class="chapter" data-level="29" data-path="pecan-project-used-in-courses.html"><a href="pecan-project-used-in-courses.html"><i class="fa fa-check"></i><b>29</b> PEcAn Project Used in Courses</a>
<ul>
<li class="chapter" data-level="29.1" data-path="university-classes.html"><a href="university-classes.html"><i class="fa fa-check"></i><b>29.1</b> University classes</a>
<ul>
<li class="chapter" data-level="29.1.1" data-path="university-classes.html"><a href="university-classes.html#ge-375---environmental-modeling---spring-2013-2014-mike-dietze-boston-university"><i class="fa fa-check"></i><b>29.1.1</b> GE 375 - Environmental Modeling - Spring 2013, 2014 (Mike Dietze, Boston University)</a></li>
</ul></li>
<li class="chapter" data-level="29.2" data-path="summer-courses-workshops.html"><a href="summer-courses-workshops.html"><i class="fa fa-check"></i><b>29.2</b> Summer Courses / Workshops</a>
<ul>
<li class="chapter" data-level="29.2.1" data-path="summer-courses-workshops.html"><a href="summer-courses-workshops.html#annual-summer-course-in-flux-measurement-and-advanced-modeling-mike-dietze-ankur-desai-niwot-ridge-co"><i class="fa fa-check"></i><b>29.2.1</b> Annual summer course in flux measurement and advanced modeling (Mike Dietze, Ankur Desai) Niwot Ridge, CO</a></li>
<li class="chapter" data-level="29.2.2" data-path="summer-courses-workshops.html"><a href="summer-courses-workshops.html#assimilating-long-term-data-into-ecosystem-models-paleo-ecological-observatory-network-paleon-project"><i class="fa fa-check"></i><b>29.2.2</b> Assimilating Long-Term Data into Ecosystem Models: Paleo-Ecological Observatory Network (PalEON) Project</a></li>
<li class="chapter" data-level="29.2.3" data-path="summer-courses-workshops.html"><a href="summer-courses-workshops.html#integrating-evidence-on-forest-response-to-climate-change-physiology-to-regional-abundance"><i class="fa fa-check"></i><b>29.2.3</b> Integrating Evidence on Forest Response to Climate Change: Physiology to Regional Abundance</a></li>
<li class="chapter" data-level="29.2.4" data-path="summer-courses-workshops.html"><a href="summer-courses-workshops.html#ecological-society-of-america-meetings"><i class="fa fa-check"></i><b>29.2.4</b> Ecological Society of America meetings</a></li>
</ul></li>
<li class="chapter" data-level="29.3" data-path="selected-publications.html"><a href="selected-publications.html"><i class="fa fa-check"></i><b>29.3</b> Selected Publications</a></li>
</ul></li>
<li class="chapter" data-level="30" data-path="package-dependencies.html"><a href="package-dependencies.html"><i class="fa fa-check"></i><b>30</b> Package Dependencies</a>
<ul>
<li class="chapter" data-level="30.1" data-path="executive-summary-what-to-usually-do.html"><a href="executive-summary-what-to-usually-do.html"><i class="fa fa-check"></i><b>30.1</b> Executive Summary: What to usually do</a></li>
<li class="chapter" data-level="30.2" data-path="big-picture-whats-possible-to-do.html"><a href="big-picture-whats-possible-to-do.html"><i class="fa fa-check"></i><b>30.2</b> Big Picture: What’s possible to do</a></li>
<li class="chapter" data-level="30.3" data-path="declaring-dependencies-depends-suggests-imports.html"><a href="declaring-dependencies-depends-suggests-imports.html"><i class="fa fa-check"></i><b>30.3</b> Declaring Dependencies: Depends, Suggests, Imports</a></li>
<li class="chapter" data-level="30.4" data-path="importing-functions-use-roxygen.html"><a href="importing-functions-use-roxygen.html"><i class="fa fa-check"></i><b>30.4</b> Importing Functions: Use Roxygen</a></li>
<li class="chapter" data-level="30.5" data-path="loading-code-dont-but-use-requirenamespace-when-you-do.html"><a href="loading-code-dont-but-use-requirenamespace-when-you-do.html"><i class="fa fa-check"></i><b>30.5</b> Loading Code: Don’t… But Use <code>requireNamespace</code> When You Do</a></li>
<li class="chapter" data-level="30.6" data-path="installing-dependencies-let-the-machines-do-it.html"><a href="installing-dependencies-let-the-machines-do-it.html"><i class="fa fa-check"></i><b>30.6</b> Installing dependencies: Let the machines do it</a></li>
</ul></li>
<li class="chapter" data-level="31" data-path="appendix-testthat.html"><a href="appendix-testthat.html"><i class="fa fa-check"></i><b>31</b> Testing with the <code>testthat</code> package</a>
<ul>
<li class="chapter" data-level="31.1" data-path="list-of-expectations.html"><a href="list-of-expectations.html"><i class="fa fa-check"></i><b>31.1</b> List of Expectations</a></li>
<li class="chapter" data-level="31.2" data-path="basic-use-of-the-testthat-package.html"><a href="basic-use-of-the-testthat-package.html"><i class="fa fa-check"></i><b>31.2</b> Basic use of the <code>testthat</code> package</a></li>
<li class="chapter" data-level="31.3" data-path="data-for-tests.html"><a href="data-for-tests.html"><i class="fa fa-check"></i><b>31.3</b> Data for tests</a></li>
<li class="chapter" data-level="31.4" data-path="settings-1.html"><a href="settings-1.html"><i class="fa fa-check"></i><b>31.4</b> Settings</a></li>
<li class="chapter" data-level="31.5" data-path="helper-functions-for-unit-tests.html"><a href="helper-functions-for-unit-tests.html"><i class="fa fa-check"></i><b>31.5</b> Helper functions for unit tests</a></li>
</ul></li>
<li class="chapter" data-level="32" data-path="developer-devtools.html"><a href="developer-devtools.html"><i class="fa fa-check"></i><b>32</b> <code>devtools</code> package</a></li>
<li class="chapter" data-level="33" data-path="models_singularity.html"><a href="models_singularity.html"><i class="fa fa-check"></i><b>33</b> <code>singularity</code></a></li>
<li class="chapter" data-level="34" data-path="sibcasa.html"><a href="sibcasa.html"><i class="fa fa-check"></i><b>34</b> SiBCASA</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">The Predictive Ecosystem Analyzer</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="othervignettes" class="section level2 hasAnchor" number="5.5">
<h2><span class="header-section-number">5.5</span> Other Vignettes<a href="othervignettes.html#othervignettes" class="anchor-section" aria-label="Anchor link to header"></a></h2>

<div id="simple-model-data-comparisons" class="section level3 hasAnchor" number="5.5.1">
<h3><span class="header-section-number">5.5.1</span> Simple Model-Data Comparisons<a href="othervignettes.html#simple-model-data-comparisons" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="author-istem-fer-tess-mccabe" class="section level4 hasAnchor" number="5.5.1.1">
<h4><span class="header-section-number">5.5.1.1</span> Author: Istem Fer, Tess McCabe<a href="othervignettes.html#author-istem-fer-tess-mccabe" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In this tutorial we will compare model outputs to data outside of the PEcAn web interface. The goal of this is to demonstrate how to perform additional analyses using PEcAn’s outputs. To do this you can download each of the Output files, and then perform the analyses using whatever software you prefer, or you can perform analyses directly on the PEcAn server itself. Here we’ll be analyzing model outputs in R using a browser-based version of RStudio that’s installed on the server</p>
</div>
<div id="starting-rstudio-server" class="section level4 hasAnchor" number="5.5.1.2">
<h4><span class="header-section-number">5.5.1.2</span> Starting RStudio Server<a href="othervignettes.html#starting-rstudio-server" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ol style="list-style-type: decimal">
<li><p>Open RStudio Server in a new window at <strong><a href="demo-1.html#url-def">URL</a>/rstudio</strong> <!--ERS: this gives a "bad gateway" error with the docker installation --></p></li>
<li><p>The username is carya and the password is illinois.</p></li>
<li><p>To open a new R script click File &gt; New File &gt; R Script</p></li>
<li><p>Use the Files browser on the lower right pane to find where your run(s) are located <!--ERS: I don't see anything that looks like run outputs after successfully running Demo 01--></p></li>
</ol>
<ul>
<li><p>All PEcAn outputs are stored in the output folder. Click on this to open it up.</p></li>
<li><p>Within the outputs folder, there will be one folder for each workflow execution. For example, click to open the folder PEcAn_99000000001 if that’s your workflow ID</p></li>
<li><p>A workflow folder will have a few log and settings files (e.g. pecan.xml) and the following subfolders</p></li>
</ul>
<pre><code>run     contains all the inputs for each run
out     contains all the outputs from each run
pft     contains the parameter information for each PFT</code></pre>
<p>Within both the run and out folders there will be one folder for each unique model run, where the folder name is the run ID. Click to open the out folder. For our simple case we only did one run so there should be only one folder (e.g. 99000000001). Click to open this folder.</p>
<ul>
<li>Within this folder you will find, among other things, files of the format <year>.nc. Each of these files contains one year of model output in the standard PEcAn netCDF format. This is the model output that we will use to compare to data.</li>
</ul>
</div>
<div id="read-in-settings-from-an-xml-file" class="section level4 hasAnchor" number="5.5.1.3">
<h4><span class="header-section-number">5.5.1.3</span> Read in settings From an XML file<a href="othervignettes.html#read-in-settings-from-an-xml-file" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="othervignettes.html#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Read in the xml</span></span>
<span id="cb18-2"><a href="othervignettes.html#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="othervignettes.html#cb18-3" aria-hidden="true" tabindex="-1"></a>settings<span class="ot">&lt;-</span>PEcAn.settings<span class="sc">::</span><span class="fu">read.settings</span>(<span class="st">&quot;~/output/PEcAn_99000000001/pecan.CONFIGS.xml&quot;</span>)</span>
<span id="cb18-4"><a href="othervignettes.html#cb18-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-5"><a href="othervignettes.html#cb18-5" aria-hidden="true" tabindex="-1"></a><span class="do">## To read in the model output</span></span>
<span id="cb18-6"><a href="othervignettes.html#cb18-6" aria-hidden="true" tabindex="-1"></a>runid<span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">read.table</span>(<span class="fu">paste</span>(settings<span class="sc">$</span>outdir, <span class="st">&quot;/run/&quot;</span>,<span class="st">&quot;runs.txt&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))[<span class="dv">1</span>,<span class="dv">1</span>]) <span class="co"># Note: if you are using an xml from a run with multiple ensembles this line will provide only the first run id</span></span>
<span id="cb18-7"><a href="othervignettes.html#cb18-7" aria-hidden="true" tabindex="-1"></a>outdir<span class="ot">&lt;-</span> <span class="fu">paste</span>(settings<span class="sc">$</span>outdir,<span class="st">&quot;/out/&quot;</span>,runid,<span class="at">sep=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb18-8"><a href="othervignettes.html#cb18-8" aria-hidden="true" tabindex="-1"></a>start.year<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(settings<span class="sc">$</span>run<span class="sc">$</span>start.date))</span>
<span id="cb18-9"><a href="othervignettes.html#cb18-9" aria-hidden="true" tabindex="-1"></a>end.year<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(settings<span class="sc">$</span>run<span class="sc">$</span>end.date))</span>
<span id="cb18-10"><a href="othervignettes.html#cb18-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-11"><a href="othervignettes.html#cb18-11" aria-hidden="true" tabindex="-1"></a>site.id<span class="ot">&lt;-</span>settings<span class="sc">$</span>run<span class="sc">$</span>site<span class="sc">$</span>id</span>
<span id="cb18-12"><a href="othervignettes.html#cb18-12" aria-hidden="true" tabindex="-1"></a>File_path<span class="ot">&lt;-</span><span class="st">&quot;~/output/dbfiles/AmerifluxLBL_site_0-772/AMF_US-NR1_BASE_HH_9-1.csv&quot;</span></span>
<span id="cb18-13"><a href="othervignettes.html#cb18-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-14"><a href="othervignettes.html#cb18-14" aria-hidden="true" tabindex="-1"></a><span class="do">## Open up a connection to The Bety Database</span></span>
<span id="cb18-15"><a href="othervignettes.html#cb18-15" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> PEcAn.DB<span class="sc">::</span><span class="fu">db.open</span>(settings<span class="sc">$</span>database<span class="sc">$</span>bety)</span></code></pre></div>
</div>
<div id="read-in-model-output-from-specific-variables" class="section level4 hasAnchor" number="5.5.1.4">
<h4><span class="header-section-number">5.5.1.4</span> Read in model output from specific variables<a href="othervignettes.html#read-in-model-output-from-specific-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="othervignettes.html#cb19-1" aria-hidden="true" tabindex="-1"></a>model_vars<span class="ot">&lt;-</span><span class="fu">c</span>(<span class="st">&quot;time&quot;</span>, <span class="st">&quot;NEE&quot;</span>) <span class="co">#varibles being read</span></span>
<span id="cb19-2"><a href="othervignettes.html#cb19-2" aria-hidden="true" tabindex="-1"></a>model <span class="ot">&lt;-</span> PEcAn.utils<span class="sc">::</span><span class="fu">read.output</span>(runid,outdir,start.year, end.year, model_vars,<span class="at">dataframe=</span><span class="cn">TRUE</span>)</span></code></pre></div>
<p>The arguments to read.output are the run ID, the folder where the run is located, the start year, the end year, and the variables being read. The README file in the Input file dropdown menu of any successful run lists the run ID, the output folder, and the start and end year.</p>
</div>
<div id="compare-model-to-flux-observations" class="section level4 hasAnchor" number="5.5.1.5">
<h4><span class="header-section-number">5.5.1.5</span> Compare model to flux observations<a href="othervignettes.html#compare-model-to-flux-observations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p><strong>First</strong> <em>load up the observations</em> and take a look at the contents of the file</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="othervignettes.html#cb20-1" aria-hidden="true" tabindex="-1"></a>File_format<span class="ot">&lt;-</span>PEcAn.DB<span class="sc">::</span><span class="fu">query.format.vars</span>(<span class="at">bety =</span> con, <span class="at">format.id =</span> <span class="dv">5000000002</span>) <span class="co">#This matches the file with a premade &quot;format&quot; or a template that describes how the information in the file is organized</span></span>
<span id="cb20-2"><a href="othervignettes.html#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="othervignettes.html#cb20-3" aria-hidden="true" tabindex="-1"></a>site<span class="ot">&lt;-</span>PEcAn.DB<span class="sc">::</span><span class="fu">query.site</span>(site.id, con) <span class="co">#This tells PEcAn where the data comes from</span></span>
<span id="cb20-4"><a href="othervignettes.html#cb20-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-5"><a href="othervignettes.html#cb20-5" aria-hidden="true" tabindex="-1"></a>observations<span class="ot">&lt;-</span>PEcAn.benchmark<span class="sc">::</span><span class="fu">load_data</span>(<span class="at">data.path =</span> File_path, <span class="at">format=</span> File_format, <span class="at">time.row =</span> File_format<span class="sc">$</span>time.row,  <span class="at">site =</span> site, <span class="at">start_year =</span> start.year, <span class="at">end_year =</span> end.year) <span class="co">#This will throw an error that not all of the units can be converted. That&#39;s ok, as the units of the varibles of interest (NEE) are being converted.</span></span></code></pre></div>
<p>File_Path refers to where you stored your observational data. In this example the default file path is an Ameriflux dataset from Niwot Ridge.</p>
<p>File_format queries the database for the format your file is in. The default format ID “5000000002” is for csv files downloaded from the Ameriflux website.
You could query for diffent kinds of formats that exist in bety or <a href="https://pecanproject.github.io/pecan-documentation/adding-an-ecosystem-model.html#formats">make your own</a>.</p>
<p>Here 772 is the database site ID for Niwot Ridge Forest, which tells pecan where the data is from and what time zone to assign any time data read in.</p>
<p><strong>Second</strong> <em>apply a conservative u* filter to observations</em></p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="othervignettes.html#cb21-1" aria-hidden="true" tabindex="-1"></a>observations<span class="sc">$</span>NEE[observations<span class="sc">$</span>UST<span class="sc">&lt;</span><span class="fl">0.2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span></span></code></pre></div>
<p><strong>Third</strong> <em>align model output and observations</em></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="othervignettes.html#cb22-1" aria-hidden="true" tabindex="-1"></a>aligned_dat <span class="ot">=</span> PEcAn.benchmark<span class="sc">::</span><span class="fu">align_data</span>(<span class="at">model.calc =</span> model, <span class="at">obvs.calc =</span> observations, <span class="at">var =</span><span class="st">&quot;NEE&quot;</span>, <span class="at">align_method =</span> <span class="st">&quot;match_timestep&quot;</span>)</span></code></pre></div>
<p>When we aligned the data, we got a dataframe with the variables we requested in a <span class="math inline">\(NEE.m\)</span> and a <span class="math inline">\(NEE.o\)</span> format. The <span class="math inline">\(.o\)</span> is for observations, and the <span class="math inline">\(.m\)</span> is for model. The posix column allows for easy plotting along a timeseries.</p>
<p><strong>Fourth</strong>, <em>plot model predictions vs. observations</em> and compare this to a 1:1 line</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="othervignettes.html#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted vs observed plot</span></span>
<span id="cb23-2"><a href="othervignettes.html#cb23-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aligned_dat<span class="sc">$</span>NEE.m, aligned_dat<span class="sc">$</span>NEE.o)</span>
<span id="cb23-3"><a href="othervignettes.html#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)  <span class="do">## intercept=0, slope=1</span></span></code></pre></div>
<p><strong>Fifth</strong>, <em>calculate the Root Mean Square Error (RMSE)</em> between the model and the data</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="othervignettes.html#cb24-1" aria-hidden="true" tabindex="-1"></a>rmse <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((aligned_dat<span class="sc">$</span>NEE.m<span class="sc">-</span>aligned_dat<span class="sc">$</span>NEE.o)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p><em>na.rm</em> makes sure we don’t include missing or screened values in either time series.</p>
<p><strong>Finally</strong>, <em>plot time-series</em> of both the model and data together</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="othervignettes.html#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="do">## plot aligned data</span></span>
<span id="cb25-2"><a href="othervignettes.html#cb25-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(aligned_dat<span class="sc">$</span>posix, aligned_dat<span class="sc">$</span>NEE.o, <span class="at">type=</span><span class="st">&quot;l&quot;</span>)</span>
<span id="cb25-3"><a href="othervignettes.html#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="fu">lines</span>(aligned_dat<span class="sc">$</span>posix,aligned_dat<span class="sc">$</span>NEE.m, <span class="at">col =</span> <span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p><strong>Bonus</strong> <em>How would you compare aggregated data?</em></p>
<p>Try RMSE against monthly NEE instead of half-hourly. In this case, first average the values up to monthly in the observations. Then, use align_data to match the monthly timestep in model output.</p>
<p><strong>NOTE</strong>: Align_data uses two seperate alignment function, match_timestep and mean_over_larger_timestep. Match_timestep will use only that data that is present in both the model and the observation. This is helpful for sparse observations. Mean_over_larger_timestep aggregates the values over the largest timestep present. If you were to look at averaged monthly data, you would use mean_over_larger_timestep.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="othervignettes.html#cb26-1" aria-hidden="true" tabindex="-1"></a>monthlyNEEobs<span class="ot">&lt;-</span><span class="fu">aggregate</span>(observations, <span class="at">by=</span> <span class="fu">list</span>(<span class="fu">month</span>(observations<span class="sc">$</span>posix)), <span class="at">simplify=</span><span class="cn">TRUE</span>, <span class="at">FUN =</span>mean, <span class="at">na.rm=</span> <span class="cn">TRUE</span>)</span>
<span id="cb26-2"><a href="othervignettes.html#cb26-2" aria-hidden="true" tabindex="-1"></a>plottable<span class="ot">&lt;-</span><span class="fu">align_data</span>(<span class="at">model.calc =</span> model, <span class="at">obvs.calc =</span> monthlyNEEobs, <span class="at">align_method =</span> <span class="st">&quot;mean_over_larger_timestep&quot;</span>, <span class="at">var=</span> <span class="st">&quot;NEE&quot;</span>)</span>
<span id="cb26-3"><a href="othervignettes.html#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plottable)</span></code></pre></div>

</div>
</div>
<div id="data-assimilation-concepts" class="section level3 hasAnchor" number="5.5.2">
<h3><span class="header-section-number">5.5.2</span> Data Assimilation Concepts<a href="othervignettes.html#data-assimilation-concepts" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>The goal of this tutorial is to help you gain some hands-on familiarity with some of the concepts, tools, and techniques involved in Bayesian Calibration. As a warm-up to more advanced approaches to model-data fusion involving full ecosystem models, this example will focus on fitting the Farquhar, von Caemmerer, and Berry (1980) photosynthesis model [FvCB model] to leaf-level photosynthetic data. This is a simple, nonlinear model consisting of 3 equations that models net carbon assimilation, <span class="math inline">\(A^{(m)}\)</span>, at the scale of an individual leaf as a function of light and CO2.</p>
<p><span class="math display">\[A_j = \frac{\alpha Q}{\sqrt{1+(\alpha^2 Q^2)/(Jmax^2)}} \frac{C_i- \Gamma}{4 C_i + 8 \Gamma}\]</span></p>
<p><span class="math display">\[A_c = V_{cmax} \frac{C_i - \Gamma}{C_i+ K_C (1+[O]/K_O) }\]</span></p>
<p><span class="math display">\[A^{(m)} = min(A_j,A_c) - r\]</span></p>
<p>The first equation <span class="math inline">\(A_j\)</span> describes the RUBP-regeneration limited case. In this equation the first fraction is a nonrectangular hyperbola predicting <span class="math inline">\(J\)</span>, the electron transport rate, as a function of incident light <span class="math inline">\(Q\)</span>, quantum yield <span class="math inline">\(\alpha\)</span>, and the assymptotic saturation of <span class="math inline">\(J\)</span> at high light <span class="math inline">\(J_{max}\)</span>. The second equation, <span class="math inline">\(A_c\)</span>, describes the Rubisco limited case. The third equation says that the overall net assimilation is determined by whichever of the two above cases is limiting, minus the leaf respiration rate, <span class="math inline">\(r\)</span>.</p>
<p>To keep things simple, as a Data Model (a.k.a. Likelihood or Cost Function) we’ll assume that the observed leaf-level assimilation <span class="math inline">\(A^{(o)}\)</span> is Normally distributed around the model predictions with observation error <span class="math inline">\(\tau\)</span>.</p>
<p><span class="math display">\[A^{(o)} \sim N(A^{(m)},\tau)\]</span></p>
<p>To fit this model to data we’re going to rely on a piece of statistical software known as JAGS. The above model would be written in JAGS as:</p>
<pre><code>model{

## Priors
  Jmax ~ dlnorm(4.7,2.7)             ## maximum electron transport rate prior
  alpha~dnorm(0.25,100)              ##quantum yield  (mol electrons/mole photon) prior
  vmax ~dlnorm(4.6,2.7)              ## maximum rubisco capacity prior

  r ~ dlnorm(0.75,1.56)              ## leaf respiration prior
  cp ~ dlnorm(1.9,2.7)               ## CO2 compensation point prior
  tau ~ dgamma(0.1,0.1)

  for(i in 1:n){

     ## electron transport limited
     Aj[i]&lt;-(alpha*q[i]/(sqrt(1+(alpha*alpha*q[i]*q[i])/(Jmax*Jmax))))*(pi[i]-cp)/(4*pi[i]+8*cp)    

     ## maximum rubisco limited without covariates
     Ac[i]&lt;- vmax*(pi[i]-cp)/(pi[i]+Kc*(1+po/Ko))                                                    

     Am[i]&lt;-min(Aj[i], Ac[i]) - r      ## predicted net photosynthesis
     Ao[i]~dnorm(Am[i],tau)            ## likelihood
     }

}</code></pre>
<p>The first chunk of code defines the <em>prior</em> probability distributions. In Bayesian inference every unknown parameter that needs to be estimated is required to have a prior distribution. Priors are the expression of our belief about what values a parameter might take on <strong>prior to observing the data</strong>. They can arise from many sources of information (literature survey, meta-analysis, expert opinion, etc.) provided that they do not make use of the data that is being used to fit the model. In this particular case, the priors were defined by Feng and Dietze 2013. Most priors are lognormal or gamma, which were choosen because most of these parameters need to be positive.</p>
<p>After the priors is the Data Model, which in JAGS needs to be implemented as a loop over every observation. This is simply a codified version of the earlier equations.</p>
<p>Table 1: FvCB model parameters in the statistical code, their symbols in equations, and definitions</p>
<table>
<thead>
<tr class="header">
<th>Parameter</th>
<th>Symbol</th>
<th>Definition</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>alpha0</td>
<td><span class="math inline">\(\alpha\)</span></td>
<td>quantum yield (mol electrons/mole photon)</td>
</tr>
<tr class="even">
<td>Jmax</td>
<td><span class="math inline">\(J_{max}\)</span></td>
<td>maximum electron transport</td>
</tr>
<tr class="odd">
<td>cp</td>
<td><span class="math inline">\(\Gamma\)</span></td>
<td>CO2 compensation point</td>
</tr>
<tr class="even">
<td>vmax0</td>
<td><span class="math inline">\(V_{cmax}\)</span></td>
<td>maximum Rubisco capacity (a.k.a Vcmax)</td>
</tr>
<tr class="odd">
<td>r</td>
<td><span class="math inline">\(R_d\)</span></td>
<td>leaf respiration</td>
</tr>
<tr class="even">
<td>tau</td>
<td><span class="math inline">\(\tau\)</span></td>
<td>residual precision</td>
</tr>
<tr class="odd">
<td>q</td>
<td><span class="math inline">\(Q\)</span></td>
<td>PAR</td>
</tr>
<tr class="even">
<td>pi</td>
<td><span class="math inline">\(C_i\)</span></td>
<td>CO2 concentration</td>
</tr>
</tbody>
</table>
<div id="fitting-the-model" class="section level4 hasAnchor" number="5.5.2.1">
<h4><span class="header-section-number">5.5.2.1</span> Fitting the model<a href="othervignettes.html#fitting-the-model" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>To begin with we’ll load up an example A-Ci and A-Q curve that was collected during the 2012 edition of the <a href="http://www.fluxcourse.org/">Flux Course</a> at Niwot Ridge. The exact syntax below may be a bit confusing to those unaccustomed to R, but the essence is that the <code>filenames</code> line is looking up where the example data is stored in the PEcAn.photosynthesis package and the <code>dat</code> line is loading up two files (once A-Ci, the other A-Q) and concatanating them together.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="othervignettes.html#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PEcAn.photosynthesis)</span>
<span id="cb28-2"><a href="othervignettes.html#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="othervignettes.html#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="do">### Load built in data</span></span>
<span id="cb28-4"><a href="othervignettes.html#cb28-4" aria-hidden="true" tabindex="-1"></a>filenames <span class="ot">&lt;-</span> <span class="fu">system.file</span>(<span class="st">&quot;extdata&quot;</span>, <span class="fu">paste0</span>(<span class="st">&quot;flux-course-3&quot;</span>,<span class="fu">c</span>(<span class="st">&quot;aci&quot;</span>,<span class="st">&quot;aq&quot;</span>)), <span class="at">package =</span> <span class="st">&quot;PEcAn.photosynthesis&quot;</span>)</span>
<span id="cb28-5"><a href="othervignettes.html#cb28-5" aria-hidden="true" tabindex="-1"></a>dat<span class="ot">&lt;-</span><span class="fu">do.call</span>(<span class="st">&quot;rbind&quot;</span>, <span class="fu">lapply</span>(filenames, read_Licor))</span>
<span id="cb28-6"><a href="othervignettes.html#cb28-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-7"><a href="othervignettes.html#cb28-7" aria-hidden="true" tabindex="-1"></a><span class="do">## Simple plots</span></span>
<span id="cb28-8"><a href="othervignettes.html#cb28-8" aria-hidden="true" tabindex="-1"></a>aci <span class="ot">=</span> <span class="fu">as.character</span>(dat<span class="sc">$</span>fname) <span class="sc">==</span> <span class="fu">basename</span>(filenames[<span class="dv">1</span>])</span>
<span id="cb28-9"><a href="othervignettes.html#cb28-9" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>Ci[aci],dat<span class="sc">$</span>Photo[aci],<span class="at">main=</span><span class="st">&quot;ACi&quot;</span>)</span>
<span id="cb28-10"><a href="othervignettes.html#cb28-10" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(dat<span class="sc">$</span>PARi[<span class="sc">!</span>aci],dat<span class="sc">$</span>Photo[<span class="sc">!</span>aci],<span class="at">main=</span><span class="st">&quot;AQ&quot;</span>)</span></code></pre></div>
<p>In PEcAn we’ve written a wrapper function, <span class="math inline">\(fitA\)</span>, around the statistical model discussed above, which has a number of other bells and whistles discussed in the <a href="https://github.com/PecanProject/pecan/blob/master/modules/photosynthesis/vignettes/ResponseCurves.Rmd">PEcAn Photosynthesis Vignette</a>. For today we’ll just use the most basic version, which takes as arguments the data and the number of MCMC iterations we want to run.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="othervignettes.html#cb29-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">&lt;-</span> <span class="fu">fitA</span>(dat,<span class="at">model=</span><span class="fu">list</span>(<span class="at">n.iter=</span><span class="dv">10000</span>))</span></code></pre></div>
</div>
<div id="whats-going-on" class="section level4 hasAnchor" number="5.5.2.2">
<h4><span class="header-section-number">5.5.2.2</span> What’s going on<a href="othervignettes.html#whats-going-on" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Bayesian numerical methods for model calibration are based on sampling parameter values from the posterior distribution. Fundamentally what’s returned is a matrix, with the number of iterations as rows and the number of parameters as columns, which are samples from the posterior distribution, from which we can approximate any quantity of interest (mean, median, variance, CI, etc.).</p>
<p>The following plots follow the trajectory of two correlated parameters, Jmax and alpha. In the first figure, arrows show the first 10 iterations. Internally JAGS is choosing between a variety of different Bayesian sampling methods (e.g. Metropolis-Hasting, Gibbs sampling, slice sampling, rejection sampling, etc) to draw a new value for each parameter conditional on the current value. After just 10 steps we don’t have a good picture of the overall posterior, but it should still be clear that the sampling is not a complete random walk.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="othervignettes.html#cb30-1" aria-hidden="true" tabindex="-1"></a>params <span class="ot">&lt;-</span> <span class="fu">as.matrix</span>(fit<span class="sc">$</span>params)</span>
<span id="cb30-2"><a href="othervignettes.html#cb30-2" aria-hidden="true" tabindex="-1"></a>xrng <span class="ot">=</span> <span class="fu">range</span>(fit<span class="sc">$</span>params[,<span class="st">&quot;alpha0&quot;</span>])</span>
<span id="cb30-3"><a href="othervignettes.html#cb30-3" aria-hidden="true" tabindex="-1"></a>yrng <span class="ot">=</span> <span class="fu">range</span>(fit<span class="sc">$</span>params[,<span class="st">&quot;Jmax0&quot;</span>])</span>
<span id="cb30-4"><a href="othervignettes.html#cb30-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-5"><a href="othervignettes.html#cb30-5" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb30-6"><a href="othervignettes.html#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(params[n,<span class="st">&quot;alpha0&quot;</span>],params[n,<span class="st">&quot;Jmax0&quot;</span>],<span class="at">type=</span><span class="st">&#39;n&#39;</span>,<span class="at">xlim=</span>xrng,<span class="at">ylim=</span>yrng)</span>
<span id="cb30-7"><a href="othervignettes.html#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="fu">arrows</span>(params[n[<span class="sc">-</span><span class="dv">10</span>],<span class="st">&quot;alpha0&quot;</span>],params[n[<span class="sc">-</span><span class="dv">10</span>],<span class="st">&quot;Jmax0&quot;</span>],params[n[<span class="sc">-</span><span class="dv">1</span>],<span class="st">&quot;alpha0&quot;</span>],params[n[<span class="sc">-</span><span class="dv">1</span>],<span class="st">&quot;Jmax0&quot;</span>],<span class="at">length=</span><span class="fl">0.125</span>,<span class="at">lwd=</span><span class="fl">1.1</span>)</span></code></pre></div>
<p>After 100 steps, we can see a cloud start to form, with occassional wanderings around the periphery.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="othervignettes.html#cb31-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">100</span></span>
<span id="cb31-2"><a href="othervignettes.html#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(params[n,<span class="st">&quot;alpha0&quot;</span>],params[n,<span class="st">&quot;Jmax0&quot;</span>],<span class="at">type=</span><span class="st">&#39;l&#39;</span>,<span class="at">xlim=</span>xrng,<span class="at">ylim=</span>yrng)</span></code></pre></div>
<p>After <span class="math inline">\(nrow(params)\)</span> steps what we see is a point cloud of samples from the joint posterior distribution. When viewed sequentially, points are not independent, but we are interested in working with the overall distribution, where the order of samples is not important.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="othervignettes.html#cb32-1" aria-hidden="true" tabindex="-1"></a>n <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(params)</span>
<span id="cb32-2"><a href="othervignettes.html#cb32-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(params[n,<span class="st">&quot;alpha0&quot;</span>],params[n,<span class="st">&quot;Jmax0&quot;</span>],<span class="at">type=</span><span class="st">&#39;p&#39;</span>,<span class="at">pch=</span><span class="st">&quot;+&quot;</span>,<span class="at">cex=</span><span class="fl">0.5</span>,<span class="at">xlim=</span>xrng,<span class="at">ylim=</span>yrng)</span></code></pre></div>
</div>
<div id="evaluating-the-model-output" class="section level4 hasAnchor" number="5.5.2.3">
<h4><span class="header-section-number">5.5.2.3</span> Evaluating the model output<a href="othervignettes.html#evaluating-the-model-output" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A really important aspect of Bayesian inference is that the output is the <strong>joint</strong> posterior probability of all the parameters. This is very different from an optimization approach, which tries to find a single best parameter value. It is also different from estimating the independent posterior probabilities of each parameter – Bayesian posteriors frequently have strong correlation among parameters for reasons having to do both with model structure and the underlying data.</p>
<p>The model we’re fitting has six free parameters, and therefore the output matrix has 6 columns, of which we’ve only looked at two. Unfortunately it is impossible to visualize a 6 dimensional parameter space on a two dimensional screen, so a very common practice (for models with a small to medium number of parameters) is to look at all pairwise scatterplots. If parameters are uncorrelated we will typically see oval shaped clouds that are oriented in the same directions as the axes. For parameters with linear correlations those clouds will be along a diagonal. For parameters with nonlinear trade-offs the shapes of the parameter clouds can be more complex, such as the banana-shaped or triangular. For the FvCB model we see very few parameters that are uncorrelated or have simple linear correlations, a fact that we should keep in mind when interpreting individual parameters.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="othervignettes.html#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="fu">pairs</span>(params,<span class="at">pch=</span><span class="st">&quot;.&quot;</span>)</span></code></pre></div>
<p>The three most common outputs that are performed on almost all Bayesian analyses are to look at the MCMC chains themselves, the marginal distributions of each parameter, and the overall summary statistics.</p>
<p>The ‘trace’ diagrams below show the history of individual parameters during the MCMC sampling. There are different color lines that represent the fact that JAGS ran the MCMC multiple times, with each run (i.e. each color) being refered to as a different <span class="math inline">\(chain\)</span>. It is common to run multiple chains in order to assess whether the model, started from different points, consistently converges on the same answer. The ideal trace plot looks like white noise with all chains in agreement.</p>
<p>The ‘density’ figures represent smoothed versions of the <em>marginal</em> distributions of each parameter. The tick marks on the x-axis are the actual samples. You will note that some posteriors will look approximately Normal, while others may be skewed or have clearly defined boundaries. On occassion there will even be posteriors that are multimodal. There is no assumption built into Bayesian statistics that the posteriors need be Normal, so as long as an MCMC has converged this diversity of shapes is valid. [note: the most common cause of multi-modal posteriors is a lack of convergence]</p>
<p>Finally, the summary table reports, for each parameter, a mean, standard deviation, two variants of standard error, and standard quantile estimates (95% CI, interquartile, and median). The standard deviation of the posterior is a good summary statistic about <strong>how uncertain we are about a parameter</strong>. The Naive SE is the traditonal <span class="math inline">\(\frac{SD}{\sqrt{n}}\)</span>, which is an estimate of the <strong>NUMERICAL accuracy in our estimate of the mean</strong>. As we run the MCMC longer (i.e. take more samples), we get an answer that is numerically more precise (SE converges to 0) but the uncertainty in the parameter (i.e. SD) stays the same because that’s determined by the sample size of the DATA not the length of the MCMC. Finally, the Time-series SE is a variant of the SE calculation that accounts for the autocorrelation in the MCMC samples. In practice is is therefore more appropriate to use this term to assess numerical accuracy.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="othervignettes.html#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(fit<span class="sc">$</span>params,<span class="at">auto.layout =</span> <span class="cn">FALSE</span>)    <span class="do">## MCMC diagnostic plots</span></span>
<span id="cb34-2"><a href="othervignettes.html#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(fit<span class="sc">$</span>params) <span class="do">## parameter estimates  </span></span></code></pre></div>
<p>Assessing the convergence of the MCMC is first done visually, but more generally the use of statistical diagnostics to assess convergence is highly encouraged. There are a number of metrics in the literature, but the most common is the Gelman-Brooks-Rubin statistic, which compare the variance within each chain to the variance across chains. If the chains have converged then this quantity should be 1. Values less than 1.05 are typically considered sufficient by most statisticians, but these are just rules-of-thumb.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="othervignettes.html#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.plot</span>(fit<span class="sc">$</span>params,<span class="at">auto.layout =</span> <span class="cn">FALSE</span>)</span>
<span id="cb35-2"><a href="othervignettes.html#cb35-2" aria-hidden="true" tabindex="-1"></a><span class="fu">gelman.diag</span>(fit<span class="sc">$</span>params)</span></code></pre></div>
<p>As with any modeling, whether statistical or process-based, another common diagnostic is a predicted vs observed plot. In a perfect model the data would fall along the 1:1 line. The deviations away from this line are the model residuals. If observations lie along a line other than the 1:1 this indicates that the model is biased in some way. This bias is often assessed by fitting a linear regression to the points, though two important things are noteworthy about this practice. First, the <span class="math inline">\(R^2\)</span> and residual error of this regression are not the appropriate statistics to use to assess model performance (though you will frequently find them reported incorrectly in the literature). The correct <span class="math inline">\(R^2\)</span> and residual error (a.k.a Root Mean Square Error, RMSE) are based on deviations from the 1:1 line, not the regression. The code below shows these two terms calculated by hand. The second thing to note about the regression line is that the standard regression F-test, which assesses deviations from 0, is not the test you are actually interested in, which is whether the line differs from 1:1. Therefore, while the test on the intercept is correct, as this value should be 0 in an unbiased model, the test statistic on the slope is typically of less interest (unless your question really is about whether the model is doing better than random). However, this form of bias can easily be assessed by looking to see if the CI for the slope overlaps with 1.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="othervignettes.html#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="do">## predicted vs observed plot</span></span>
<span id="cb36-2"><a href="othervignettes.html#cb36-2" aria-hidden="true" tabindex="-1"></a><span class="fu">par</span>(<span class="at">mfrow=</span><span class="fu">c</span>(<span class="dv">1</span>,<span class="dv">1</span>))</span>
<span id="cb36-3"><a href="othervignettes.html#cb36-3" aria-hidden="true" tabindex="-1"></a>mstats <span class="ot">=</span> <span class="fu">summary</span>(fit<span class="sc">$</span>predict)</span>
<span id="cb36-4"><a href="othervignettes.html#cb36-4" aria-hidden="true" tabindex="-1"></a>pmean <span class="ot">=</span> mstats<span class="sc">$</span>statistics[<span class="fu">grep</span>(<span class="st">&quot;pmean&quot;</span>,<span class="fu">rownames</span>(mstats<span class="sc">$</span>statistics)),<span class="dv">1</span>]</span>
<span id="cb36-5"><a href="othervignettes.html#cb36-5" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(pmean,dat<span class="sc">$</span>Photo,<span class="at">pch=</span><span class="st">&quot;+&quot;</span>,<span class="at">xlab=</span><span class="st">&quot;Predicted A&quot;</span>,<span class="at">ylab =</span> <span class="st">&quot;Observed A&quot;</span>)</span>
<span id="cb36-6"><a href="othervignettes.html#cb36-6" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">col=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb36-7"><a href="othervignettes.html#cb36-7" aria-hidden="true" tabindex="-1"></a>bias.fit <span class="ot">=</span> <span class="fu">lm</span>(dat<span class="sc">$</span>Photo<span class="sc">~</span>pmean)</span>
<span id="cb36-8"><a href="othervignettes.html#cb36-8" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(bias.fit,<span class="at">col=</span><span class="dv">3</span>,<span class="at">lty=</span><span class="dv">2</span>,<span class="at">lwd=</span><span class="dv">2</span>)</span>
<span id="cb36-9"><a href="othervignettes.html#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topleft&quot;</span>,<span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;1:1&quot;</span>,<span class="st">&quot;regression&quot;</span>),<span class="at">lwd=</span><span class="dv">2</span>,<span class="at">col=</span><span class="dv">2</span><span class="sc">:</span><span class="dv">3</span>,<span class="at">lty=</span><span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>)</span>
<span id="cb36-10"><a href="othervignettes.html#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(bias.fit)</span>
<span id="cb36-11"><a href="othervignettes.html#cb36-11" aria-hidden="true" tabindex="-1"></a>RMSE <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((pmean<span class="sc">-</span>dat<span class="sc">$</span>Photo)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb36-12"><a href="othervignettes.html#cb36-12" aria-hidden="true" tabindex="-1"></a>RMSE</span>
<span id="cb36-13"><a href="othervignettes.html#cb36-13" aria-hidden="true" tabindex="-1"></a>R2 <span class="ot">=</span> <span class="dv">1</span><span class="sc">-</span>RMSE<span class="sc">^</span><span class="dv">2</span><span class="sc">/</span>stats<span class="sc">::</span><span class="fu">var</span>(dat<span class="sc">$</span>Photo)</span>
<span id="cb36-14"><a href="othervignettes.html#cb36-14" aria-hidden="true" tabindex="-1"></a>R2</span>
<span id="cb36-15"><a href="othervignettes.html#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="fu">confint</span>(bias.fit)</span></code></pre></div>
<p>In the final set of plots we look at the actual A-Ci and A-Q curves themselves. Here we’ve added two interval estimates around the curves. The CI captures the uncertainty in the <em>parameters</em> and will asympotically shrink with more and more data. The PI (predictive interval) includes the parameter and residual error. If our fit is good then 95% PI should thus encompass at least 95% of the observations. That said, as with any statistical model we want to look for systematic deviations in the residuals from either the mean or the range of the PI.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="othervignettes.html#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="do">## Response curve</span></span>
<span id="cb37-2"><a href="othervignettes.html#cb37-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_photo</span>(dat,fit)</span></code></pre></div>
<p>Note: on the last figure you will get warnings about “No ACi” and “No AQ” which can be ignored. These are occuring because the file that had the ACi curve didn’t have an AQ curve, and the file that had the AQ curve didn’t have an ACi curve.</p>
</div>
<div id="additional-information" class="section level4 hasAnchor" number="5.5.2.4">
<h4><span class="header-section-number">5.5.2.4</span> Additional information<a href="othervignettes.html#additional-information" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>There is a more detailed R Vignette on the use of the PEcAn photosynthesis module available in the <a href="https://github.com/PecanProject/pecan/blob/master/modules/photosynthesis/vignettes/ResponseCurves.Rmd">PEcAn Repository</a>.</p>
</div>
<div id="citations" class="section level4 hasAnchor" number="5.5.2.5">
<h4><span class="header-section-number">5.5.2.5</span> Citations<a href="othervignettes.html#citations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Dietze, M.C. (2014). Gaps in knowledge and data driving uncertainty in models of photosynthesis. Photosynth. Res., 19, 3–14.</p>
<p>Farquhar, G., Caemmerer, S. &amp; Berry, J.A. (1980). A biochemical model of photosynthetic CO2 assimilation in leaves of C3 species. Planta, 149, 78–90.</p>
<p>Feng, X. &amp; Dietze, M.C. (2013). Scale dependence in the effects of leaf ecophysiological traits on photosynthesis: Bayesian parameterization of photosynthesis models. New Phytol., 200, 1132–1144.</p>

</div>
</div>
<div id="parameter-data-assimilation" class="section level3 hasAnchor" number="5.5.3">
<h3><span class="header-section-number">5.5.3</span> Parameter Data Assimilation<a href="othervignettes.html#parameter-data-assimilation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="objectives" class="section level4 hasAnchor" number="5.5.3.1">
<h4><span class="header-section-number">5.5.3.1</span> Objectives<a href="othervignettes.html#objectives" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Gain hands-on experience in using Bayesian MCMC techniques to calibrate a simple ecosystem model using parameter data assimilation (PDA)</li>
<li>Set up and run a PDA in PEcAn using model emulation technique, assimilating NEE data from Niwot Ridge</li>
<li>Examine outputs from a PDA for the SIPNET model and evaluation of the calibrated model against i) data used to constrain model, ii) additional data for the same site</li>
</ul>
</div>
<div id="larger-context" class="section level4 hasAnchor" number="5.5.3.2">
<h4><span class="header-section-number">5.5.3.2</span> Larger Context<a href="othervignettes.html#larger-context" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Parameter data assimilation (PDA) occurs as one step in the larger process of model calibration, validation, and application. The goal of PDA is to update our estimates of the posterior distributions of the model parameters using data that correspond to model outputs. This differs from our previous use of PEcAn to constrain a simple model using data that map directly to the model parameters. Briefly, the recommended overall approach for model calibration and validation consists of the following steps:</p>
<ol style="list-style-type: decimal">
<li>Assemble and process data sets required by the model as drivers</li>
<li>Perform an initial test-run of the model as a basic sanity check</li>
</ol>
<ul>
<li>Were there errors in drivers? (return to 1)</li>
<li>Is the model in the same ballpark as the data?</li>
</ul>
<ol start="3" style="list-style-type: decimal">
<li>Construct priors for model parameters</li>
<li>Collect/assemble the data that can be used to constrain model parameters and outputs</li>
<li>Meta-analysis</li>
<li>Sensitivity analysis (SA)</li>
<li>Variance Decomposition (VD)</li>
<li>Determine what parameters need further constraint</li>
</ol>
<ul>
<li>Does this data exist in the literature? (repeat 4-8)</li>
<li>Can I collect this data in the field? (repeat 4-8)</li>
</ul>
<ol start="9" style="list-style-type: decimal">
<li>Ensemble Analysis</li>
</ol>
<ul>
<li>Is reality within the range of the uncertainty in the model?</li>
</ul>
<ol start="10" style="list-style-type: decimal">
<li>Evaluate/estimate uncertainties in the data</li>
<li>Parameter Data Assimilation:</li>
</ol>
<ul>
<li>Propose new parameter values</li>
<li>Evaluate L(data | param) &amp; prior(param)</li>
<li>Accept or reject the proposed parameter values</li>
<li>Repeat many times until a histogram of accepted parameter values approximates the true posterior distribution.<br />
</li>
</ul>
<ol start="12" style="list-style-type: decimal">
<li>Model evaluation [preferably ensemble based]</li>
</ol>
<ul>
<li>Against data used to constrain model</li>
<li>Against additional data for this site
<ul>
<li>Same variable, different time</li>
<li>Different variables</li>
</ul></li>
<li>Against data at a new site</li>
<li>Do I need more data? Repeat 4-9 (direct data constraint) or 6-11 (parameter data assimilation).</li>
</ul>
<ol start="13" style="list-style-type: decimal">
<li>Application [preferably ensemble forecast or hindcast]</li>
</ol>
</div>
<div id="connect-to-rstudio" class="section level4 hasAnchor" number="5.5.3.3">
<h4><span class="header-section-number">5.5.3.3</span> Connect to Rstudio<a href="othervignettes.html#connect-to-rstudio" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Today, we’re again going to work mostly in Rstudio, in order to easily edit advanced PEcAn settings and browse files. So if you haven’t already, connect now to the Rstudio server on your VM ([URL]/rstudio).</p>
<p>This tutorial assumes you have successfully completed an ensemble and a sensitivity analysis (Demo 2) before.</p>
</div>
<div id="defining-variables" class="section level4 hasAnchor" number="5.5.3.4">
<h4><span class="header-section-number">5.5.3.4</span> Defining variables<a href="othervignettes.html#defining-variables" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The following variables need to be set specific to the site being run and the workflow being run</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="othervignettes.html#cb38-1" aria-hidden="true" tabindex="-1"></a>workflow_id <span class="ot">&lt;-</span> <span class="dv">99000000002</span>  <span class="do">## comes from the History table, your successful ensemble run&#39;s workflow ID</span></span>
<span id="cb38-2"><a href="othervignettes.html#cb38-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-3"><a href="othervignettes.html#cb38-3" aria-hidden="true" tabindex="-1"></a><span class="do">## from URL/bety/inputs.  </span></span>
<span id="cb38-4"><a href="othervignettes.html#cb38-4" aria-hidden="true" tabindex="-1"></a><span class="do">##   Search by Ameriflux ID (e.g. US-NR1)</span></span>
<span id="cb38-5"><a href="othervignettes.html#cb38-5" aria-hidden="true" tabindex="-1"></a><span class="do">##   Find the &quot;plain&quot; site record (no CF or model name) that&#39;s on your server</span></span>
<span id="cb38-6"><a href="othervignettes.html#cb38-6" aria-hidden="true" tabindex="-1"></a><span class="do">##    (probably last in the list)</span></span>
<span id="cb38-7"><a href="othervignettes.html#cb38-7" aria-hidden="true" tabindex="-1"></a><span class="do">##   Click on the magnifying glass icon then look under &quot;View Related Files&quot;</span></span>
<span id="cb38-8"><a href="othervignettes.html#cb38-8" aria-hidden="true" tabindex="-1"></a>datadir     <span class="ot">&lt;-</span> <span class="st">&quot;/home/carya/output/dbfiles/AmerifluxLBL_site_0-772/&quot;</span></span>
<span id="cb38-9"><a href="othervignettes.html#cb38-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-10"><a href="othervignettes.html#cb38-10" aria-hidden="true" tabindex="-1"></a><span class="do">## where PEcAn is saving output (default OK on VM)</span></span>
<span id="cb38-11"><a href="othervignettes.html#cb38-11" aria-hidden="true" tabindex="-1"></a>outdir      <span class="ot">&lt;-</span> <span class="st">&quot;/home/carya/output/&quot;</span></span></code></pre></div>
</div>
<div id="initial-ensemble-analysis" class="section level4 hasAnchor" number="5.5.3.5">
<h4><span class="header-section-number">5.5.3.5</span> Initial Ensemble Analysis<a href="othervignettes.html#initial-ensemble-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>A good place to start when thinking about a new PDA analysis is to look at the current model fit to observed data. In fact, we want to compare data to a full ensemble prediction from the model. This is important because our current parameter distributions will be the priors for PDA. While the analysis will translate these priors into more optimal (in terms of producing model output that matches observations) and more confident (i.e. narrower) posterior distributions, these results are inherently constrained by the current parameter distributions. Thus, if reality falls far outside the prior ensemble confidence interval (which reflects the current uncertainty of all model parameters), data assimilation will not be able to fix this. In such cases, the prior parameter estimates must already be over-constrained, or there are structural errors in the model itself that need fixing.
To begin, let’s load up some NEE observations so that we can plot them along with our ensemble predictions. In the code below the elements in bold may vary depending on site and your previous runs.</p>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="othervignettes.html#cb39-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(PEcAn.all)</span>
<span id="cb39-2"><a href="othervignettes.html#cb39-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-3"><a href="othervignettes.html#cb39-3" aria-hidden="true" tabindex="-1"></a><span class="co"># read settings</span></span>
<span id="cb39-4"><a href="othervignettes.html#cb39-4" aria-hidden="true" tabindex="-1"></a>settings <span class="ot">&lt;-</span> <span class="fu">read.settings</span>(<span class="fu">file.path</span>(outdir,<span class="fu">paste0</span>(<span class="st">&quot;PEcAn_&quot;</span>,workflow_id),<span class="st">&quot;pecan.CONFIGS.xml&quot;</span>))</span>
<span id="cb39-5"><a href="othervignettes.html#cb39-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-6"><a href="othervignettes.html#cb39-6" aria-hidden="true" tabindex="-1"></a><span class="co"># open up a DB connection</span></span>
<span id="cb39-7"><a href="othervignettes.html#cb39-7" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> PEcAn.DB<span class="sc">::</span><span class="fu">db.open</span>(settings<span class="sc">$</span>database<span class="sc">$</span>bety)</span>
<span id="cb39-8"><a href="othervignettes.html#cb39-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-9"><a href="othervignettes.html#cb39-9" aria-hidden="true" tabindex="-1"></a><span class="co"># Fill out the arguments needed by load_data function</span></span>
<span id="cb39-10"><a href="othervignettes.html#cb39-10" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-11"><a href="othervignettes.html#cb39-11" aria-hidden="true" tabindex="-1"></a><span class="co"># read file format information</span></span>
<span id="cb39-12"><a href="othervignettes.html#cb39-12" aria-hidden="true" tabindex="-1"></a>format     <span class="ot">&lt;-</span> PEcAn.DB<span class="sc">::</span><span class="fu">query.format.vars</span>(<span class="at">bety =</span> con, <span class="at">format.id =</span> <span class="dv">5000000002</span>)</span>
<span id="cb39-13"><a href="othervignettes.html#cb39-13" aria-hidden="true" tabindex="-1"></a>start_year <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(settings<span class="sc">$</span>run<span class="sc">$</span>start.date)</span>
<span id="cb39-14"><a href="othervignettes.html#cb39-14" aria-hidden="true" tabindex="-1"></a>end_year   <span class="ot">&lt;-</span> lubridate<span class="sc">::</span><span class="fu">year</span>(settings<span class="sc">$</span>run<span class="sc">$</span>end.date)</span>
<span id="cb39-15"><a href="othervignettes.html#cb39-15" aria-hidden="true" tabindex="-1"></a>vars.used.index <span class="ot">&lt;-</span> <span class="fu">which</span>(format<span class="sc">$</span>vars<span class="sc">$</span>bety_name <span class="sc">%in%</span> <span class="fu">c</span>(<span class="st">&quot;NEE&quot;</span>, <span class="st">&quot;UST&quot;</span>))</span>
<span id="cb39-16"><a href="othervignettes.html#cb39-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-17"><a href="othervignettes.html#cb39-17" aria-hidden="true" tabindex="-1"></a>obs <span class="ot">&lt;-</span>PEcAn.benchmark<span class="sc">::</span><span class="fu">load_data</span>(<span class="at">data.path =</span> <span class="fu">file.path</span>(datadir, <span class="st">&quot;AMF_US-NR1_BASE_HH_9-1.csv&quot;</span>),</span>
<span id="cb39-18"><a href="othervignettes.html#cb39-18" aria-hidden="true" tabindex="-1"></a>                                 <span class="at">format =</span> format, <span class="at">start_year =</span> start_year,  <span class="at">end_year =</span> end_year,</span>
<span id="cb39-19"><a href="othervignettes.html#cb39-19" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">site =</span> settings<span class="sc">$</span>run<span class="sc">$</span>site,</span>
<span id="cb39-20"><a href="othervignettes.html#cb39-20" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">vars.used.index =</span> vars.used.index,</span>
<span id="cb39-21"><a href="othervignettes.html#cb39-21" aria-hidden="true" tabindex="-1"></a>                                  <span class="at">time.row =</span> format<span class="sc">$</span>time.row)</span>
<span id="cb39-22"><a href="othervignettes.html#cb39-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-23"><a href="othervignettes.html#cb39-23" aria-hidden="true" tabindex="-1"></a>obs<span class="sc">$</span>NEE[obs<span class="sc">$</span>UST<span class="sc">&lt;</span><span class="fl">0.4</span>] <span class="ot">&lt;-</span> <span class="cn">NA</span>  <span class="do">## U* filter</span></span>
<span id="cb39-24"><a href="othervignettes.html#cb39-24" aria-hidden="true" tabindex="-1"></a>NEEo <span class="ot">&lt;-</span> obs<span class="sc">$</span>NEE</span></code></pre></div>
<p>Now let’s load up our ensemble outputs from the previous ensemble analysis (Demo 2) and plot our ensemble predictions against our NEE observations.</p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="othervignettes.html#cb40-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load outputs, try not to delete prePDA ensemble output filename from your environment</span></span>
<span id="cb40-2"><a href="othervignettes.html#cb40-2" aria-hidden="true" tabindex="-1"></a>prePDA_ensemble_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(outdir,<span class="fu">paste0</span>(<span class="st">&quot;PEcAn_&quot;</span>,workflow_id, <span class="st">&quot;/ensemble.ts.&quot;</span>, settings<span class="sc">$</span>ensemble<span class="sc">$</span>ensemble.id, <span class="st">&quot;.NEE.2003.2006.Rdata&quot;</span>))</span>
<span id="cb40-3"><a href="othervignettes.html#cb40-3" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(prePDA_ensemble_output_file)</span>
<span id="cb40-4"><a href="othervignettes.html#cb40-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-5"><a href="othervignettes.html#cb40-5" aria-hidden="true" tabindex="-1"></a><span class="co"># calculate CI</span></span>
<span id="cb40-6"><a href="othervignettes.html#cb40-6" aria-hidden="true" tabindex="-1"></a>pre_pda_ens <span class="ot">&lt;-</span> ensemble.ts[[<span class="st">&quot;NEE&quot;</span>]]</span>
<span id="cb40-7"><a href="othervignettes.html#cb40-7" aria-hidden="true" tabindex="-1"></a>preCI <span class="ot">&lt;-</span> <span class="fu">apply</span>(pre_pda_ens, <span class="dv">2</span>, quantile, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb40-8"><a href="othervignettes.html#cb40-8" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-9"><a href="othervignettes.html#cb40-9" aria-hidden="true" tabindex="-1"></a><span class="co"># plot model ensemble</span></span>
<span id="cb40-10"><a href="othervignettes.html#cb40-10" aria-hidden="true" tabindex="-1"></a>ymin <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">min</span>(<span class="fu">c</span>(preCI, NEEo), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb40-11"><a href="othervignettes.html#cb40-11" aria-hidden="true" tabindex="-1"></a>ymax <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">max</span>(<span class="fu">c</span>(preCI, NEEo), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb40-12"><a href="othervignettes.html#cb40-12" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(preCI[<span class="dv">2</span>,], <span class="at">ylim =</span> <span class="fu">c</span>(ymin, ymax), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&quot;time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;NEE&quot;</span>, <span class="at">main =</span> <span class="st">&quot;pre-PDA model ensemble vs data&quot;</span>, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb40-13"><a href="othervignettes.html#cb40-13" aria-hidden="true" tabindex="-1"></a>prepoly <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(preCI)[<span class="dv">2</span>]</span>
<span id="cb40-14"><a href="othervignettes.html#cb40-14" aria-hidden="true" tabindex="-1"></a><span class="fu">polygon</span>(<span class="fu">c</span>(prepoly, <span class="fu">rev</span>(prepoly)), <span class="fu">c</span>(preCI[<span class="dv">3</span>,], <span class="fu">rev</span>(preCI[<span class="dv">1</span>,])), <span class="at">col=</span><span class="st">&#39;khaki&#39;</span>, <span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb40-15"><a href="othervignettes.html#cb40-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb40-16"><a href="othervignettes.html#cb40-16" aria-hidden="true" tabindex="-1"></a><span class="co"># add data</span></span>
<span id="cb40-17"><a href="othervignettes.html#cb40-17" aria-hidden="true" tabindex="-1"></a><span class="fu">points</span>(NEEo, <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>, <span class="at">col=</span> <span class="fu">adjustcolor</span>(<span class="st">&quot;purple&quot;</span>,<span class="at">alpha.f=</span><span class="fl">0.5</span>))</span>
<span id="cb40-18"><a href="othervignettes.html#cb40-18" aria-hidden="true" tabindex="-1"></a><span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Data&quot;</span>,<span class="st">&quot;Pre-PDA Model&quot;</span>), <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">15</span>),</span>
<span id="cb40-19"><a href="othervignettes.html#cb40-19" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;khaki&quot;</span>))</span></code></pre></div>
<p>When interpreting your results it is important to remember the difference between a confidence interval, which just includes parameter uncertainties, and a predictive interval, which includes parameter and residual uncertainties. Your ensemble analysis plot illustrates the former—i.e., the confidence in the mean NEE. By contrast, the data reflect both changes in mean NEE, and random variability. As such, we can’t expect all the data to fall within the CI; in fact, if we had unlimited data to constrain mean NEE, the CI would collapse to a single line and none of the data would be contained! However, your plot will give you an idea of how much uncertainty there is in your model currently, and help to identify systematic errors like bias (values consistently too high or low) or poorly represented seasonal patterns.</p>
</div>
<div id="questions" class="section level4 hasAnchor" number="5.5.3.6">
<h4><span class="header-section-number">5.5.3.6</span> Questions:<a href="othervignettes.html#questions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Does your ensemble agree well with the data?</li>
<li>If so, how much room for improvement is there, in terms of tightening the CI?</li>
<li>If not, what are the greatest discrepancies?</li>
<li>What are some of the problems (with model, data, and/or PEcAn) that might explain the data-model disparity you see?</li>
</ul>
</div>
<div id="choosing-parameters" class="section level4 hasAnchor" number="5.5.3.7">
<h4><span class="header-section-number">5.5.3.7</span> Choosing Parameters<a href="othervignettes.html#choosing-parameters" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Beyond exploratory exercises, the first step of PDA analysis is to choose the model parameters you will target for optimization. PDA is computationally expensive (even when using an emulator), and the cost increases exponentially with the number of parameters targeted. The number you can handle in any given analysis completely depends on the complexity of the model and your available computational resources, but in practice it’s going to be rather small (~1–10) relative to the large number of parameters in a mechanistic ecosystem model (~10–100).
Given this limitation, it is important to target parameters that can contribute substantially to improving model fit. If you recall, identifying those parameters was the goal of the uncertainty analysis you conducted previously, in the second PEcAn demo. Let’s revisit that analysis now. Open your variance decomposition graph from Demo 2
From this figure decide which variables you will target with PDA. As noted, an obvious criterion is that the parameter should be contributing a large amount of uncertainty to the current model, because otherwise it simply can’t change the model output much no matter how much you try to optimize it. But there are other considerations too. For example, if two parameters have similar or competing roles in the model, you may have trouble optimizing both simultaneously. In practice, there will likely be some guess-and-testing involved, though a good understanding of how the model works will help. It may also help to look at the shape of the Sensitivity responses and details of model fit to data (your ensemble analysis from the previous section).
For the purposes of this demo, choose eight to ten parameters (in total, if you have more than one PFT) that contribute high uncertainty to model output and/or seem like good choices for some other rational reason.</p>
</div>
<div id="questions-1" class="section level4 hasAnchor" number="5.5.3.8">
<h4><span class="header-section-number">5.5.3.8</span> Questions:<a href="othervignettes.html#questions-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Which parameters did you choose, and why?</li>
</ul>
</div>
<div id="editing-pecan-settings" class="section level4 hasAnchor" number="5.5.3.9">
<h4><span class="header-section-number">5.5.3.9</span> Editing PEcAn settings<a href="othervignettes.html#editing-pecan-settings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now let’s add settings to tell PEcAn how to run the PDA with emulator, we will come to the details of model emulation later. Open up the pecan.CONFIGS.xml file you located previously, and choose <code>File &gt; Save as...</code> from the menu to save a new copy as <strong>pecan.PDA.xml</strong>. Now add the block of XML listed below to the file, immediately after the <pecan> line. Check and fill in the parts corresponding to your run when necessary.
In this block, use the <code>&lt;param.names&gt;&lt;param&gt;</code> tags to identify the parameters you’ve chosen for PDA (it’s up to you to choose the number of parameters you want to constrain, then you can set the <code>&lt;n.knot&gt;</code> to be &gt;= 10 per parameter you choose, e.g. 200 knots for 10 parameters). Here, you need to use PEcAn’s standard parameter names, which are generally not the same as what’s printed on your variance decomposition graph. To find your parameters look at the row names in the <code>prior.distns.csv</code> file for each PFT under the PFT pulldown menu. Insert the variable name (exactly, and case sensitive) into the <code>&lt;param&gt;</code> tags of the XML code below.
In addition, you may need to edit <code>&lt;inputs&gt;&lt;file&gt;&lt;path&gt;</code>, depending on the site and year you ran previously. The rest of the settings control options for the PDA analysis (how long to run, etc.), and also identify the data to be used for assimilation. For more details, see the assim.batch vignette on the PEcAn GitHub page (<a href="https://goo.gl/9hYVPQ" class="uri">https://goo.gl/9hYVPQ</a>).</p>
<pre><code>&lt;?xml version=&quot;1.0&quot;?&gt;    &lt;-- These lines are already in there. Don&#39;t duplicate them,   
&lt;pecan&gt;                  &lt;-- just paste the &lt;assim.batch&gt; block below right after them.
  &lt;assim.batch&gt;
    &lt;method&gt;emulator&lt;/method&gt;
    &lt;n.knot&gt;160&lt;/n.knot&gt;                         &lt;-- FILL IN
    &lt;iter&gt;25000&lt;/iter&gt;
    &lt;chain&gt;3&lt;/chain&gt;
    &lt;param.names&gt;
      &lt;soil&gt;
        &lt;param&gt;YOUR_PFT_1_PARAM_1&lt;/param&gt;        &lt;-- FILL IN
        &lt;param&gt;YOUR_PFT_1_PARAM_2&lt;/param&gt;        &lt;-- FILL IN
      &lt;/soil&gt;
       &lt;temperate.coniferous&gt;                                      
         &lt;param&gt;YOUR_PFT_2_PARAM_1&lt;/param&gt;       &lt;-- FILL IN
         &lt;param&gt;YOUR_PFT_2_PARAM_2&lt;/param&gt;       &lt;-- FILL IN
         &lt;param&gt;YOUR_PFT_2_PARAM_3&lt;/param&gt;       &lt;-- FILL IN
         &lt;param&gt;YOUR_PFT_2_PARAM_4&lt;/param&gt;       &lt;-- FILL IN
         &lt;param&gt;YOUR_PFT_2_PARAM_5&lt;/param&gt;       &lt;-- FILL IN
         &lt;param&gt;YOUR_PFT_2_PARAM_6&lt;/param&gt;       &lt;-- FILL IN
       &lt;/temperate.coniferous&gt;
    &lt;/param.names&gt;
    &lt;jump&gt;
        &lt;adapt&gt;100&lt;/adapt&gt;
        &lt;adj.min&gt;0.1&lt;/adj.min&gt;
        &lt;ar.target&gt;0.3&lt;/ar.target&gt;
    &lt;/jump&gt;
    &lt;inputs&gt;
     &lt;file&gt;
      &lt;path&gt;
         &lt;path&gt;/home/carya/output/dbfiles/AmerifluxLBL_site_0-772/AMF_US-NR1_BASE_HH_9-1.csv&lt;/path&gt;       
      &lt;/path&gt;
      &lt;format&gt;5000000002&lt;/format&gt;
      &lt;input.id&gt;1000011238&lt;/input.id&gt;        &lt;-- FILL IN, from BETY inputs table, this is *NOT* the workflow ID
      &lt;likelihood&gt;Laplace&lt;/likelihood&gt;
      &lt;variable.name&gt;
        &lt;variable.name&gt;NEE&lt;/variable.name&gt;
        &lt;variable.name&gt;UST&lt;/variable.name&gt;
      &lt;/variable.name&gt;
      &lt;variable.id&gt;297&lt;/variable.id&gt;
     &lt;/file&gt;
    &lt;/inputs&gt;
  &lt;/assim.batch&gt;</code></pre>
<p>Once you’ve made and saved the changes to your XML, load the file and check that it contains the new settings:</p>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="othervignettes.html#cb42-1" aria-hidden="true" tabindex="-1"></a>settings <span class="ot">&lt;-</span> <span class="fu">read.settings</span>(<span class="fu">file.path</span>(outdir,<span class="fu">paste0</span>(<span class="st">&quot;PEcAn_&quot;</span>,workflow_id),<span class="st">&quot;pecan.PDA.xml&quot;</span>))</span>
<span id="cb42-2"><a href="othervignettes.html#cb42-2" aria-hidden="true" tabindex="-1"></a>settings<span class="sc">$</span>assim.batch</span></code></pre></div>
<p>If the printed list contains everything you just added to pecan.PDA.xml, you’re ready to proceed.</p>
</div>
<div id="investigating-pecan-function-pda.emulator-optional" class="section level4 hasAnchor" number="5.5.3.10">
<h4><span class="header-section-number">5.5.3.10</span> Investigating PEcAn function pda.emulator (optional)<a href="othervignettes.html#investigating-pecan-function-pda.emulator-optional" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Before we run the data assimilation, let’s take a high-level look at the organization of the code. Use the Rstudio file browser to open up <code>~/pecan/modules/assim.batch/R/pda.emulator.R.</code> This code works in much the same way as the pure statistical models that we learned about earlier in the week, except that the model being fit is a statistical model that emulates a complicated process-based computer simulation (i.e., an ecosystem model). We could have directly used the ecosystem model (indeed PEcAn’s other PDA functions perform MCMC by actually running the ecosystem model at each iteration, see pda.mcmc.R script as an example), however, this would require a lot more computational time than we have today. Instead here we will use a technique called model emulation. This technique allows us to run the model for a relatively smaller number of times with parameter values that have been carefully chosen to give a good coverage of parameter space. Then we can interpolate the likelihood calculated for each of those runs to get a surface that “emulates” the true likelihood and perform regular MCMC, except instead of actually running the model on every iteration to get a likelihood, this time we will just get an approximation from the likelihood emulator. The general algorithm of this method can be further expressed as:</p>
<ol style="list-style-type: decimal">
<li>Propose initial parameter set sampling design</li>
<li>Run full model for each parameter set</li>
<li>Evaluate the likelihoods</li>
<li>Construct emulator of multivariate likelihood surface</li>
<li>Use emulator to estimate posterior parameter distributions</li>
<li>(Optional) Refine emulator by proposing new design points, goto 2)</li>
</ol>
<p>For now, we just want you to get a glimpse at the overall structure of the code, which is laid out in the comment headers in <code>pda.emulator()</code>. Most of the real work gets done by the functions this code calls, which are all located in the file <code>~/pecan/modules/assim.batch/R/pda.utils.R</code> and the MCMC will be performed by the <code>mcmc.GP()</code> function in <code>~/pecan/modules/emulator/R/minimize.GP.R</code>. To delve deeper into how the code works, take a look at these files when you have the time.</p>
</div>
<div id="running-a-demo-pda" class="section level4 hasAnchor" number="5.5.3.11">
<h4><span class="header-section-number">5.5.3.11</span> Running a demo PDA<a href="othervignettes.html#running-a-demo-pda" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now we can go ahead and run a data assimilation MCMC with emulator. Since you’ve already loaded the settings containing your modified &lt;assim.batch&gt; XML block, all you need to do to start the PDA is run <code>pda.emulator(settings)</code>. But, in the emulator workflow, there is a bit of a time consuming step where we calculate the effective sample size of the input data, and we have already done this step for you. You could load it up and pass it to the function explicitly in order to skip this step:</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="othervignettes.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="co"># load input data</span></span>
<span id="cb43-2"><a href="othervignettes.html#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="st">&quot;/home/carya/pda/pda_externals.Rdata&quot;</span>)</span>
<span id="cb43-3"><a href="othervignettes.html#cb43-3" aria-hidden="true" tabindex="-1"></a>postPDA.settings <span class="ot">&lt;-</span> <span class="fu">pda.emulator</span>(settings, <span class="at">external.data =</span> inputs_w_neff)</span></code></pre></div>
<p>After executing the code above, you will see print-outs to the console. The code begins with loading the prior values which in this case are the posterior distributions coming from your previous meta analysis. Then, normally, it loads the observational data and carries out necessary conversions and formatting to align it with model outputs, as we did separately above, but today it will skip this step as we are passing data externally. After this step, you will see a progress bar where the actual model is run n.knot times with the proposed parameter sets and then the outputs from these runs are read. Next, this model output is compared to the specified observational data, and the likelihood is calculated using the heteroskedastic Laplacian discussed previously. Once we calculate the likelihoods, we fit an emulator which interpolates the model output in parameter space between the points where the model has actually been run. Now we can put this emulator in the MCMC algorithm instead of the model itself. Within the MCMC loop the code proposes new parameter value from a multivariate normal jump distribution. The corresponding likelihood will be approximated by the emulator and the new parameter value is accepted or rejected based on its posterior probability relative to the current value.</p>
</div>
<div id="outputs-from-pecans-parameter-data-assimilation" class="section level4 hasAnchor" number="5.5.3.12">
<h4><span class="header-section-number">5.5.3.12</span> Outputs from PEcAn’s Parameter Data Assimilation<a href="othervignettes.html#outputs-from-pecans-parameter-data-assimilation" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>When the PDA is finished, a number of outputs are automatically produced that are either the same as or similar to posterior outputs that we’ve seen before. These are located in the <code>PEcAn_[workflow_id]/pft/*</code> output directory and are identified by <code>pda.[PFT]_[workflow_id]</code> in the filenames:</p>
<ul>
<li>posteriors.pda.[PFT]*.pdf shows the posterior distributions resulting from your PDA</li>
<li>trait.mcmc.pda.[PFT]*.Rdata contains all the parameter samples contained in the PDA posterior</li>
<li>mcmc.pda.[PFT]*.Rdata is essentially the same thing in a different format</li>
<li>mcmc.diagnostics.pda.[PFT]*.pdf shows trace plots and posterior densities for each assimilated parameter, as well as pairs plots showing all pairwise parameter correlations.</li>
</ul>
<p>Together, these files allow you to evaluate whether a completed PDA analysis has converged and how the posterior distributions compare to the priors, and to use the posterior samples in further analyses, including additional PDA.
If you haven’t done so already, take a look at all of the outputs described here.</p>
</div>
<div id="questions-2" class="section level4 hasAnchor" number="5.5.3.13">
<h4><span class="header-section-number">5.5.3.13</span> Questions:<a href="othervignettes.html#questions-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Do the diagnostic figures indicate that your likelihood at least improved over the course of the analysis?</li>
<li>Does the MCMC appear to have converged?</li>
<li>Are the posterior distributions well resolved?</li>
</ul>
</div>
<div id="post-pda-analyses" class="section level4 hasAnchor" number="5.5.3.14">
<h4><span class="header-section-number">5.5.3.14</span> Post-PDA analyses<a href="othervignettes.html#post-pda-analyses" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In addition to the outputs of the PDA itself, you may want to conduct ensemble and/or sensitivity analyses based on the posteriors of the data assimilation, in order to check progress towards improved model fit and/or changing sensitivity. For this, you need to generate new model runs based on parameters sampled from the updated (by PDA) posterior, which is a simple matter of rerunning several steps of the PEcAn workflow.
The PDA you ran has automatically produced an updated XML file (<code>pecan.pda***.xml</code>) that includes the posterior id to be used in the next round of runs. Locate this file in your run directory and load the file for the post-pda ensemble/sensitivity analysis (if you already have the <code>settings</code> list in your working environment you don’t need to re-read the settings):</p>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="othervignettes.html#cb44-1" aria-hidden="true" tabindex="-1"></a> <span class="co"># read post-PDA settings if you don&#39;t have them in your wotking environment</span></span>
<span id="cb44-2"><a href="othervignettes.html#cb44-2" aria-hidden="true" tabindex="-1"></a> <span class="co"># replace the *** with the ensemble id given by the workflow</span></span>
<span id="cb44-3"><a href="othervignettes.html#cb44-3" aria-hidden="true" tabindex="-1"></a> <span class="co"># postPDA.settings &lt;- read.settings(file.path(outdir,paste0(&quot;PEcAn_&quot;, workflow_id),&quot;pecan.pda***.xml&quot;))</span></span>
<span id="cb44-4"><a href="othervignettes.html#cb44-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-5"><a href="othervignettes.html#cb44-5" aria-hidden="true" tabindex="-1"></a> <span class="co"># Call model specific write.configs</span></span>
<span id="cb44-6"><a href="othervignettes.html#cb44-6" aria-hidden="true" tabindex="-1"></a>  postPDA.settings <span class="ot">&lt;-</span> <span class="fu">run.write.configs</span>(postPDA.settings,</span>
<span id="cb44-7"><a href="othervignettes.html#cb44-7" aria-hidden="true" tabindex="-1"></a>                          <span class="at">write=</span>postPDA.settings<span class="sc">$</span>database<span class="sc">$</span>bety<span class="sc">$</span>write,     </span>
<span id="cb44-8"><a href="othervignettes.html#cb44-8" aria-hidden="true" tabindex="-1"></a>                          <span class="at">ens.sample.method=</span>postPDA.settings<span class="sc">$</span>ensemble<span class="sc">$</span>method)</span>
<span id="cb44-9"><a href="othervignettes.html#cb44-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-10"><a href="othervignettes.html#cb44-10" aria-hidden="true" tabindex="-1"></a> <span class="co"># Let&#39;s save the settings with the new ensemble id</span></span>
<span id="cb44-11"><a href="othervignettes.html#cb44-11" aria-hidden="true" tabindex="-1"></a>  PEcAn.settings<span class="sc">::</span><span class="fu">write.settings</span>(settings, <span class="at">outputfile=</span><span class="fu">paste0</span>(<span class="st">&#39;pecan.pda&#39;</span>, postPDA.settings<span class="sc">$</span>assim.batch<span class="sc">$</span>ensemble.id,<span class="st">&#39;.xml&#39;</span>))</span>
<span id="cb44-12"><a href="othervignettes.html#cb44-12" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-13"><a href="othervignettes.html#cb44-13" aria-hidden="true" tabindex="-1"></a> <span class="co"># Start ecosystem model runs, this one takes awhile...</span></span>
<span id="cb44-14"><a href="othervignettes.html#cb44-14" aria-hidden="true" tabindex="-1"></a>  PEcAn.workflow<span class="sc">::</span><span class="fu">start_model_runs</span>(postPDA.settings, postPDA.settings<span class="sc">$</span>database<span class="sc">$</span>bety<span class="sc">$</span>write)</span>
<span id="cb44-15"><a href="othervignettes.html#cb44-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-16"><a href="othervignettes.html#cb44-16" aria-hidden="true" tabindex="-1"></a> <span class="co"># Get results of model runs</span></span>
<span id="cb44-17"><a href="othervignettes.html#cb44-17" aria-hidden="true" tabindex="-1"></a>  <span class="fu">get.results</span>(postPDA.settings)</span>
<span id="cb44-18"><a href="othervignettes.html#cb44-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-19"><a href="othervignettes.html#cb44-19" aria-hidden="true" tabindex="-1"></a> <span class="co"># Repeat ensemble analysis with PDA-constrained params</span></span>
<span id="cb44-20"><a href="othervignettes.html#cb44-20" aria-hidden="true" tabindex="-1"></a> <span class="fu">run.ensemble.analysis</span>(postPDA.settings, <span class="cn">TRUE</span>)</span>
<span id="cb44-21"><a href="othervignettes.html#cb44-21" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-22"><a href="othervignettes.html#cb44-22" aria-hidden="true" tabindex="-1"></a> <span class="co"># let&#39;s re-load the pre-PDA ensemble outputs</span></span>
<span id="cb44-23"><a href="othervignettes.html#cb44-23" aria-hidden="true" tabindex="-1"></a> <span class="fu">load</span>(prePDA_ensemble_output_file)</span>
<span id="cb44-24"><a href="othervignettes.html#cb44-24" aria-hidden="true" tabindex="-1"></a> pre_pda_ens <span class="ot">&lt;-</span> ensemble.ts[[<span class="st">&quot;NEE&quot;</span>]]</span>
<span id="cb44-25"><a href="othervignettes.html#cb44-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-26"><a href="othervignettes.html#cb44-26" aria-hidden="true" tabindex="-1"></a> <span class="co"># nowload the post-PDA ensemble outputs</span></span>
<span id="cb44-27"><a href="othervignettes.html#cb44-27" aria-hidden="true" tabindex="-1"></a> postPDA_ensemble_output_file <span class="ot">&lt;-</span> <span class="fu">file.path</span>(outdir,<span class="fu">paste0</span>(<span class="st">&quot;PEcAn_&quot;</span>, workflow_id, <span class="st">&quot;/ensemble.ts.&quot;</span>, postPDA.settings<span class="sc">$</span>ensemble<span class="sc">$</span>ensemble.id, <span class="st">&quot;.NEE.2003.2006.Rdata&quot;</span>))</span>
<span id="cb44-28"><a href="othervignettes.html#cb44-28" aria-hidden="true" tabindex="-1"></a> <span class="fu">load</span>(postPDA_ensemble_output_file)</span>
<span id="cb44-29"><a href="othervignettes.html#cb44-29" aria-hidden="true" tabindex="-1"></a> post_pda_ens <span class="ot">&lt;-</span> ensemble.ts[[<span class="st">&quot;NEE&quot;</span>]]</span>
<span id="cb44-30"><a href="othervignettes.html#cb44-30" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-31"><a href="othervignettes.html#cb44-31" aria-hidden="true" tabindex="-1"></a> <span class="co"># try changing the window value for daily, weekly, monthly smoothing later</span></span>
<span id="cb44-32"><a href="othervignettes.html#cb44-32" aria-hidden="true" tabindex="-1"></a> <span class="co"># see if this changes your model-data agreement, why?</span></span>
<span id="cb44-33"><a href="othervignettes.html#cb44-33" aria-hidden="true" tabindex="-1"></a> window <span class="ot">&lt;-</span> <span class="dv">1</span> <span class="co"># no smoothing</span></span>
<span id="cb44-34"><a href="othervignettes.html#cb44-34" aria-hidden="true" tabindex="-1"></a> pre_pda <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(pre_pda_ens, <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb44-35"><a href="othervignettes.html#cb44-35" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tapply</span>(x, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(x)<span class="sc">/</span>window <span class="sc">+</span> <span class="dv">1</span>), <span class="at">each =</span> window)[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)],</span>
<span id="cb44-36"><a href="othervignettes.html#cb44-36" aria-hidden="true" tabindex="-1"></a>               mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)}))</span>
<span id="cb44-37"><a href="othervignettes.html#cb44-37" aria-hidden="true" tabindex="-1"></a> post_pda <span class="ot">&lt;-</span> <span class="fu">t</span>(<span class="fu">apply</span>(post_pda_ens, <span class="dv">1</span>, <span class="cf">function</span>(x) {</span>
<span id="cb44-38"><a href="othervignettes.html#cb44-38" aria-hidden="true" tabindex="-1"></a>        <span class="fu">tapply</span>(x, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(x)<span class="sc">/</span>window <span class="sc">+</span> <span class="dv">1</span>), <span class="at">each =</span> window)[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(x)],</span>
<span id="cb44-39"><a href="othervignettes.html#cb44-39" aria-hidden="true" tabindex="-1"></a>               mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)}))</span>
<span id="cb44-40"><a href="othervignettes.html#cb44-40" aria-hidden="true" tabindex="-1"></a> fobs <span class="ot">&lt;-</span> <span class="fu">tapply</span>(NEEo, <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span>(<span class="fu">length</span>(NEEo) <span class="sc">/</span> window <span class="sc">+</span> <span class="dv">1</span>),</span>
<span id="cb44-41"><a href="othervignettes.html#cb44-41" aria-hidden="true" tabindex="-1"></a>                          <span class="at">each =</span> window)[<span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(NEEo)], mean, <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-42"><a href="othervignettes.html#cb44-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-43"><a href="othervignettes.html#cb44-43" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-44"><a href="othervignettes.html#cb44-44" aria-hidden="true" tabindex="-1"></a> <span class="co"># save the comparison plots to pdf</span></span>
<span id="cb44-45"><a href="othervignettes.html#cb44-45" aria-hidden="true" tabindex="-1"></a> <span class="fu">pdf</span>(<span class="fu">file.path</span>(outdir,<span class="fu">paste0</span>(<span class="st">&quot;PEcAn_&quot;</span>,workflow_id),<span class="st">&quot;model.data.comparison.pdf&quot;</span>), <span class="at">onefile=</span>T,</span>
<span id="cb44-46"><a href="othervignettes.html#cb44-46" aria-hidden="true" tabindex="-1"></a>     <span class="at">paper=</span><span class="st">&#39;A4r&#39;</span>, <span class="at">height=</span><span class="dv">15</span>, <span class="at">width=</span><span class="dv">20</span>)</span>
<span id="cb44-47"><a href="othervignettes.html#cb44-47" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-48"><a href="othervignettes.html#cb44-48" aria-hidden="true" tabindex="-1"></a> <span class="co"># now plot the pre-PDA ensemble similar to the way we did before</span></span>
<span id="cb44-49"><a href="othervignettes.html#cb44-49" aria-hidden="true" tabindex="-1"></a> preCI <span class="ot">&lt;-</span> <span class="fu">apply</span>(pre_pda, <span class="dv">2</span>, quantile, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-50"><a href="othervignettes.html#cb44-50" aria-hidden="true" tabindex="-1"></a> ymin <span class="ot">&lt;-</span> <span class="fu">min</span>(<span class="fu">min</span>(<span class="fu">c</span>(preCI, fobs), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb44-51"><a href="othervignettes.html#cb44-51" aria-hidden="true" tabindex="-1"></a> ymax <span class="ot">&lt;-</span> <span class="fu">max</span>(<span class="fu">max</span>(<span class="fu">c</span>(preCI, fobs), <span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb44-52"><a href="othervignettes.html#cb44-52" aria-hidden="true" tabindex="-1"></a> <span class="fu">plot</span>(pre_pda[<span class="dv">1</span>,], <span class="at">ylim =</span> <span class="fu">c</span>(ymin, ymax), <span class="at">lwd =</span> <span class="dv">2</span>, <span class="at">xlab =</span> <span class="st">&quot;time&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;NEE&quot;</span>, <span class="at">main =</span> <span class="st">&quot;pre-PDA vs post-PDA&quot;</span>, <span class="at">type =</span> <span class="st">&quot;n&quot;</span>)</span>
<span id="cb44-53"><a href="othervignettes.html#cb44-53" aria-hidden="true" tabindex="-1"></a> prepoly <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(preCI)[<span class="dv">2</span>]</span>
<span id="cb44-54"><a href="othervignettes.html#cb44-54" aria-hidden="true" tabindex="-1"></a> <span class="fu">polygon</span>(<span class="fu">c</span>(prepoly, <span class="fu">rev</span>(prepoly)),<span class="fu">c</span>(preCI[<span class="dv">3</span>,], <span class="fu">rev</span>(preCI[<span class="dv">1</span>,])),<span class="at">col=</span><span class="st">&#39;khaki&#39;</span>,<span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb44-55"><a href="othervignettes.html#cb44-55" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-56"><a href="othervignettes.html#cb44-56" aria-hidden="true" tabindex="-1"></a> <span class="co"># plot the post-PDA ensemble</span></span>
<span id="cb44-57"><a href="othervignettes.html#cb44-57" aria-hidden="true" tabindex="-1"></a> postCI <span class="ot">&lt;-</span> <span class="fu">apply</span>(post_pda, <span class="dv">2</span>, quantile, <span class="fu">c</span>(<span class="fl">0.025</span>, <span class="fl">0.5</span>, <span class="fl">0.975</span>), <span class="at">na.rm =</span> <span class="cn">TRUE</span>)</span>
<span id="cb44-58"><a href="othervignettes.html#cb44-58" aria-hidden="true" tabindex="-1"></a> postpoly <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">dim</span>(postCI)[<span class="dv">2</span>]</span>
<span id="cb44-59"><a href="othervignettes.html#cb44-59" aria-hidden="true" tabindex="-1"></a> <span class="fu">polygon</span>(<span class="fu">c</span>(postpoly, <span class="fu">rev</span>(postpoly)),<span class="fu">c</span>(postCI[<span class="dv">3</span>,], <span class="fu">rev</span>(postCI[<span class="dv">1</span>,])),<span class="at">col=</span><span class="st">&#39;lightblue&#39;</span>,<span class="at">border=</span><span class="cn">NA</span>)</span>
<span id="cb44-60"><a href="othervignettes.html#cb44-60" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-61"><a href="othervignettes.html#cb44-61" aria-hidden="true" tabindex="-1"></a> <span class="co"># finally let&#39;s add the data and see how we did</span></span>
<span id="cb44-62"><a href="othervignettes.html#cb44-62" aria-hidden="true" tabindex="-1"></a> <span class="fu">points</span>(fobs, <span class="at">pch =</span> <span class="st">&quot;.&quot;</span>, <span class="at">col=</span> <span class="fu">adjustcolor</span>(<span class="st">&quot;purple&quot;</span>,<span class="at">alpha.f=</span><span class="fl">0.7</span>))</span>
<span id="cb44-63"><a href="othervignettes.html#cb44-63" aria-hidden="true" tabindex="-1"></a> <span class="fu">legend</span>(<span class="st">&quot;topright&quot;</span>, <span class="at">legend=</span><span class="fu">c</span>(<span class="st">&quot;Data&quot;</span>,<span class="st">&quot;Pre-PDA Model&quot;</span>, <span class="st">&quot;Post-PDA Model&quot;</span>), <span class="at">pch=</span><span class="fu">c</span>(<span class="dv">15</span>,<span class="dv">15</span>,<span class="dv">15</span>),</span>
<span id="cb44-64"><a href="othervignettes.html#cb44-64" aria-hidden="true" tabindex="-1"></a>        <span class="at">col=</span><span class="fu">c</span>(<span class="st">&quot;purple&quot;</span>,<span class="st">&quot;khaki&quot;</span>,<span class="st">&quot;lightblue&quot;</span>))</span>
<span id="cb44-65"><a href="othervignettes.html#cb44-65" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-66"><a href="othervignettes.html#cb44-66" aria-hidden="true" tabindex="-1"></a> <span class="fu">dev.off</span>()</span>
<span id="cb44-67"><a href="othervignettes.html#cb44-67" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-68"><a href="othervignettes.html#cb44-68" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb44-69"><a href="othervignettes.html#cb44-69" aria-hidden="true" tabindex="-1"></a> <span class="co"># Repeat variance decomposition to see how constraints have changed</span></span>
<span id="cb44-70"><a href="othervignettes.html#cb44-70" aria-hidden="true" tabindex="-1"></a> <span class="fu">run.sensitivity.analysis</span>(postPDA.settings)</span></code></pre></div>
<p>Now you can check the new figures produced by your analyses under <code>PEcAn_[workflow_id]/pft/*/variance.decomposition.*.pdf</code> and <code>PEcAn_[workflow_id]/pft/*/sensitivity.analysis.*.pdf</code>, and compare them to the previous ones. Also, take a look at the comparison of model outputs to data when we run SIPNET with pre- and post-PDA parameter (mean) values under <code>PEcAn_[workflow_id]/model.data.comparison.pdf</code>.</p>
</div>
<div id="questions-3" class="section level4 hasAnchor" number="5.5.3.15">
<h4><span class="header-section-number">5.5.3.15</span> Questions:<a href="othervignettes.html#questions-3" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Looking at the ensemble analysis outputs in order (i.e., in order of increasing ID in the filenames), qualitatively how did the model fit to data change over the course of the analysis?</li>
<li>Based on the final ensemble analysis, what are the major remaining discrepancies between model and data?</li>
<li>Can you think of the processes / parameters that are likely contributing to the differences?</li>
<li>What would be your next steps towards evaluating or improving model performance?</li>
</ul>

</div>
</div>
<div id="state-variable-data-assimilation" class="section level3 hasAnchor" number="5.5.4">
<h3><span class="header-section-number">5.5.4</span> State-Variable Data Assimilation<a href="othervignettes.html#state-variable-data-assimilation" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="objectives-1" class="section level4 hasAnchor" number="5.5.4.1">
<h4><span class="header-section-number">5.5.4.1</span> Objectives:<a href="othervignettes.html#objectives-1" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Assimilate tree ring estimated NPP &amp; inventory AGB within the SIPNET model in order to:</li>
<li>Reconcile data and model NPP &amp; AGB estimates</li>
<li>Constrain inferences about other ecosystem responses.</li>
</ul>
</div>
<div id="overview" class="section level4 hasAnchor" number="5.5.4.2">
<h4><span class="header-section-number">5.5.4.2</span> Overview:<a href="othervignettes.html#overview" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li>Initial Run</li>
<li>Settings</li>
<li>Load and match plot and increment data</li>
<li>Estimate tree-level data uncertainties</li>
<li>Estimate allometric relationships</li>
<li>Estimate stand-level NPP</li>
<li>Sample initial conditions and parameters</li>
<li>Run Ensemble Kalman Filter</li>
</ul>
</div>
<div id="initial-run" class="section level4 hasAnchor" number="5.5.4.3">
<h4><span class="header-section-number">5.5.4.3</span> Initial Run<a href="othervignettes.html#initial-run" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Perform a site-level SIPNET run using the following settings</p>
<ul>
<li>Site = UNDERC</li>
<li>Start = 01/01/1979</li>
<li>End = 12/31/2015</li>
<li>Met = NARR</li>
<li>Check <strong>Brown Dog</strong></li>
<li>When the run is complete, open the pecan.xml and cut-and-paste the <strong>outdir</strong> for later use</li>
</ul>
</div>
<div id="settings" class="section level4 hasAnchor" number="5.5.4.4">
<h4><span class="header-section-number">5.5.4.4</span> Settings:<a href="othervignettes.html#settings" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>Open the PEcAn RStudio environment back up.</p></li>
<li><p>Set your working directory to the outdir from above <code>setwd(outdir)</code> and shift the file browser to that location (Files &gt; More &gt; Go To Working Directory)</p></li>
<li><p>Open up the latest settings file <code>pecan.CONFIG.xml</code>.</p></li>
<li><p>At the top of the file add the following tags to set the ensemble size</p></li>
</ul>
<pre><code>   &lt;state.data.assimilation&gt;
   &lt;n.ensemble&gt;35&lt;/n.ensemble&gt;
   &lt;process.variance&gt;FALSE&lt;/process.variance&gt;
   &lt;sample.parameters&gt;TRUE&lt;/sample.parameters&gt;
   &lt;data&gt;
    &lt;format_id&gt;1000000040&lt;/format_id&gt;
    &lt;input.id&gt;1000013298&lt;/input.id&gt;
  &lt;/data&gt;
   &lt;state.variables&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;NPP&lt;/variable.name&gt;
   &lt;unit&gt;MgC/ha/yr&lt;/unit&gt;
        &lt;min_value&gt;-9999&lt;/min_value&gt;
        &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;AbvGrndWood&lt;/variable.name&gt;
       &lt;unit&gt;KgC/m^2&lt;/unit&gt;
       &lt;min_value&gt;0&lt;/min_value&gt;
       &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;TotSoilCarb&lt;/variable.name&gt;
      &lt;unit&gt;KgC/m^2&lt;/unit&gt;
      &lt;min_value&gt;0&lt;/min_value&gt;
      &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;LeafC&lt;/variable.name&gt;
         &lt;unit&gt;m^2/m^2&lt;/unit&gt;
         &lt;min_value&gt;0&lt;/min_value&gt;
         &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;SoilMoistFrac&lt;/variable.name&gt;
         &lt;unit&gt;&lt;/unit&gt;
         &lt;min_value&gt;0&lt;/min_value&gt;
         &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;SWE&lt;/variable.name&gt;
         &lt;unit&gt;cm&lt;/unit&gt;
         &lt;min_value&gt;0&lt;/min_value&gt;
         &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;variable&gt;
   &lt;variable.name&gt;Litter&lt;/variable.name&gt;
         &lt;unit&gt;gC/m^2&lt;/unit&gt;
         &lt;min_value&gt;0&lt;/min_value&gt;
         &lt;max_value&gt;9999&lt;/max_value&gt;
   &lt;/variable&gt;
   &lt;/state.variables&gt;
   &lt;forecast.time.step&gt;year&lt;/forecast.time.step&gt;
  &lt;start.date&gt;1980/01/01&lt;/start.date&gt;
  &lt;end.date&gt;2015/12/31&lt;/end.date&gt;
  &lt;/state.data.assimilation&gt;</code></pre>
<ul>
<li><p>Delete the <code>&lt;pfts&gt;</code> block from the settings</p></li>
<li><p>In the PEcAn History, go to your PDA run and open <code>pecan.pda[UNIQUEID].xml</code> (the one PEcAn saved for you AFTER you finished the PDA)</p></li>
<li><p>Cut-and-paste the PDA <code>&lt;pfts&gt;</code> block into the SDA settings file</p></li>
<li><p>Save the file as <code>pecan.SDA.xml</code></p></li>
</ul>
</div>
<div id="loading-data" class="section level4 hasAnchor" number="5.5.4.5">
<h4><span class="header-section-number">5.5.4.5</span> Loading data<a href="othervignettes.html#loading-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<ul>
<li><p>If you have not done so already, clone (new) or pull (update) the PalEON Camp2016 repository</p></li>
<li><p>Open a shell under Tools &gt; Shell</p></li>
<li><p><code>cd</code> to go to your home directory</p></li>
<li><p>To clone: <code>git clone git@github.com:PalEON-Project/Camp2016.git</code></p></li>
<li><p>To pull: <code>cd Camp2016; git pull https://github.com/PalEON-Project/Camp2016.git master</code></p></li>
<li><p>Open the tree-ring data assimilation workflow under Home &gt; pecan &gt; scripts &gt; workflow.treering.R</p></li>
<li><p>Run the script from the start up through the LOAD DATA section</p></li>
</ul>
</div>
<div id="estimating-tree-level-data-uncertainties" class="section level4 hasAnchor" number="5.5.4.6">
<h4><span class="header-section-number">5.5.4.6</span> Estimating tree-level data uncertainties<a href="othervignettes.html#estimating-tree-level-data-uncertainties" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>One thing that is critical for data assimilation, whether it is being used to estimate parameters or state variables, is the careful consideration and treatment of the uncertainties in the data itself. For this analysis we will be using a combination of forest plot and tree ring data in order to estimate stand-level productivity. The basic idea is that we will be using the plot-sample of measured DBHs as an estimate of the size structure of the forest, and will use the annual growth increments to project that forest backward in time. Tree biomass is estimated using empirical allometric equations relating DBH to aboveground biomass. There are a number of sources of uncertainty in this approach, and before moving you are encouraged to think about and write down a few:</p>
<hr />
<hr />
<hr />
<hr />
<hr />
<hr />
<hr />
<hr />
<p>Today we will use a statistical model based on the model developed by Clark et al 2007 that partitions out a number of sources of variability and uncertainty in tree ring and plot data (Fig 1). This model is a Bayesian statespace model that treats the true diameters (D) and increments (X) as latent variables that are connected through a fairly simple mixed effects process model</p>
<p><span class="math display">\[D_{ij,t+1} = D_{ij,t} + \mu + \alpha_{i} + \alpha_t + \epsilon_{ij,t}\]</span></p>
<p>where i = individual, j = plot, t = time (year). Each of these terms are represented at normal distributions, where <span class="math inline">\(\mu\)</span> is a fixed effect (overall mean growth rate) and individual and year are random effects</p>
<p><span class="math display">\[\mu \sim N(0.5,0.5)\]</span>
<span class="math display">\[\alpha_{i} \sim N(0,\tau_{i})\]</span>
<span class="math display">\[\alpha_{t} \sim N(0,\tau_{t})\]</span>
<span class="math display">\[\epsilon_{ij,t} \sim N(0,\tau_{e})\]</span></p>
<p>The connection between the true (latent) variable and the observations is also represented as normal with these variances representing measurement error:</p>
<p><span class="math display">\[D_{ij,t}^O \sim N( D_{ij,t},\tau_D)\]</span>
<span class="math display">\[X_{ij,t}^O \sim N( X_{ij,t},\tau_r)\]</span></p>
<p>Finally, there are five gamma priors on the precisions, one for the residual process error (<span class="math inline">\(\tau_{e}\)</span>), two for the random effects on individual (<span class="math inline">\(\tau_{i}\)</span>) and time (<span class="math inline">\(\tau_t\)</span>),
and two measurement errors or DBH (<span class="math inline">\(\tau_D\)</span>) and tree rings (<span class="math inline">\(\tau_r\)</span>)</p>
<p><span class="math display">\[\tau_{e} \sim Gamma(a_e,r_e)\]</span>
<span class="math display">\[\tau_{i} \sim Gamma(a_i,r_i)\]</span>
<span class="math display">\[\tau_{t} \sim Gamma(a_t,r_t)\]</span>
<span class="math display">\[\tau_{D} \sim Gamma(a_D,r_D)\]</span>
<span class="math display">\[\tau_{r} \sim Gamma(a_r,r_r)\]</span></p>
<p>This model is encapsulated in the PEcAn function:</p>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="othervignettes.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">InventoryGrowthFusion</span>(combined,n,iter)</span></code></pre></div>
<p>where the first argument is the combined data set formatted for JAGS and the second is the number of MCMC interations. The model itself is written for JAGS and is embedded in the function. Running the above InventoryGrowthFusion will run a full MCMC algorithm, so it does take a while to run. The code returns the results as an mcmc.list object, and the next line in the script saves this to the outputs directory We then call the function InventoryGrowthFusionDiagnostics to print out a set of MCMC diagnostics and example time-series for growth and DBH.</p>
</div>
<div id="allometric-equations" class="section level4 hasAnchor" number="5.5.4.7">
<h4><span class="header-section-number">5.5.4.7</span> Allometric equations<a href="othervignettes.html#allometric-equations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Aboveground NPP is estimated as the increment in annual total aboveground biomass. This estimate is imperfect, but not unreasonable for demonstration purposes. As mentioned above, we will take an allometric approach of scaling from diameter to biomass: Biomass = b0 * DBH b1 We will generate the allometric equation on a PFT level using another Bayesian model that synthesizes across a database of species-level allometric equations (Jenkins et al 2004). This model has two steps within the overall MCMC loop. First it simulates data from each equation, including both parameter and residual uncertainties, and then it updated the parameters of a single allometric relationship across all observations. The code also fits a second model, which includes a random site effect, but for simplicity we will not be using output from this version. Prior to running the model we have to first query the species codes for our pfts. Next we pass this PFT list to the model, AllomAve, which saves the results to the output directory in addition to returning a summary of the parameters and covariances.</p>
</div>
<div id="estimate-stand-level-npp" class="section level4 hasAnchor" number="5.5.4.8">
<h4><span class="header-section-number">5.5.4.8</span> Estimate stand-level NPP<a href="othervignettes.html#estimate-stand-level-npp" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>If we have no uncertainty in our data or allometric equations, we could estimate the stand aboveground biomass (AGB) for every year by summing over the biomass of all the trees in the plot and then divide by the plot area. We would then estimate NPP by the difference in AGB between years. One approach to propagating uncertainties into NPP would be to transform the distribution of DBH for each individual tree and year into a distribution for biomass, then sum over those distributions to get a distribution for AGB and then subtract the distributions to get the distributions of NPP. However, if we do this we will greatly overestimate the uncertainty in NPP because we ignore the fact that our increment data has much lower uncertainty than our diameter data. In essence, if we take a random draw from a distribution of AGB in year and it comes back above average, the AGB is much more likely to also be above average the following year than if we were to do an independent draw from that distribution. Accounting for this covariance requires a fairly simple change in our approach and takes advantage of the nature of the MCMC output. The basic idea is that we are going to take a random draw from the full individual x year diameter matrix, as well as a random draw of allometric parameters, and perform the ‘zero-error’ calculation approach described above. We will then create a distribution of all the NPP estimates that comes out of repeated draws for the full diameter matrix. This approach is encapsulated in the function <code>plot2AGB</code>. The argument unit.conv is a factor that combines both the area of the plot and the unit conversion from tree biomass (kg/tree) to stand AGB (Mg/ha). There are two outputs from plot2AGB: a pdf depicting estimated NPP and AGB (mean and 95% CI) time series, with each page being a plot; and plot2AGB.Rdata, a binary record of the function output that is read into the data assimilation code. The latter is also returned from the fuction and assigned to the variable “state”. Finally, we calculate the mean and standard deviation of NPP and save this as obs.</p>
</div>
<div id="build-initial-conditions" class="section level4 hasAnchor" number="5.5.4.9">
<h4><span class="header-section-number">5.5.4.9</span> Build Initial Conditions<a href="othervignettes.html#build-initial-conditions" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function sample.IC.SIPNET uses the AGB estimate from the previous function in order to initialize the data assimilation routine. Specifically it samples n.ensemble values from the first time step of the AGB estimate. Embedded in this function are also a number of prior distributions for other state variables, which are also samples in order to create a full set of initial conditions for SIPNET.</p>
</div>
<div id="load-priors" class="section level4 hasAnchor" number="5.5.4.10">
<h4><span class="header-section-number">5.5.4.10</span> Load Priors<a href="othervignettes.html#load-priors" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function sample.parameters samples values from the most recent posterior parameter distributions. You can also specify a specific set of parameters so sample from by specifying the argument <code>&lt;prior&gt;</code> within <code>&lt;assim.sequential&gt;</code> as the posterior.id you want to use. This is useful to know if you want to go back and run with the Meta-analysis posteriors, or if you end up rerunning the meta-analysis and need to go back and specify the parameter data assimilation posteriors instead of the most recent.</p>
</div>
<div id="ensemble-kalman-filter" class="section level4 hasAnchor" number="5.5.4.11">
<h4><span class="header-section-number">5.5.4.11</span> Ensemble Kalman Filter<a href="othervignettes.html#ensemble-kalman-filter" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The function <code>sda.enkf</code> will run SIPNET in Ensemble Kalman Filter mode. The output of this function will be all the of run outputs, a PDF of diagnostics, and an Rdata object that includes three lists:</p>
<ul>
<li>FORECAST will be the ensemble forecasts for each year</li>
<li>ANALYSIS will be the updated ensemble sample given the NPP observations</li>
<li>enkf.params contains the prior and posterior mean vector and covariance matrix for each time step.</li>
</ul>
<p>If you look within this function you will find that much of the format is similar to the pda.mcmc function, but in general is much simpler. The function begins by setting parameters, opening a database connection, and generating workflow and ensemble ID’s. Next we split the SIPNET clim meteorology file up into individual annual files since we will be running SIPNET for a year at a time between updates. Next we perform an initial set of runs starting from the initial states and parameters we described above. In doing so we create the run and output directories, the README file, and the runs.txt file that is read by start_model_runs. Worth noting is that the README and runs.txt don’t need to be updated within the forecast loop. Given this initial run we then enter the forecast loop. Within this loop over years we perform four basic steps. First, we read the output from the latest runs. Second, we calculate the updated posterior state estimates based on the model ensemble prior and observation likelihood. Third, we resample the state estimates based on these posterior parameters. Finally, we start a new set of runs based on this sample. The sda.enfk function then ends by saving the outputs and generating some diagnostic figures. The first set of these shows the data, forecast, analysis. The second set shows pairs plots of the covariance structure for the Forecast and Analysis steps. The final set shows the time-series plots for the Analysis of the over state variables produced by SIPNET.</p>
</div>
<div id="finishing-up" class="section level4 hasAnchor" number="5.5.4.12">
<h4><span class="header-section-number">5.5.4.12</span> Finishing up<a href="othervignettes.html#finishing-up" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>The final bit of code in the script will register the workflow as complete in the database. After this is run you should be able to find all of the runs, and all of the outputs generated above, from within the PEcAn webpages.</p>

</div>
</div>
<div id="pecan-testing-the-sensitivity-analysis-against-observations" class="section level3 hasAnchor" number="5.5.5">
<h3><span class="header-section-number">5.5.5</span> PEcAn: Testing the Sensitivity Analysis Against Observations”<a href="othervignettes.html#pecan-testing-the-sensitivity-analysis-against-observations" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<div id="author-ankur-desai" class="section level4 hasAnchor" number="5.5.5.1">
<h4><span class="header-section-number">5.5.5.1</span> Author: “Ankur Desai”<a href="othervignettes.html#author-ankur-desai" class="anchor-section" aria-label="Anchor link to header"></a></h4>
</div>
<div id="flux-measurements-and-modeling-course-tutorial-part-2" class="section level4 hasAnchor" number="5.5.5.2">
<h4><span class="header-section-number">5.5.5.2</span> Flux Measurements and Modeling Course, <em>Tutorial Part 2</em><a href="othervignettes.html#flux-measurements-and-modeling-course-tutorial-part-2" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>This tutorial assumes you have successfully completed the Demo01, Demo02 and the modelVSdata tutorial.</p>
</div>
<div id="introduction" class="section level4 hasAnchor" number="5.5.5.3">
<h4><span class="header-section-number">5.5.5.3</span> Introduction<a href="othervignettes.html#introduction" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Now that you have successfully run PEcAn through the web interface and have learned how to do a simple comparison of flux tower observations to model output, let’s start looking at how data assimilation and parameter estimation would work with an ecosystem model.</p>
<p>Before we start a full data assimilation exercise, let’s try something simple – single parameter selection by hand.</p>
<ul>
<li>Open <a href="http://localhost:3280/rstudio" class="uri">http://localhost:3280/rstudio</a> or <a href="http://localhost:6480/rstudio" class="uri">http://localhost:6480/rstudio</a> or the Amazon URL/rstudio if running on the cloud.</li>
</ul>
<p>In Demo02, you have ran a sensitivity analysis of SIPNET model runs at Niwot Ridge sampling across quantiles of a parameter prior, while holding all others to the median value. The pecan.xml file told PEcAn to run an sensitivity analysis, which simply meant SIPNET was run multiple times with the same driver, but varying parameter values one at a time (while holding all others to their median), and the parameter range also specified in the pecan.xml file (as quantiles, which were then sampled against the BETY database of observed variation in the parameter for species within the specific plant functional type).</p>
<p>Let’s try to compare Ameriflux NEE to SIPNET NEE across all these runs to make a plot of parameter vs. goodness-of-fit. We’ll start with root mean square error (<strong>RMSE</strong>), but then discuss some other tests, too.</p>
</div>
<div id="a.-read-in-settings-object-from-a-run-xml" class="section level4 hasAnchor" number="5.5.5.4">
<h4><span class="header-section-number">5.5.5.4</span> A. Read in settings object from a run xml<a href="othervignettes.html#a.-read-in-settings-object-from-a-run-xml" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Open up a connection to the bety database and create a settings object from your xml, just like in the modelVSdata tutorial.</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="othervignettes.html#cb47-1" aria-hidden="true" tabindex="-1"></a>settings<span class="ot">&lt;-</span>PEcAn.settings<span class="sc">::</span><span class="fu">read.settings</span>(<span class="st">&quot;~/output/PEcAn_99000000002/pecan.CONFIGS.xml&quot;</span>)</span>
<span id="cb47-2"><a href="othervignettes.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="othervignettes.html#cb47-3" aria-hidden="true" tabindex="-1"></a>con <span class="ot">&lt;-</span> PEcan.DB<span class="sc">::</span><span class="fu">db.open</span>(settings<span class="sc">$</span>database<span class="sc">$</span>bety)</span></code></pre></div>
<p>We read in the pecan.CONFIG.xml instead of the pecan.xml because the pecan.CONFIG.xml has already incorperated some of the information from the database we would have to query again if we used the pecan.xml.</p>
<div class="sourceCode" id="cb48"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb48-1"><a href="othervignettes.html#cb48-1" aria-hidden="true" tabindex="-1"></a>runid<span class="ot">&lt;-</span><span class="fu">as.character</span>(<span class="fu">read.table</span>(<span class="fu">paste</span>(settings<span class="sc">$</span>outdir, <span class="st">&quot;/run/&quot;</span>,<span class="st">&quot;runs.txt&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))[<span class="dv">1</span>,<span class="dv">1</span>]) <span class="co"># Note: if you are using an xml from a run with multiple ensembles this line will provide only the first run id</span></span>
<span id="cb48-2"><a href="othervignettes.html#cb48-2" aria-hidden="true" tabindex="-1"></a>outdir<span class="ot">&lt;-</span> <span class="fu">paste</span>(settings<span class="sc">$</span>outdir,<span class="st">&quot;/out/&quot;</span>,runid,<span class="at">sep=</span> <span class="st">&quot;&quot;</span>)</span>
<span id="cb48-3"><a href="othervignettes.html#cb48-3" aria-hidden="true" tabindex="-1"></a>start.year<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(settings<span class="sc">$</span>run<span class="sc">$</span>start.date))</span>
<span id="cb48-4"><a href="othervignettes.html#cb48-4" aria-hidden="true" tabindex="-1"></a>end.year<span class="ot">&lt;-</span><span class="fu">as.numeric</span>(lubridate<span class="sc">::</span><span class="fu">year</span>(settings<span class="sc">$</span>run<span class="sc">$</span>end.date))</span>
<span id="cb48-5"><a href="othervignettes.html#cb48-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb48-6"><a href="othervignettes.html#cb48-6" aria-hidden="true" tabindex="-1"></a>site.id<span class="ot">&lt;-</span>settings<span class="sc">$</span>run<span class="sc">$</span>site<span class="sc">$</span>id</span></code></pre></div>
<p>Back to the files pane, within the <em>run/</em> folder, find a folder called <em>pft/</em> and within that a folder with the pft name (such as <em>temprature.coniferous</em>). Within that is a PDF file that starts <em>sensitivity.analysis</em>. In Rstudio, just click on the PDF to view it. You discussed this PDF last tutorial, through the web interface. Here, we see how the model NEE in SIPNET changes with each parameter.</p>
<p>Let’s read that sensitivity output. Navigate back up (<em>..</em>) to the <em>~/output/<strong>RUNDIR</strong>/</em> folder. Find a series of files that end in “<em>.RData</em>”. These files contain the R variables used to make these plots. In particular, there is <strong>sensitivity.output.<em>.RData<strong> which contains the annual NEE as a function of each parameter quantile. Click on it to load a variable into your environment. There is </strong>sensitivity.results.</em>.RData</strong> which contains plotting functions and variance decomposition output, which we don’t need in this tutorial. And finally, there is **sensitivity.samples.*.RData** which contains the actual parameter values and the RunIDs associated with each sensitivity run.</p>
<p>Click on <em>sensitivity.samples.</em>.RData* to load it into your environment, or run the <code>{r}load()</code> script below. You should see a set of five new variables (pft.names, trait.names, sa.ensemble.id, sa.run.ids, sa.samples).</p>
<p>Let’s extract a parameter and it’s sensitivity NEE output from the list sa.samples, which is organized by PFT, and then by parameter. First, let’s look at a list of PFTs and parameters available:</p>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="othervignettes.html#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">paste</span>(settings<span class="sc">$</span>outdir,<span class="st">&quot;/sensitivity.samples.&quot;</span>, settings<span class="sc">$</span>sensitivity.analysis<span class="sc">$</span>ensemble.id,<span class="st">&quot;.Rdata&quot;</span>, <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb49-2"><a href="othervignettes.html#cb49-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-3"><a href="othervignettes.html#cb49-3" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sa.samples)</span>
<span id="cb49-4"><a href="othervignettes.html#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="fu">names</span>(sa.samples<span class="sc">$</span>temperate.coniferous)</span></code></pre></div>
<p>Now to see the actual parameter values used by the runs, just pick a parameter and type:</p>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="othervignettes.html#cb50-1" aria-hidden="true" tabindex="-1"></a>sa.samples<span class="sc">$</span>temperate.coniferous<span class="sc">$</span>psnTOpt</span></code></pre></div>
<p>Let’s store that value for future use:</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="othervignettes.html#cb51-1" aria-hidden="true" tabindex="-1"></a>psnTOpt <span class="ot">&lt;-</span> sa.samples<span class="sc">$</span>temperate.coniferous<span class="sc">$</span>psnTOpt</span></code></pre></div>
<p>Now, to see the annual NEE output from the model for a particular PFT and parameter range, try</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="othervignettes.html#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="fu">load</span>(<span class="fu">paste</span>(settings<span class="sc">$</span>outdir,<span class="fu">paste</span>(<span class="st">&quot;/sensitivity.output&quot;</span>, settings<span class="sc">$</span>sensitivity.analysis<span class="sc">$</span>ensemble.id,settings<span class="sc">$</span>sensitivity.analysis<span class="sc">$</span>variable,start.year,end.year,<span class="st">&quot;Rdata&quot;</span>, <span class="at">sep=</span><span class="st">&quot;.&quot;</span>), <span class="at">sep=</span><span class="st">&quot;&quot;</span>))</span>
<span id="cb52-2"><a href="othervignettes.html#cb52-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-3"><a href="othervignettes.html#cb52-3" aria-hidden="true" tabindex="-1"></a>sensitivity.output<span class="sc">$</span>temperate.coniferous<span class="sc">$</span>psnTOpt</span></code></pre></div>
<p>You could even plot the two:</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="othervignettes.html#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(psnTOpt,sensitivity.output<span class="sc">$</span>temperate.coniferous<span class="sc">$</span>psnTOpt)</span></code></pre></div>
<p>What do you notice?</p>
<p>Let’s try to read the output from a single run id as you did in the earlier tutorial.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="othervignettes.html#cb54-1" aria-hidden="true" tabindex="-1"></a>runids <span class="ot">&lt;-</span> sa.run.ids<span class="sc">$</span>temperate.coniferous<span class="sc">$</span>psnTOpt</span>
<span id="cb54-2"><a href="othervignettes.html#cb54-2" aria-hidden="true" tabindex="-1"></a>arun <span class="ot">&lt;-</span> PEcAn.utils<span class="sc">::</span><span class="fu">read.output</span>(runids[<span class="dv">1</span>], <span class="fu">paste</span>(settings<span class="sc">$</span>outdir, <span class="st">&quot;out&quot;</span>, runids[<span class="dv">1</span>], <span class="at">sep=</span><span class="st">&quot;/&quot;</span>), <span class="at">start.year=</span> start.year, <span class="at">end.year=</span> end.year,<span class="st">&quot;NEE&quot;</span>, <span class="at">dataframe =</span> <span class="cn">TRUE</span>)</span>
<span id="cb54-3"><a href="othervignettes.html#cb54-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb54-4"><a href="othervignettes.html#cb54-4" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(arun<span class="sc">$</span>posix,arun<span class="sc">$</span>NEE)</span></code></pre></div>
</div>
<div id="b.-now-lets-bring-in-the-actual-observations" class="section level4 hasAnchor" number="5.5.5.5">
<h4><span class="header-section-number">5.5.5.5</span> B. Now let’s bring in the actual observations<a href="othervignettes.html#b.-now-lets-bring-in-the-actual-observations" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>Recall reading Ameriflux NEE in the modelVSdata tutorial.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="othervignettes.html#cb55-1" aria-hidden="true" tabindex="-1"></a>File_path<span class="ot">&lt;-</span><span class="st">&quot;~/output/dbfiles/AmerifluxLBL_site_0-772/AMF_US-NR1_BASE_HH_9-1.csv&quot;</span></span>
<span id="cb55-2"><a href="othervignettes.html#cb55-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-3"><a href="othervignettes.html#cb55-3" aria-hidden="true" tabindex="-1"></a>File_format<span class="ot">&lt;-</span>PEcAn.DB<span class="sc">::</span><span class="fu">query.format.vars</span>(<span class="at">bety =</span> con, <span class="at">format.id =</span> <span class="dv">5000000002</span>) <span class="co">#This matches the file with a premade &quot;format&quot; or a template that describes how the information in the file is organized</span></span>
<span id="cb55-4"><a href="othervignettes.html#cb55-4" aria-hidden="true" tabindex="-1"></a>site<span class="ot">&lt;-</span>PEcAn.DB<span class="sc">::</span><span class="fu">query.site</span>(<span class="at">site.id =</span> site.id, con)</span>
<span id="cb55-5"><a href="othervignettes.html#cb55-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-6"><a href="othervignettes.html#cb55-6" aria-hidden="true" tabindex="-1"></a>obs<span class="ot">&lt;-</span>PEcAn.benchmark<span class="sc">::</span><span class="fu">load_data</span>(<span class="at">data.path =</span> File_path, <span class="at">format=</span> File_format, <span class="at">time.row =</span> File_format<span class="sc">$</span>time.row,  <span class="at">site =</span> site, <span class="at">start_year =</span> start.year, <span class="at">end_year =</span> end.year)</span>
<span id="cb55-7"><a href="othervignettes.html#cb55-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-8"><a href="othervignettes.html#cb55-8" aria-hidden="true" tabindex="-1"></a>obs<span class="sc">$</span>NEE[obs<span class="sc">$</span>UST<span class="sc">&lt;</span><span class="fl">0.2</span>]<span class="ot">&lt;-</span><span class="cn">NA</span> <span class="co">#Apply a U* filter</span></span>
<span id="cb55-9"><a href="othervignettes.html#cb55-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb55-10"><a href="othervignettes.html#cb55-10" aria-hidden="true" tabindex="-1"></a>plottable<span class="ot">&lt;-</span><span class="fu">align_data</span>(<span class="at">model.calc =</span> arun, <span class="at">obvs.calc =</span> obs, <span class="at">align_method =</span> <span class="st">&quot;match_timestep&quot;</span>, <span class="at">var=</span> <span class="st">&quot;NEE&quot;</span>)</span>
<span id="cb55-11"><a href="othervignettes.html#cb55-11" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(plottable)</span></code></pre></div>
</div>
<div id="c.-finally-we-can-finally-compare-model-to-data" class="section level4 hasAnchor" number="5.5.5.6">
<h4><span class="header-section-number">5.5.5.6</span> C. Finally, we can finally compare model to data<a href="othervignettes.html#c.-finally-we-can-finally-compare-model-to-data" class="anchor-section" aria-label="Anchor link to header"></a></h4>
<p>In the modelVSdata, you also compared NEE to the ensemble model run. Here we will do the same except we include each sensitivity run.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="othervignettes.html#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(plottable<span class="sc">$</span>NEE.m,plottable<span class="sc">$</span>NEE.o)</span>
<span id="cb56-2"><a href="othervignettes.html#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="fu">abline</span>(<span class="dv">0</span>,<span class="dv">1</span>,<span class="at">col=</span><span class="st">&quot;red&quot;</span>)</span></code></pre></div>
<p>And remember the formula for RMSE:</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="othervignettes.html#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="fu">sqrt</span>(<span class="fu">mean</span>((plottable<span class="sc">$</span>NEE.o<span class="sc">-</span>plottable<span class="sc">$</span>NEE.m)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span></code></pre></div>
<p>All we need to do to go beyond this is to make a loop that reads in each sensitivity run NEE based on runids, calculates RMSE against the observations, and stores it in an array, by combining the steps above in a for loop. Make sure you change the directory names and year to your specific run.</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="othervignettes.html#cb58-1" aria-hidden="true" tabindex="-1"></a>rmses <span class="ot">&lt;-</span> <span class="fu">rep</span>(<span class="dv">0</span>,<span class="fu">length</span>(runids))</span>
<span id="cb58-2"><a href="othervignettes.html#cb58-2" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span>(r <span class="cf">in</span> <span class="dv">1</span><span class="sc">:</span><span class="fu">length</span>(runids)){</span>
<span id="cb58-3"><a href="othervignettes.html#cb58-3" aria-hidden="true" tabindex="-1"></a>arun <span class="ot">&lt;-</span> <span class="fu">read.output</span>(runids[r],<span class="fu">paste</span>(settings<span class="sc">$</span>outdir, <span class="st">&quot;out&quot;</span>, runids[r], <span class="at">sep=</span><span class="st">&quot;/&quot;</span>),<span class="dv">2004</span>,<span class="dv">2004</span>,<span class="st">&quot;NEE&quot;</span>, <span class="at">dataframe=</span> <span class="cn">TRUE</span>)</span>
<span id="cb58-4"><a href="othervignettes.html#cb58-4" aria-hidden="true" tabindex="-1"></a>plottable<span class="ot">&lt;-</span><span class="fu">align_data</span>(<span class="at">model.calc =</span> arun, <span class="at">obvs.calc =</span> obs, <span class="at">align_method =</span> <span class="st">&quot;match_timestep&quot;</span>, <span class="at">var=</span> <span class="st">&quot;NEE&quot;</span>)</span>
<span id="cb58-5"><a href="othervignettes.html#cb58-5" aria-hidden="true" tabindex="-1"></a>rmses[r] <span class="ot">&lt;-</span> <span class="fu">sqrt</span>(<span class="fu">mean</span>((plottable<span class="sc">$</span>NEE.o<span class="sc">-</span>plottable<span class="sc">$</span>NEE.m)<span class="sc">^</span><span class="dv">2</span>,<span class="at">na.rm =</span> <span class="cn">TRUE</span>))</span>
<span id="cb58-6"><a href="othervignettes.html#cb58-6" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb58-7"><a href="othervignettes.html#cb58-7" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb58-8"><a href="othervignettes.html#cb58-8" aria-hidden="true" tabindex="-1"></a>rmses</span></code></pre></div>
<p>Let’s plot that array</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="othervignettes.html#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="fu">plot</span>(psnTOpt,rmses)</span></code></pre></div>
<p>Can you identify a minimum (if there is one)? If so, is there any reason to believe this is the “best” parameter? Why or why not? Think about all the other parameters.</p>
<p>Now that you have the hang of it, here are a few more things to try:</p>
<ol style="list-style-type: decimal">
<li>Try a different error functions, given actual NEE uncertainty. You learned earlier that uncertainty in half-hourly observed NEE is not Gaussian. This makes RMSE not the correct measure for goodness-of-fit. Go to <em>~/pecan/modules/uncertainty/R</em>, open <em>flux_uncertainty.R</em>, and click on the <em>source</em> button in the program editing pane.</li>
</ol>
<p>Alternatively, you can source the function from the console using:</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="othervignettes.html#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="fu">source</span>(<span class="st">&quot;pecan/modules/uncertainty/R/flux_uncertainty.R&quot;</span>)</span></code></pre></div>
<p>Then you can run:</p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="othervignettes.html#cb61-1" aria-hidden="true" tabindex="-1"></a>unc <span class="ot">&lt;-</span> <span class="fu">flux.uncertainty</span>(plottable<span class="sc">$</span>NEE.o,<span class="at">QC=</span><span class="fu">rep</span>(<span class="dv">0</span>,<span class="dv">17520</span>))</span>
<span id="cb61-2"><a href="othervignettes.html#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="fu">plot_flux_uncertainty</span>(unc)</span></code></pre></div>
<p>The figure shows you uncertainty (err) as a function of NEE magnitude (mag). How might you use this information to change the RMSE calculation?</p>
<p>Try a few other parameters. Repeat the above steps but with a different parameter. You might want to select one from the sensitivity PDF that has a large sensitivity or from the variance decomposition that is also poorly constrained.</p>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="demo-2.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="advanced-user.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="assets/gitbook-2.6.7/js/app.min.js"></script>
<script src="assets/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="assets/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="assets/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tonygardella/pecan/edit/release/vtonydoc/book_source/02_demos_tutorials_workflows/02_user_demos/04_other_vignettes/00_other_vignettes.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "section"
},
"toolbar": {
"position": "static"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
